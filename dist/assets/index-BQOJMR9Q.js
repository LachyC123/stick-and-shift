var it=Object.defineProperty;var at=(k,a,e)=>a in k?it(k,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):k[a]=e;var l=(k,a,e)=>at(k,typeof a!="symbol"?a+"":a,e);import{P as p}from"./phaser-0RJB29YE.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();class ot{constructor(a){l(this,"scene");this.scene=a}generateAll(){this.generatePlayerTextures(),this.generateEnemyTextures(),this.generateBallTexture(),this.generateGoalTextures(),this.generatePitchTextures(),this.generateUITextures(),this.generateParticleTextures(),this.generateEffectTextures()}generatePlayerTextures(){[3447003,15158332,3066993,10181046,15965202,1752220,15105570,9323693,15844367,1482885,12597547,2600544,13849600,2719929,9109504,48340,6765239,16733986,3426654,15277667].forEach((e,t)=>{this.createPlayerSprite(`player_${t}`,e,!1)}),this.createPlayerSprite("player_selected",16777215,!0)}createPlayerSprite(a,e,t){const s=this.scene.add.graphics();s.fillStyle(0,.3),s.fillEllipse(48/2+2,42,28,12);const o=e;s.fillStyle(o,1),s.fillRoundedRect(48/2-12,8,24,28,6),s.fillStyle(16777215,.2),s.fillRoundedRect(48/2-10,10,8,24,4),s.fillStyle(0,.2),s.fillRoundedRect(48/2+2,10,8,24,4),s.fillStyle(16111048,1),s.fillCircle(48/2,10,10),s.lineStyle(2,3355443,1),s.strokeCircle(48/2,10,10),s.lineStyle(2,3355443,1),s.strokeRoundedRect(48/2-12,8,24,28,6),s.fillStyle(2899536,1),s.fillRoundedRect(48/2-10,34,8,12,3),s.fillRoundedRect(48/2+2,34,8,12,3),s.lineStyle(4,9127187,1),s.beginPath(),s.moveTo(48/2+14,12),s.lineTo(48/2+20,40),s.lineTo(48/2+28,42),s.strokePath(),s.fillStyle(3355443,1),s.fillRoundedRect(48/2+17,38,14,6,2),t&&(s.lineStyle(3,16776960,.8),s.strokeCircle(48/2,48/2,48/2-4)),s.generateTexture(a,48,48),s.destroy()}generateEnemyTextures(){[{key:"enemy_defender",color:8359053},{key:"enemy_mid",color:9807270},{key:"enemy_forward",color:12436423},{key:"enemy_boss",color:16739179},{key:"enemy_orange",color:16749824}].forEach(({key:e,color:t})=>{this.createEnemySprite(e,t,e==="enemy_boss"||e==="enemy_orange")})}createEnemySprite(a,e,t){const i=t?56:48,s=this.scene.add.graphics();s.fillStyle(0,.3),s.fillEllipse(i/2+2,i-6,t?36:28,12),s.fillStyle(e,1),s.fillRect(i/2-14,10,28,26),s.fillStyle(e,1),s.fillTriangle(i/2-14,10,i/2-20,18,i/2-14,26),s.fillTriangle(i/2+14,10,i/2+20,18,i/2+14,26),s.fillStyle(0,.3),s.fillRect(i/2,12,12,22),s.fillStyle(5592405,1),s.fillCircle(i/2,10,10),t?(s.fillStyle(16711680,1),s.fillCircle(i/2-4,9,3),s.fillCircle(i/2+4,9,3)):(s.fillStyle(16777215,1),s.fillCircle(i/2-4,9,2),s.fillCircle(i/2+4,9,2)),s.lineStyle(2,1710618,1),s.strokeRect(i/2-14,10,28,26),s.strokeCircle(i/2,10,10),s.fillStyle(1710618,1),s.fillRect(i/2-10,34,8,12),s.fillRect(i/2+2,34,8,12),s.lineStyle(4,4868682,1),s.beginPath(),s.moveTo(i/2-14,14),s.lineTo(i/2-22,40),s.lineTo(i/2-30,42),s.strokePath(),s.fillStyle(1710618,1),s.fillRoundedRect(i/2-33,38,14,6,2),t&&(s.lineStyle(3,16711680,.5),s.strokeCircle(i/2,i/2,i/2-2)),s.generateTexture(a,i,i),s.destroy()}generateBallTexture(){const e=this.scene.add.graphics();e.fillStyle(0,.3),e.fillEllipse(20/2+1,20/2+3,14,8),e.fillStyle(16777215,1),e.fillCircle(20/2,20/2-2,8),e.fillStyle(14737632,1),e.fillCircle(20/2-3,20/2-4,2),e.fillCircle(20/2+2,20/2-1,2),e.fillCircle(20/2-1,20/2,1.5),e.fillStyle(16777215,.8),e.fillCircle(20/2-3,20/2-5,3),e.lineStyle(1.5,10066329,1),e.strokeCircle(20/2,20/2-2,8),e.generateTexture("ball",20,20),e.destroy();const t=this.scene.add.graphics();t.fillStyle(16777215,.5),t.fillCircle(6,6,5),t.generateTexture("ball_trail",12,12),t.destroy()}generateGoalTextures(){this.createGoalTexture("goal_left",!0),this.createGoalTexture("goal_right",!1)}createGoalTexture(a,e){const s=this.scene.add.graphics();s.fillStyle(2960685,1),e?s.fillRect(0,0,8,120):s.fillRect(32,0,8,120),s.lineStyle(1,13421772,.7);const o=e?8:0,n=e?40:32;for(let c=5;c<120;c+=10)s.beginPath(),s.moveTo(o,c),s.lineTo(n,c),s.strokePath();for(let c=0;c<20;c++)s.beginPath(),s.moveTo(o,c*10),s.lineTo(n,c*10+20),s.strokePath(),s.beginPath(),s.moveTo(o,c*10+20),s.lineTo(n,c*10),s.strokePath();s.fillStyle(16777215,1);const r=e?34:0;s.fillRect(r,0,6,4),s.fillRect(r,116,6,4),s.fillRect(r,0,6,120),s.lineStyle(2,3355443,1),s.strokeRect(r,0,6,4),s.strokeRect(r,116,6,4),s.generateTexture(a,40,120),s.destroy()}generatePitchTextures(){this.createTurfTexture(),this.createLineTexture(),this.createCircleTexture()}createTurfTexture(){const t=this.scene.add.graphics();t.fillStyle(2263842,1),t.fillRect(0,0,64,64),t.fillStyle(1997598,1);for(let i=0;i<64;i+=16)t.fillRect(0,i,64,8);t.fillStyle(1731354,.3);for(let i=0;i<30;i++){const s=Math.random()*64,o=Math.random()*64;t.fillCircle(s,o,1)}t.generateTexture("turf",64,64),t.destroy()}createLineTexture(){const a=this.scene.add.graphics();a.fillStyle(16777215,1),a.fillRect(0,0,100,4),a.generateTexture("line_h",100,4),a.clear(),a.fillStyle(16777215,1),a.fillRect(0,0,4,100),a.generateTexture("line_v",4,100),a.destroy()}createCircleTexture(){const e=this.scene.add.graphics();e.lineStyle(4,16777215,1),e.strokeCircle(200/2,200/2,200/2-4),e.generateTexture("circle",200,200),e.destroy();const t=this.scene.add.graphics();t.lineStyle(4,16777215,1),t.beginPath(),t.arc(0,75,75,-Math.PI/2,Math.PI/2,!1),t.strokePath(),t.generateTexture("d_right",80,150),t.clear(),t.lineStyle(4,16777215,1),t.beginPath(),t.arc(80,75,75,Math.PI/2,-Math.PI/2,!1),t.strokePath(),t.generateTexture("d_left",80,150),t.destroy()}generateUITextures(){this.createButtonTexture("btn_normal",3447003,2719929),this.createButtonTexture("btn_hover",6139362,3447003),this.createButtonTexture("btn_pressed",2388387,1725046),this.createButtonTexture("btn_disabled",8359053,5662067),this.createPanelTexture(),this.createCardTextures(),this.createIconTextures()}createButtonTexture(a,e,t){const o=this.scene.add.graphics();o.fillStyle(0,.3),o.fillRoundedRect(4,4,200,50,10),o.fillStyle(e,1),o.fillRoundedRect(0,0,200,50,10),o.fillStyle(t,1),o.fillRoundedRect(0,50/2,200,50/2,{tl:0,tr:0,bl:10,br:10}),o.fillStyle(16777215,.2),o.fillRoundedRect(4,4,192,50/3,6),o.lineStyle(2,16777215,.3),o.strokeRoundedRect(0,0,200,50,10),o.generateTexture(a,208,58),o.destroy()}createPanelTexture(){const t=this.scene.add.graphics();t.fillStyle(0,.4),t.fillRoundedRect(6,6,300,200,15),t.fillStyle(1710638,.95),t.fillRoundedRect(0,0,300,200,15),t.lineStyle(3,3447003,.8),t.strokeRoundedRect(0,0,300,200,15),t.lineStyle(1,6139362,.3),t.strokeRoundedRect(4,4,292,192,12),t.generateTexture("panel",310,210),t.destroy()}createCardTextures(){[{key:"card_common",color:10395294},{key:"card_uncommon",color:5025616},{key:"card_rare",color:2201331},{key:"card_epic",color:10233776},{key:"card_legendary",color:16750592}].forEach(({key:e,color:t})=>{this.createCardTexture(e,t)})}createCardTexture(a,e){const s=this.scene.add.graphics();s.fillStyle(e,.3),s.fillRoundedRect(0,0,160,220,12),s.fillStyle(1973806,1),s.fillRoundedRect(4,4,152,212,10),s.fillStyle(e,1),s.fillRoundedRect(4,4,152,8,{tl:10,tr:10,bl:0,br:0}),s.lineStyle(2,e,.8),s.strokeRoundedRect(4,4,152,212,10),s.fillStyle(16777215,.05),s.fillRoundedRect(8,16,144,60,6),s.generateTexture(a,160,220),s.destroy()}createIconTextures(){const e=this.scene.add.graphics();e.fillStyle(15844367,1),e.beginPath(),e.moveTo(32/2,2),e.lineTo(28,32/3),e.lineTo(32/2,28),e.lineTo(4,32/3),e.closePath(),e.fillPath(),e.lineStyle(2,13937677,1),e.strokePath(),e.fillStyle(16777215,.4),e.fillTriangle(32/2,6,24,32/3,32/2,32/2),e.generateTexture("icon_gem",32,32),e.destroy();const t=this.scene.add.graphics();t.fillStyle(15528177,1),t.fillCircle(32/2,32/2,32/2-2),t.lineStyle(2,2899536,1),t.strokeCircle(32/2,32/2,32/2-2),t.lineStyle(2,15158332,1),t.beginPath(),t.moveTo(32/2,32/2),t.lineTo(32/2,6),t.strokePath(),t.beginPath(),t.moveTo(32/2,32/2),t.lineTo(24,32/2),t.strokePath(),t.generateTexture("icon_timer",32,32),t.destroy();const i=this.scene.add.graphics();i.fillStyle(3355443,.7),i.fillCircle(16,16,14),i.lineStyle(2,16777215,.5),i.strokeCircle(16,16,14),i.generateTexture("cooldown_bg",32,32),i.destroy()}generateParticleTextures(){const a=this.scene.add.graphics();a.fillStyle(16777215,1),a.fillCircle(8,8,6),a.generateTexture("particle_sprint",16,16),a.destroy();const e=this.scene.add.graphics();e.fillStyle(9139029,1),e.fillCircle(6,6,4),e.generateTexture("particle_dust",12,12),e.destroy(),[16739179,16697943,4774907,16752627,53971,5546239].forEach((o,n)=>{const r=this.scene.add.graphics();r.fillStyle(o,1),r.fillRect(0,0,8,4),r.generateTexture(`confetti_${n}`,8,4),r.destroy()});const i=this.scene.add.graphics();i.fillStyle(15844367,1),this.drawStar(i,10,10,5,10,4),i.generateTexture("particle_star",20,20),i.destroy();const s=this.scene.add.graphics();s.fillStyle(16777215,1),s.fillCircle(16,16,12),s.fillStyle(15844367,1),s.fillCircle(16,16,8),s.generateTexture("particle_burst",32,32),s.destroy()}drawStar(a,e,t,i,s,o){let n=Math.PI/2*3;const r=Math.PI/i;a.beginPath(),a.moveTo(e,t-s);for(let c=0;c<i;c++)a.lineTo(e+Math.cos(n)*s,t+Math.sin(n)*s),n+=r,a.lineTo(e+Math.cos(n)*o,t+Math.sin(n)*o),n+=r;a.lineTo(e,t-s),a.closePath(),a.fillPath()}generateEffectTextures(){const a=this.scene.add.graphics();a.lineStyle(4,16739179,1);for(let s=0;s<8;s++){const o=s/8*Math.PI*2,n=15,r=30;a.beginPath(),a.moveTo(32+Math.cos(o)*n,32+Math.sin(o)*n),a.lineTo(32+Math.cos(o)*r,32+Math.sin(o)*r),a.strokePath()}a.generateTexture("effect_tackle",64,64),a.destroy();const e=this.scene.add.graphics();for(let s=0;s<5;s++)e.fillStyle(4774907,.6-s*.1),e.fillEllipse(30-s*6,16,12-s*2,28-s*4);e.generateTexture("effect_dodge",40,32),e.destroy();const t=this.scene.add.graphics();t.fillStyle(15844367,.5),t.fillCircle(64,64,64),t.fillStyle(16777215,.3),t.fillCircle(64,64,40),t.generateTexture("effect_goal",128,128),t.destroy();const i=this.scene.add.graphics();i.lineStyle(4,3447003,.8),i.strokeCircle(24,24,20),i.lineStyle(2,6139362,.5),i.strokeCircle(24,24,16),i.generateTexture("effect_shield",48,48),i.destroy()}}class nt extends p.Scene{constructor(){super({key:"BootScene"});l(this,"loadingBar");l(this,"loadingText");l(this,"statusText");l(this,"errorText");l(this,"lastFile","none");l(this,"lastProgress",0);l(this,"lastProgressTime",0);l(this,"errors",[]);l(this,"hasStartedMenu",!1);l(this,"watchdogInterval")}init(){console.log("[BootScene] init"),this.lastProgressTime=Date.now(),this.hasStartedMenu=!1,this.errors=[],typeof window.__clearLoadingWatchdog=="function"&&(window.__clearLoadingWatchdog(),console.log("[BootScene] Cleared HTML loading watchdog")),this.setupErrorHandlers()}preload(){console.log("[BootScene] preload start"),this.createUI(),this.updateStatus("Starting loader..."),this.load.on("progress",t=>{console.log("[Loader] progress:",t),this.lastProgress=t,this.lastProgressTime=Date.now(),this.updateBar(t*.5)}),this.load.on("fileprogress",t=>{console.log("[Loader] fileprogress:",t.key),this.lastFile=t.key,this.lastProgressTime=Date.now(),this.updateStatus(`Loading: ${t.key}`)}),this.load.on("loaderror",t=>{const i=`Load error: ${t.key} (${t.url||"unknown"})`;console.error("[Loader]",i),this.addError(i)}),this.load.on("complete",()=>{console.log("[Loader] complete"),this.updateStatus("Loader complete"),this.updateBar(.5)});const e=this.load.totalToLoad;console.log("[BootScene] Total files to load:",e),e===0&&(console.log("[BootScene] No files to load, skipping loader"),this.updateBar(.5),this.updateStatus("No assets to load"))}create(){console.log("[BootScene] create start"),this.startWatchdog(),this.updateStatus("Generating textures..."),this.updateBar(.6);try{new ot(this).generateAll(),console.log("[BootScene] Textures generated"),this.updateStatus("Textures ready"),this.updateBar(.9)}catch(e){const t=`Texture error: ${e instanceof Error?e.message:String(e)}`;console.error("[BootScene]",t),this.addError(t),this.createFallbackTextures()}this.updateBar(1),this.updateStatus("Ready!"),setTimeout(()=>{this.startMenuScene()},300)}createUI(){const{width:e,height:t}=this.cameras.main,i=e/2,s=t/2;this.cameras.main.setBackgroundColor(1710638),this.add.text(i,s-120,"ðŸ‘ STICK & SHIFT",{fontFamily:"Arial, sans-serif",fontSize:"48px",color:"#f1c40f",fontStyle:"bold"}).setOrigin(.5),this.add.text(i,s-70,"Field Hockey Roguelike",{fontFamily:"Arial, sans-serif",fontSize:"20px",color:"#bdc3c7"}).setOrigin(.5);const o=300,n=24,r=this.add.graphics();r.fillStyle(2899536,1),r.fillRoundedRect(i-o/2,s,o,n,12),r.lineStyle(2,3447003,.8),r.strokeRoundedRect(i-o/2,s,o,n,12),this.loadingBar=this.add.graphics(),this.loadingText=this.add.text(i,s+50,"Loading...",{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#ecf0f1"}).setOrigin(.5),this.statusText=this.add.text(i,s+80,"",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7f8c8d"}).setOrigin(.5),this.errorText=this.add.text(i,s+130,"",{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#e74c3c",align:"center",wordWrap:{width:e-40}}).setOrigin(.5,0)}updateBar(e){const{width:t,height:i}=this.cameras.main,s=t/2,o=i/2,n=300,r=24,c=(n-8)*Math.min(e,1);this.loadingBar.clear(),c>0&&(this.loadingBar.fillStyle(2600544,1),this.loadingBar.fillRoundedRect(s-n/2+4,o+4,c,r-8,8)),this.loadingText.setText(`Loading... ${Math.round(e*100)}%`);const h=document.getElementById("loading-fill");h&&(h.style.width=`${e*100}%`)}updateStatus(e){console.log("[Status]",e),this.statusText&&this.statusText.setText(e),this.lastProgressTime=Date.now()}addError(e){this.errors.push(e),this.showErrors()}showErrors(){this.errorText&&this.errors.length>0&&this.errorText.setText(`âš ï¸ ERRORS:
`+this.errors.slice(-5).join(`
`))}setupErrorHandlers(){window.addEventListener("error",e=>{const t=`JS Error: ${e.message} at ${e.filename}:${e.lineno}`;console.error("[Global Error]",t),this.addError(t)}),window.addEventListener("unhandledrejection",e=>{const t=`Promise rejected: ${e.reason}`;console.error("[Unhandled Rejection]",t),this.addError(t)})}startWatchdog(){this.watchdogInterval=window.setInterval(()=>{const t=Date.now()-this.lastProgressTime;t>4e3&&!this.hasStartedMenu&&(console.warn("[Watchdog] Loading stalled!",{lastFile:this.lastFile,lastProgress:this.lastProgress,elapsed:t}),this.addError(`Loading stalled after ${(t/1e3).toFixed(1)}s (last: ${this.lastFile})`),setTimeout(()=>{this.hasStartedMenu||(console.log("[Watchdog] Force-starting MenuScene"),this.startMenuScene())},1e3))},250)}stopWatchdog(){this.watchdogInterval&&(clearInterval(this.watchdogInterval),this.watchdogInterval=void 0)}startMenuScene(){if(this.hasStartedMenu){console.log("[BootScene] Already started MenuScene, skipping");return}this.hasStartedMenu=!0,this.stopWatchdog(),console.log("[BootScene] Starting MenuScene");const e=document.getElementById("loading");e&&(e.style.display="none");try{this.scene.start("MenuScene"),console.log("[BootScene] MenuScene started successfully")}catch(t){const i=`Failed to start MenuScene: ${t instanceof Error?t.message:String(t)}`;console.error("[BootScene]",i),this.addError(i),this.statusText.setText("FATAL: Could not start game")}}createFallbackTextures(){console.log("[BootScene] Creating fallback textures");try{const e=this.add.graphics();for(let t=0;t<20;t++)e.clear(),e.fillStyle(3447003,1),e.fillCircle(24,24,20),e.lineStyle(2,2719929,1),e.strokeCircle(24,24,20),e.generateTexture(`player_${t}`,48,48);e.clear(),e.fillStyle(16777215,1),e.fillCircle(24,24,20),e.generateTexture("player_selected",48,48),["enemy_defender","enemy_mid","enemy_forward","enemy_boss","enemy_orange"].forEach(t=>{e.clear(),e.fillStyle(15158332,1),e.fillCircle(24,24,20),e.generateTexture(t,48,48)}),e.clear(),e.fillStyle(16777215,1),e.fillCircle(10,10,8),e.generateTexture("ball",20,20),e.clear(),e.fillStyle(16777215,.5),e.fillCircle(6,6,5),e.generateTexture("ball_trail",12,12),e.clear(),e.fillStyle(16777215,1),e.fillCircle(8,8,6),e.generateTexture("particle_sprint",16,16),e.generateTexture("particle_dust",12,12),e.generateTexture("particle_burst",32,32),e.generateTexture("particle_star",20,20);for(let t=0;t<6;t++)e.clear(),e.fillStyle([16739179,16697943,4774907,16752627,53971,5546239][t],1),e.fillRect(0,0,8,4),e.generateTexture(`confetti_${t}`,8,4);e.clear(),e.fillStyle(4774907,.5),e.fillCircle(24,24,20),e.generateTexture("effect_shield",48,48),e.generateTexture("effect_tackle",64,64),e.generateTexture("effect_dodge",40,32),e.generateTexture("effect_goal",128,128),e.clear(),e.fillStyle(3447003,1),e.fillRoundedRect(0,0,200,50,10),e.generateTexture("btn_normal",208,58),e.generateTexture("btn_hover",208,58),e.generateTexture("btn_pressed",208,58),e.generateTexture("btn_disabled",208,58),e.clear(),e.fillStyle(1710638,.9),e.fillRoundedRect(0,0,300,200,15),e.generateTexture("panel",310,210),["common","uncommon","rare","epic","legendary"].forEach(t=>{e.clear(),e.fillStyle(1973806,1),e.fillRoundedRect(0,0,160,220,10),e.generateTexture(`card_${t}`,160,220)}),e.clear(),e.fillStyle(15844367,1),e.fillCircle(16,16,12),e.generateTexture("icon_gem",32,32),e.generateTexture("icon_timer",32,32),e.generateTexture("cooldown_bg",32,32),e.clear(),e.fillStyle(2263842,1),e.fillRect(0,0,64,64),e.generateTexture("turf",64,64),e.clear(),e.fillStyle(16777215,1),e.fillRect(0,0,100,4),e.generateTexture("line_h",100,4),e.generateTexture("line_v",4,100),e.clear(),e.lineStyle(4,16777215,1),e.strokeCircle(100,100,96),e.generateTexture("circle",200,200),e.generateTexture("d_right",80,150),e.generateTexture("d_left",80,150),e.clear(),e.fillStyle(3355443,1),e.fillRect(0,0,40,120),e.generateTexture("goal_left",40,120),e.generateTexture("goal_right",40,120),e.destroy(),console.log("[BootScene] Fallback textures created")}catch(e){console.error("[BootScene] Failed to create fallback textures:",e)}}}class E extends p.GameObjects.Container{constructor(e,t){super(e,t.x,t.y);l(this,"bg");l(this,"bgGlow");l(this,"label");l(this,"isDisabled",!1);l(this,"isHovered",!1);l(this,"isPressed",!1);l(this,"onClick");l(this,"originalScale",1);l(this,"colors");const i=t.width||200,s=t.height||50;this.onClick=t.onClick,this.isDisabled=t.disabled||!1;const o={primary:{normal:3447003,hover:6139362,pressed:2388387,disabled:8359053},secondary:{normal:9807270,hover:12436423,pressed:8359053,disabled:5662067},danger:{normal:15158332,hover:15495267,pressed:12597547,disabled:8359053},success:{normal:2600544,hover:3066993,pressed:1999945,disabled:8359053}};this.colors=o[t.style||"primary"],this.bgGlow=e.add.rectangle(0,3,i+4,s+4,0,.3),this.bgGlow.setOrigin(.5),this.add(this.bgGlow),this.bg=e.add.rectangle(0,0,i,s,this.isDisabled?this.colors.disabled:this.colors.normal),this.bg.setOrigin(.5),this.bg.setStrokeStyle(2,16777215,.3),this.add(this.bg);const n=e.add.rectangle(0,-s/4,i-10,s/3,16777215,.15);n.setOrigin(.5),this.add(n),this.label=e.add.text(0,0,t.text,{fontFamily:"Arial, sans-serif",fontSize:`${t.fontSize||18}px`,color:"#ffffff",fontStyle:"bold"}),this.label.setOrigin(.5),this.add(this.label),this.setSize(i,s),this.setInteractive({useHandCursor:!this.isDisabled}),this.on("pointerover",this.onPointerOver,this),this.on("pointerout",this.onPointerOut,this),this.on("pointerdown",this.onPointerDown,this),this.on("pointerup",this.onPointerUp,this),e.add.existing(this)}onPointerOver(){this.isDisabled||(this.isHovered=!0,this.bg.setFillStyle(this.colors.hover),this.scene.tweens.add({targets:this,scaleX:1.05,scaleY:1.05,duration:100,ease:"Power2"}))}onPointerOut(){this.isDisabled||(this.isHovered=!1,this.isPressed=!1,this.bg.setFillStyle(this.colors.normal),this.scene.tweens.add({targets:this,scaleX:this.originalScale,scaleY:this.originalScale,duration:100,ease:"Power2"}))}onPointerDown(){this.isDisabled||(this.isPressed=!0,this.bg.setFillStyle(this.colors.pressed),this.scene.tweens.add({targets:this,scaleX:.95,scaleY:.95,duration:50,ease:"Power2"}),this.scene.audioSystem&&this.scene.audioSystem.playClick())}onPointerUp(){this.isDisabled||!this.isPressed||(this.isPressed=!1,this.bg.setFillStyle(this.isHovered?this.colors.hover:this.colors.normal),this.scene.tweens.add({targets:this,scaleX:this.isHovered?1.05:this.originalScale,scaleY:this.isHovered?1.05:this.originalScale,duration:100,ease:"Back.easeOut"}),this.onClick&&this.onClick())}setDisabled(e){return this.isDisabled=e,this.bg.setFillStyle(e?this.colors.disabled:this.colors.normal),this.setInteractive({useHandCursor:!e}),this.label.setAlpha(e?.5:1),this}setText(e){return this.label.setText(e),this}setCallback(e){return this.onClick=e,this}pulse(){this.scene.tweens.add({targets:this,scaleX:1.1,scaleY:1.1,duration:200,yoyo:!0,repeat:2,ease:"Sine.easeInOut"})}shake(){const e=this.x;this.scene.tweens.add({targets:this,x:e+5,duration:50,yoyo:!0,repeat:3,ease:"Sine.easeInOut",onComplete:()=>{this.x=e}})}}class Xs extends p.GameObjects.Container{constructor(e,t,i,s,o,n=40){super(e,t,i);l(this,"bg");l(this,"icon");l(this,"onClick");l(this,"isDisabled",!1);this.onClick=o,this.bg=e.add.circle(0,0,n/2,3447003),this.bg.setStrokeStyle(2,16777215,.3),this.add(this.bg),this.icon=e.add.text(0,0,s,{fontFamily:"Arial, sans-serif",fontSize:`${n*.5}px`}),this.icon.setOrigin(.5),this.add(this.icon),this.setSize(n,n),this.setInteractive({useHandCursor:!0}),this.on("pointerover",()=>{this.isDisabled||(this.bg.setFillStyle(6139362),e.tweens.add({targets:this,scaleX:1.1,scaleY:1.1,duration:100}))}),this.on("pointerout",()=>{this.isDisabled||(this.bg.setFillStyle(3447003),e.tweens.add({targets:this,scaleX:1,scaleY:1,duration:100}))}),this.on("pointerdown",()=>{!this.isDisabled&&this.onClick&&(e.tweens.add({targets:this,scaleX:.9,scaleY:.9,duration:50,yoyo:!0}),this.onClick())}),e.add.existing(this)}setDisabled(e){return this.isDisabled=e,this.bg.setFillStyle(e?8359053:3447003),this.icon.setAlpha(e?.5:1),this}}const ye="stick_and_shift_save",Q=1,X={version:Q,gems:0,unlockedCharacters:["alex","maya"],completedChallenges:[],metaUpgradeLevels:{},stats:{totalRuns:0,totalMomentsWon:0,totalMomentsLost:0,totalGoals:0,totalReboundGoals:0,totalTackles:0,totalSteals:0,totalPasses:0,totalAssists:0,totalDodges:0,totalBossWins:0,totalGemsEarned:0,cleanSheets:0,perfectMoments:0,hasSeenTutorial:0,aimAssistStrength:50,uniqueCharactersPlayed:[],uniqueBossesDefeated:[]},settings:{musicVolume:.5,sfxVolume:.7,screenShake:!0,showDamageNumbers:!0}},U=class U{constructor(){l(this,"data");this.data=this.load()}static getInstance(){return U.instance||(U.instance=new U),U.instance}load(){try{const a=localStorage.getItem(ye);if(a){const e=JSON.parse(a);return e.version<Q?this.migrate(e):this.mergeWithDefaults(e)}}catch(a){console.warn("Failed to load save data, using defaults:",a)}return{...X}}migrate(a){return console.log(`Migrating save from version ${a.version} to ${Q}`),this.mergeWithDefaults({...a,version:Q})}mergeWithDefaults(a){return{...X,...a,stats:{...X.stats,...a.stats||{}},settings:{...X.settings,...a.settings||{}}}}save(){try{localStorage.setItem(ye,JSON.stringify(this.data))}catch(a){console.error("Failed to save data:",a)}}getGems(){return this.data.gems}addGems(a){this.data.gems+=a,this.data.stats.totalGemsEarned+=a,this.save()}spendGems(a){return this.data.gems>=a?(this.data.gems-=a,this.save(),!0):!1}getUnlockedCharacters(){return[...this.data.unlockedCharacters]}isCharacterUnlocked(a){return this.data.unlockedCharacters.includes(a)}unlockCharacter(a){this.data.unlockedCharacters.includes(a)||(this.data.unlockedCharacters.push(a),this.save())}getCompletedChallenges(){return[...this.data.completedChallenges]}isChallengeCompleted(a){return this.data.completedChallenges.includes(a)}completeChallenge(a){this.data.completedChallenges.includes(a)||(this.data.completedChallenges.push(a),this.save())}getMetaUpgradeLevel(a){return this.data.metaUpgradeLevels[a]||0}setMetaUpgradeLevel(a,e){this.data.metaUpgradeLevels[a]=e,this.save()}getStats(){return{...this.data.stats}}getStat(a){return this.data.stats[a]}setStat(a,e){typeof this.data.stats[a]=="number"&&(this.data.stats[a]=e,this.save())}incrementStat(a,e=1){typeof this.data.stats[a]=="number"&&(this.data.stats[a]+=e,this.save())}addUniqueToStat(a,e){this.data.stats[a].includes(e)||(this.data.stats[a].push(e),this.save())}getSettings(){return{...this.data.settings}}updateSettings(a){this.data.settings={...this.data.settings,...a},this.save()}getLastPlayedCharacter(){return this.data.lastPlayedCharacter}setLastPlayedCharacter(a){this.data.lastPlayedCharacter=a,this.save()}reset(){this.data={...X},this.save()}exportSave(){return JSON.stringify(this.data)}importSave(a){try{const e=JSON.parse(a);return this.data=this.mergeWithDefaults(e),this.save(),!0}catch{return!1}}};l(U,"instance");let C=U;class V{constructor(a){l(this,"scene");l(this,"musicVolume",.5);l(this,"sfxVolume",.7);l(this,"audioContext");this.scene=a;const e=C.getInstance().getSettings();this.musicVolume=e.musicVolume,this.sfxVolume=e.sfxVolume;try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)}catch{console.warn("Web Audio API not supported")}}playTone(a,e,t="sine",i=1){if(!(!this.audioContext||this.sfxVolume===0))try{const s=this.audioContext.createOscillator(),o=this.audioContext.createGain();s.type=t,s.frequency.setValueAtTime(a,this.audioContext.currentTime),o.gain.setValueAtTime(i*this.sfxVolume*.3,this.audioContext.currentTime),o.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+e),s.connect(o),o.connect(this.audioContext.destination),s.start(),s.stop(this.audioContext.currentTime+e)}catch{}}playChord(a,e,t="sine"){a.forEach(i=>this.playTone(i,e,t,.5))}playNoise(a,e=.5){if(!(!this.audioContext||this.sfxVolume===0))try{const t=this.audioContext.sampleRate*a,i=this.audioContext.createBuffer(1,t,this.audioContext.sampleRate),s=i.getChannelData(0);for(let r=0;r<t;r++)s[r]=(Math.random()*2-1)*Math.exp(-r/(t*.3));const o=this.audioContext.createBufferSource(),n=this.audioContext.createGain();o.buffer=i,n.gain.setValueAtTime(e*this.sfxVolume*.3,this.audioContext.currentTime),o.connect(n),n.connect(this.audioContext.destination),o.start()}catch{}}playClick(){this.playTone(800,.05,"square")}playHover(){this.playTone(600,.03,"sine",.3)}playShoot(){this.playTone(200,.15,"sawtooth"),this.playNoise(.1,.4)}playPass(){this.playTone(400,.1,"triangle")}playTackle(){this.playNoise(.15,.6),this.playTone(150,.1,"square")}playSteal(){this.playTone(500,.08,"square"),this.playTone(700,.08,"square")}playDodge(){this.playTone(600,.1,"sine"),this.playTone(800,.08,"sine")}playGoal(){this.playChord([523.25,659.25,783.99],.3),setTimeout(()=>this.playChord([587.33,739.99,880],.3),200),setTimeout(()=>this.playChord([659.25,830.61,987.77],.5),400)}playConcede(){this.playChord([220,261.63,311.13],.5)}playUpgrade(){this.playTone(440,.1,"sine"),setTimeout(()=>this.playTone(554.37,.1,"sine"),100),setTimeout(()=>this.playTone(659.25,.15,"sine"),200)}playPowerUp(){for(let a=0;a<5;a++)setTimeout(()=>this.playTone(400+a*100,.08,"sine"),a*50)}playError(){this.playTone(200,.1,"square"),setTimeout(()=>this.playTone(150,.15,"square"),100)}playSuccess(){this.playTone(523.25,.1,"sine"),setTimeout(()=>this.playTone(659.25,.15,"sine"),100)}playTimer(){this.playTone(880,.05,"sine")}playBossAppear(){this.playTone(100,.3,"sawtooth"),this.playNoise(.2,.5)}playMomentStart(){this.playTone(440,.1,"sine"),setTimeout(()=>this.playTone(440,.1,"sine"),150),setTimeout(()=>this.playTone(660,.2,"sine"),300)}playMomentEnd(){this.playChord([392,493.88,587.33],.4)}playWhistle(){this.playTone(1e3,.2,"sine"),setTimeout(()=>this.playTone(800,.3,"sine"),200)}setMusicVolume(a){this.musicVolume=p.Math.Clamp(a,0,1),C.getInstance().updateSettings({musicVolume:this.musicVolume})}setSfxVolume(a){this.sfxVolume=p.Math.Clamp(a,0,1),C.getInstance().updateSettings({sfxVolume:this.sfxVolume})}getMusicVolume(){return this.musicVolume}getSfxVolume(){return this.sfxVolume}resume(){this.audioContext&&this.audioContext.state==="suspended"&&this.audioContext.resume()}}const Se=[{id:"first_goal",name:"First Blood",description:"Score your first goal",category:"scoring",target:1,reward:{gems:50},icon:"âš½",difficulty:"easy"},{id:"score_3_match",name:"Hat Trick",description:"Score 3 goals in a single match",category:"scoring",target:3,reward:{gems:150},icon:"ðŸŽ©",difficulty:"medium"},{id:"score_5_match",name:"Superstar",description:"Score 5 goals in a single match",category:"scoring",target:5,reward:{gems:300,upgradeId:"slap_shot_boost"},icon:"â­",difficulty:"hard"},{id:"total_goals_10",name:"Goal Getter",description:"Score 10 total goals",category:"scoring",target:10,reward:{gems:100},icon:"ðŸ¥…",difficulty:"easy"},{id:"total_goals_50",name:"Prolific Scorer",description:"Score 50 total goals",category:"scoring",target:50,reward:{gems:500},icon:"ðŸ†",difficulty:"medium"},{id:"first_tackle",name:"First Tackle",description:"Win your first tackle",category:"defense",target:1,reward:{gems:30},icon:"âš”ï¸",difficulty:"easy"},{id:"tackle_5_match",name:"Tackle Machine",description:"Win 5 tackles in a single match",category:"defense",target:5,reward:{gems:100},icon:"ðŸ›¡ï¸",difficulty:"medium"},{id:"total_tackles_25",name:"Ball Winner",description:"Win 25 total tackles",category:"defense",target:25,reward:{gems:200,upgradeId:"crunch_tackle"},icon:"ðŸ’ª",difficulty:"medium"},{id:"clean_sheet",name:"Clean Sheet",description:"Complete a moment without conceding",category:"defense",target:1,reward:{gems:100},icon:"ðŸ§¤",difficulty:"medium"},{id:"assist_first",name:"Team Player",description:"Get your first assist",category:"skill",target:1,reward:{gems:50},icon:"ðŸ¤",difficulty:"easy"},{id:"total_assists_10",name:"Playmaker",description:"Get 10 total assists",category:"skill",target:10,reward:{gems:200},icon:"ðŸ“",difficulty:"medium"},{id:"dodge_10_match",name:"Untouchable",description:"Dodge 10 times in a single match",category:"skill",target:10,reward:{gems:100},icon:"ðŸ’¨",difficulty:"medium"},{id:"win_no_dash",name:"Conservative",description:"Win a moment without dashing",category:"skill",target:1,reward:{gems:150},icon:"ðŸš¶",difficulty:"hard"},{id:"rebound_goal",name:"Rebound King",description:"Score a rebound goal",category:"special",target:1,reward:{gems:100},icon:"ðŸ”„",difficulty:"medium"},{id:"comeback",name:"Comeback Kid",description:"Win after being 2 goals down",category:"special",target:1,reward:{gems:200},icon:"ðŸ”¥",difficulty:"hard"},{id:"perfect_moment",name:"Perfect Moment",description:"Complete a moment with 3+ goals and 0 conceded",category:"special",target:1,reward:{gems:300,upgradeId:"fragile_genius"},icon:"âœ¨",difficulty:"hard"}];class rt extends p.Scene{constructor(){super({key:"MenuScene"});l(this,"audioSystem");l(this,"gemDisplay")}create(){this.audioSystem=new V(this),this.input.once("pointerdown",()=>{this.audioSystem.resume()}),this.cameras.main.setBackgroundColor(1710638),this.createBackground(),this.createTitle(),this.createMenuButtons(),this.createGemDisplay(),this.cameras.main.fadeIn(300),this.add.text(10,this.cameras.main.height-20,"v1.0.0",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7f8c8d"})}createBackground(){const e=this.add.graphics();for(let t=0;t<this.cameras.main.height;t+=40){const i=t%80===0?1976862:1713690;e.fillStyle(i,.3),e.fillRect(0,t,this.cameras.main.width,40)}this.createFloatingElements()}createFloatingElements(){const e=["ðŸ‘","âš½","ðŸ¥…","ðŸ†"];for(let t=0;t<8;t++){const i=Math.random()*this.cameras.main.width,s=Math.random()*this.cameras.main.height,o=e[Math.floor(Math.random()*e.length)],n=this.add.text(i,s,o,{fontSize:"32px"});n.setAlpha(.1),this.tweens.add({targets:n,y:s+30,duration:2e3+Math.random()*2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.tweens.add({targets:n,x:i+(Math.random()-.5)*50,duration:3e3+Math.random()*2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}}createTitle(){const e=this.cameras.main.centerX,t=this.add.text(e,100,"ðŸ‘ STICK & SHIFT",{fontFamily:"Arial, sans-serif",fontSize:"56px",color:"#f1c40f",fontStyle:"bold",stroke:"#000000",strokeThickness:4});t.setOrigin(.5),this.tweens.add({targets:t,scaleX:1.02,scaleY:1.02,duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.add.text(e,160,"Field Hockey Roguelike",{fontFamily:"Arial, sans-serif",fontSize:"24px",color:"#bdc3c7"}).setOrigin(.5)}createMenuButtons(){const e=this.cameras.main.centerX,t=240,i=60;new E(this,{x:e,y:t,width:250,height:55,text:"â–¶ PLAY",fontSize:24,style:"success",onClick:()=>{this.audioSystem.playClick(),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CharacterSelectScene")})}}),new E(this,{x:e,y:t+i,width:250,height:50,text:"ðŸ›’ STORE",fontSize:22,onClick:()=>{this.audioSystem.playClick(),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("StoreScene")})}});const s=C.getInstance().getCompletedChallenges().length,o=Se.length;new E(this,{x:e,y:t+i*2,width:250,height:50,text:`ðŸŽ¯ CHALLENGES (${s}/${o})`,fontSize:18,onClick:()=>{this.audioSystem.playClick(),this.showChallenges()}}),new E(this,{x:e,y:t+i*3,width:250,height:50,text:"ðŸŽ® CONTROLS",fontSize:22,onClick:()=>{this.audioSystem.playClick(),this.showControls()}}),new E(this,{x:e,y:t+i*4,width:250,height:50,text:"âš™ï¸ SETTINGS",fontSize:22,style:"secondary",onClick:()=>{this.audioSystem.playClick(),this.showSettings()}})}createGemDisplay(){const e=C.getInstance().getGems();this.gemDisplay=this.add.container(this.cameras.main.width-120,30);const t=this.add.graphics();t.fillStyle(1710638,.9),t.fillRoundedRect(-60,-20,120,40,10),t.lineStyle(2,15844367,.5),t.strokeRoundedRect(-60,-20,120,40,10),this.gemDisplay.add(t);const i=this.add.text(-40,0,"ðŸ’Ž",{fontSize:"20px"});i.setOrigin(.5),this.gemDisplay.add(i);const s=this.add.text(10,0,e.toString(),{fontFamily:"Arial, sans-serif",fontSize:"20px",color:"#f1c40f",fontStyle:"bold"});s.setOrigin(.5),this.gemDisplay.add(s)}showChallenges(){const e=this.add.rectangle(this.cameras.main.centerX,this.cameras.main.centerY,this.cameras.main.width,this.cameras.main.height,0,.8);e.setInteractive();const t=this.add.container(this.cameras.main.centerX,this.cameras.main.centerY),i=this.add.graphics();i.fillStyle(1710638,1),i.fillRoundedRect(-300,-250,600,500,20),i.lineStyle(3,15965202,.8),i.strokeRoundedRect(-300,-250,600,500,20),t.add(i);const s=this.add.text(0,-220,"ðŸŽ¯ CHALLENGES",{fontFamily:"Arial, sans-serif",fontSize:"28px",color:"#f39c12",fontStyle:"bold"});s.setOrigin(.5),t.add(s);const o=C.getInstance().getCompletedChallenges();Se.slice(0,8).forEach((c,h)=>{const d=o.includes(c.id),m=-150+h*50,f=this.add.text(-270,m,d?"âœ…":c.icon,{fontSize:"24px"});t.add(f);const u=this.add.text(-230,m,c.name,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:d?"#27ae60":"#ffffff",fontStyle:d?"normal":"bold"});u.setOrigin(0,.5),t.add(u);const g=this.add.text(-230,m+18,c.description,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7f8c8d"});g.setOrigin(0,.5),t.add(g);const y=this.add.text(250,m,`ðŸ’Ž ${c.reward.gems}`,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#f1c40f"});y.setOrigin(1,.5),t.add(y)});const r=new E(this,{x:this.cameras.main.centerX,y:this.cameras.main.centerY+220,width:150,height:45,text:"Close",style:"secondary",onClick:()=>{e.destroy(),t.destroy(),r.destroy()}})}showControls(){const e=this.cameras.main.width,t=this.cameras.main.height,i=this.add.rectangle(this.cameras.main.centerX,this.cameras.main.centerY,e,t,0,.8);i.setInteractive();const s=this.add.container(this.cameras.main.centerX,this.cameras.main.centerY),o=this.add.graphics();o.fillStyle(1710638,1),o.fillRoundedRect(-250,-220,500,440,20),o.lineStyle(3,3447003,.8),o.strokeRoundedRect(-250,-220,500,440,20),s.add(o);const n=this.add.text(0,-190,"ðŸŽ® CONTROLS",{fontFamily:"Arial, sans-serif",fontSize:"28px",color:"#3498db",fontStyle:"bold"});n.setOrigin(.5),s.add(n);const r=[{key:"WASD / Arrow Keys",action:"Move your player"},{key:"SPACE / Left Click",action:"Shoot the ball (with possession)"},{key:"E",action:"Pass to nearest teammate"},{key:"Q",action:"Tackle (lunge to steal ball)"},{key:"SHIFT",action:"Dodge / Sidestep with i-frames"},{key:"Mouse",action:"Aim direction"},{key:"ESC / P",action:"Pause the game"},{key:"H",action:"Toggle controls help (in-game)"}],c=-130;r.forEach((m,f)=>{const u=c+f*40,g=this.add.graphics();g.fillStyle(2899536,1),g.fillRoundedRect(-220,u-14,160,28,6),s.add(g);const y=this.add.text(-140,u,m.key,{fontFamily:"monospace",fontSize:"12px",color:"#3498db",fontStyle:"bold"});y.setOrigin(.5),s.add(y);const b=this.add.text(-40,u,m.action,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#ecf0f1"});b.setOrigin(0,.5),s.add(b)});const h=this.add.text(0,160,"ðŸ’¡ TIP: When using keyboard only, shots auto-aim toward the goal!",{fontFamily:"Arial, sans-serif",fontSize:"13px",color:"#f39c12",wordWrap:{width:420},align:"center"});h.setOrigin(.5),s.add(h);const d=new E(this,{x:this.cameras.main.centerX,y:this.cameras.main.centerY+195,width:150,height:45,text:"Got It!",style:"success",onClick:()=>{this.audioSystem.playClick(),i.destroy(),s.destroy(),d.destroy()}})}showSettings(){const e=C.getInstance().getSettings(),t=this.add.rectangle(this.cameras.main.centerX,this.cameras.main.centerY,this.cameras.main.width,this.cameras.main.height,0,.8);t.setInteractive();const i=this.add.container(this.cameras.main.centerX,this.cameras.main.centerY),s=this.add.graphics();s.fillStyle(1710638,1),s.fillRoundedRect(-200,-180,400,360,20),s.lineStyle(3,3447003,.8),s.strokeRoundedRect(-200,-180,400,360,20),i.add(s);const o=this.add.text(0,-150,"âš™ï¸ SETTINGS",{fontFamily:"Arial, sans-serif",fontSize:"28px",color:"#3498db",fontStyle:"bold"});o.setOrigin(.5),i.add(o);const n=this.add.text(-150,-80,"Music Volume:",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#ffffff"});i.add(n);const r=this.add.text(120,-80,`${Math.round(e.musicVolume*100)}%`,{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#f1c40f"});i.add(r);const c=this.add.text(-150,-30,"SFX Volume:",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#ffffff"});i.add(c);const h=this.add.text(120,-30,`${Math.round(e.sfxVolume*100)}%`,{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#f1c40f"});i.add(h);const d=this.add.text(-150,20,"Screen Shake:",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#ffffff"});i.add(d);const m=this.add.text(120,20,e.screenShake?"ON":"OFF",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:e.screenShake?"#27ae60":"#e74c3c"});m.setInteractive({useHandCursor:!0}),m.on("pointerdown",()=>{const y=!C.getInstance().getSettings().screenShake;C.getInstance().updateSettings({screenShake:y}),m.setText(y?"ON":"OFF"),m.setColor(y?"#27ae60":"#e74c3c")}),i.add(m);const f=this.add.text(0,80,"CONTROLS",{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#bdc3c7",fontStyle:"bold"});f.setOrigin(.5),i.add(f);const u=this.add.text(0,120,`WASD/Arrows - Move
SPACE - Shoot
E - Pass
Q - Tackle
SHIFT - Dodge`,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#7f8c8d",align:"center"});u.setOrigin(.5),i.add(u);const g=new E(this,{x:this.cameras.main.centerX,y:this.cameras.main.centerY+155,width:150,height:45,text:"Close",style:"secondary",onClick:()=>{t.destroy(),i.destroy(),g.destroy()}})}}const J=[{id:"alex",name:"Alex Chen",role:"midfielder",description:"A balanced all-rounder with no major weaknesses.",stats:{speed:6,stamina:6,control:6,shotPower:6,passPower:6,tackle:6,dodge:5},trait:{name:"Versatile",description:"+5% to all stats",effect:"versatile"},downside:{name:"Jack of All",description:"No stat can exceed 8",effect:"statCap8"},unlockCost:0,color:3447003},{id:"maya",name:"Maya Santos",role:"forward",description:"Lightning fast striker with a killer instinct.",stats:{speed:9,stamina:5,control:5,shotPower:7,passPower:4,tackle:3,dodge:7},trait:{name:"Speed Demon",description:"Sprint costs no stamina",effect:"freeSprintStamina"},downside:{name:"Glass Cannon",description:"Takes 50% longer to recover from tackles",effect:"slowTackleRecovery"},unlockCost:0,color:15158332},{id:"bruno",name:"Bruno Weber",role:"defender",description:"Rock-solid defender who never gives up.",stats:{speed:4,stamina:8,control:5,shotPower:5,passPower:6,tackle:9,dodge:3},trait:{name:"Iron Wall",description:"+30% tackle range",effect:"extendedTackle"},downside:{name:"Heavy Feet",description:"-20% dodge distance",effect:"shortDodge"},unlockCost:100,color:3066993},{id:"priya",name:"Priya Sharma",role:"midfielder",description:"Master of the drag flick and aerial play.",stats:{speed:5,stamina:6,control:8,shotPower:8,passPower:7,tackle:4,dodge:5},trait:{name:"Drag Flick Master",description:"Shots from circles have +40% power",effect:"circleShot"},downside:{name:"Set Piece Only",description:"-15% shot power outside circles",effect:"weakOpenShot"},unlockCost:150,color:10181046},{id:"james",name:"James O'Brien",role:"forward",description:"Tricky winger who loves to dribble.",stats:{speed:7,stamina:5,control:9,shotPower:5,passPower:5,tackle:4,dodge:8},trait:{name:"Silky Skills",description:"Double dodge i-frames",effect:"extendedIframes"},downside:{name:"Show-off",description:"Passes have 10% chance to bobble",effect:"passError"},unlockCost:200,color:15965202},{id:"lin",name:"Lin Xiaoming",role:"midfielder",description:"Vision and passing genius.",stats:{speed:5,stamina:6,control:7,shotPower:4,passPower:10,tackle:5,dodge:5},trait:{name:"Quarterback",description:"Passes auto-target teammates",effect:"autoTargetPass"},downside:{name:"Weak Shot",description:"-25% shot power",effect:"weakShot"},unlockCost:250,color:1752220},{id:"sarah",name:"Sarah Mitchell",role:"defender",description:"Aggressive defender with great interceptions.",stats:{speed:6,stamina:7,control:5,shotPower:5,passPower:5,tackle:8,dodge:4},trait:{name:"Interceptor",description:"+50% steal radius when ball is loose",effect:"magnetSteal"},downside:{name:"Reckless",description:"Missed tackles have longer cooldown",effect:"longTackleCd"},unlockCost:175,color:15105570},{id:"kofi",name:"Kofi Asante",role:"forward",description:"Powerful striker with thunderous shots.",stats:{speed:5,stamina:6,control:5,shotPower:10,passPower:5,tackle:4,dodge:4},trait:{name:"Cannon Foot",description:"Shots can knock back goalies",effect:"knockbackShot"},downside:{name:"Slow Windup",description:"Shots take 20% longer to charge",effect:"slowShot"},unlockCost:300,color:9323693},{id:"emma",name:"Emma de Vries",role:"goalkeeper",description:"Exceptional goalkeeper with quick reflexes.",stats:{speed:4,stamina:7,control:6,shotPower:6,passPower:7,tackle:6,dodge:6},trait:{name:"Cat Reflexes",description:"+40% save radius when in goal",effect:"expandedGoal"},downside:{name:"Stay Home",description:"-30% speed outside D",effect:"slowOutsideD"},unlockCost:350,color:15844367},{id:"raj",name:"Raj Patel",role:"midfielder",description:"Tireless runner who never stops pressing.",stats:{speed:7,stamina:10,control:5,shotPower:5,passPower:6,tackle:6,dodge:5},trait:{name:"Engine",description:"Stamina regens 2x faster",effect:"fastStamina"},downside:{name:"Tunnel Vision",description:"-15% tackle success from behind",effect:"weakBackTackle"},unlockCost:200,color:1482885},{id:"olivia",name:"Olivia Hart",role:"forward",description:"Lucky striker who finds the net somehow.",stats:{speed:6,stamina:5,control:5,shotPower:6,passPower:5,tackle:4,dodge:6},trait:{name:"Lucky Star",description:"15% chance for deflected shots to score",effect:"luckyDeflect"},downside:{name:"Inconsistent",description:"Stats vary Â±15% each moment",effect:"statVariance"},unlockCost:400,color:12597547},{id:"diego",name:"Diego Fernandez",role:"midfielder",description:"Aggressive tackler who wins the ball.",stats:{speed:6,stamina:6,control:4,shotPower:5,passPower:5,tackle:9,dodge:5},trait:{name:"Ball Hunter",description:"Successful tackles give brief speed boost",effect:"tackleSpeed"},downside:{name:"Foul Prone",description:"10% chance tackles give opponent free hit",effect:"foulRisk"},unlockCost:225,color:2600544},{id:"yuki",name:"Yuki Tanaka",role:"forward",description:"Quick thinker with exceptional awareness.",stats:{speed:7,stamina:5,control:7,shotPower:6,passPower:7,tackle:4,dodge:7},trait:{name:"Sixth Sense",description:"See enemy positions on minimap",effect:"minimap"},downside:{name:"Fragile",description:"Stunned 25% longer from tackles",effect:"longStun"},unlockCost:275,color:13849600},{id:"hans",name:"Hans Mueller",role:"defender",description:"Tactical genius who reads the game.",stats:{speed:5,stamina:7,control:6,shotPower:5,passPower:8,tackle:7,dodge:4},trait:{name:"Playmaker",description:"Passes to forwards give them brief buff",effect:"passBuff"},downside:{name:"Slow Turner",description:"-20% rotation speed",effect:"slowTurn"},unlockCost:325,color:2719929},{id:"zara",name:"Zara Mohammed",role:"midfielder",description:"Acrobatic midfielder with flashy moves.",stats:{speed:7,stamina:5,control:6,shotPower:6,passPower:5,tackle:5,dodge:9},trait:{name:"Acrobat",description:"Dodge can be chained twice",effect:"doubleDodge"},downside:{name:"Showboat",description:"Stamina drains faster",effect:"fastStaminaDrain"},unlockCost:450,color:10181046},{id:"marcus",name:"Marcus Johnson",role:"forward",description:"Physical presence in the circle.",stats:{speed:4,stamina:8,control:5,shotPower:8,passPower:4,tackle:7,dodge:3},trait:{name:"Tank",description:"Cannot be knocked back while shooting",effect:"stableShot"},downside:{name:"Sluggish",description:"-25% acceleration",effect:"slowAccel"},unlockCost:350,color:3426654},{id:"anja",name:"Anja Petrov",role:"defender",description:"Long-range specialist from the back.",stats:{speed:5,stamina:6,control:5,shotPower:7,passPower:9,tackle:6,dodge:4},trait:{name:"Long Ball",description:"+50% pass range",effect:"longPass"},downside:{name:"Short Stick",description:"-20% tackle range",effect:"shortTackle"},unlockCost:280,color:15277667},{id:"tom",name:"Tom Williams",role:"midfielder",description:"Penalty corner expert.",stats:{speed:5,stamina:6,control:7,shotPower:8,passPower:7,tackle:5,dodge:5},trait:{name:"PC Specialist",description:"+50% power on penalty corners",effect:"pcPower"},downside:{name:"Set Piece Only",description:"-10% stats in open play",effect:"weakOpenPlay"},unlockCost:375,color:48340},{id:"nina",name:"Nina Johansson",role:"forward",description:"Ice cold finisher under pressure.",stats:{speed:6,stamina:5,control:7,shotPower:7,passPower:5,tackle:4,dodge:6},trait:{name:"Clutch",description:"+30% shot power when behind",effect:"clutchShot"},downside:{name:"Complacent",description:"-15% all stats when leading",effect:"leadDebuff"},unlockCost:425,color:6765239},{id:"ben",name:"Ben O'Connor",role:"goalkeeper",description:"Sweeper keeper who loves to roam.",stats:{speed:7,stamina:6,control:6,shotPower:5,passPower:7,tackle:7,dodge:5},trait:{name:"Sweeper",description:"Full speed anywhere on field",effect:"fullSpeed"},downside:{name:"Wanderer",description:"-25% save rate in goal",effect:"weakInGoal"},unlockCost:500,color:16733986}];function ke(k){return J.find(a=>a.id===k)}const lt=[{id:"startingSpeed",name:"Quick Start",description:"Start runs with bonus speed",maxLevel:5,costPerLevel:[50,100,150,250,400],effect:{type:"speed",valuePerLevel:[2,4,6,8,10]},icon:"ðŸ‘Ÿ"},{id:"startingControl",name:"Soft Touch",description:"Start runs with bonus control",maxLevel:5,costPerLevel:[50,100,150,250,400],effect:{type:"control",valuePerLevel:[2,4,6,8,10]},icon:"ðŸ¤²"},{id:"startingShotPower",name:"Power Hitter",description:"Start runs with bonus shot power",maxLevel:5,costPerLevel:[50,100,150,250,400],effect:{type:"shotPower",valuePerLevel:[2,4,6,8,10]},icon:"ðŸ‘"},{id:"startingTackle",name:"Ball Hunter",description:"Start runs with bonus tackle",maxLevel:5,costPerLevel:[50,100,150,250,400],effect:{type:"tackle",valuePerLevel:[2,4,6,8,10]},icon:"âš”ï¸"},{id:"bonusGems",name:"Gem Finder",description:"Earn bonus gems per run",maxLevel:5,costPerLevel:[100,200,350,500,750],effect:{type:"gemBonus",valuePerLevel:[5,10,15,25,40]},icon:"ðŸ’Ž"},{id:"upgradeChoices",name:"More Options",description:"See extra upgrade choices",maxLevel:2,costPerLevel:[300,600],effect:{type:"extraChoices",valuePerLevel:[1,2]},icon:"ðŸŽ´"},{id:"rerollCount",name:"Second Chance",description:"Get rerolls for upgrade drafts",maxLevel:3,costPerLevel:[150,300,500],effect:{type:"rerolls",valuePerLevel:[1,2,3]},icon:"ðŸ”„"},{id:"healingRate",name:"Quick Recovery",description:"Recover faster between moments",maxLevel:3,costPerLevel:[100,200,400],effect:{type:"recovery",valuePerLevel:[10,20,35]},icon:"ðŸ’š"},{id:"startingStamina",name:"Endurance",description:"Start runs with bonus stamina",maxLevel:5,costPerLevel:[50,100,150,250,400],effect:{type:"stamina",valuePerLevel:[2,4,6,8,10]},icon:"ðŸ’ª"},{id:"rarityBoost",name:"Lucky Rolls",description:"Increased rare upgrade chance",maxLevel:3,costPerLevel:[200,400,700],effect:{type:"rarityBonus",valuePerLevel:[5,10,20]},icon:"ðŸ€"},{id:"startingUpgrade",name:"Head Start",description:"Start runs with a random upgrade",maxLevel:2,costPerLevel:[500,1e3],effect:{type:"freeUpgrade",valuePerLevel:[1,2]},icon:"ðŸŽ"},{id:"teammateBoost",name:"Team Spirit",description:"Teammates are stronger",maxLevel:3,costPerLevel:[150,300,500],effect:{type:"teammateStats",valuePerLevel:[5,10,15]},icon:"ðŸ¤"}];function ct(k,a){return a>=k.maxLevel?1/0:k.costPerLevel[a]}function ht(k,a){return a<=0?0:k.effect.valuePerLevel[Math.min(a,k.maxLevel)-1]}const dt={info:3447003,success:2600544,warning:15965202,error:15158332},ft={info:"â„¹ï¸",success:"âœ…",warning:"âš ï¸",error:"âŒ"};class Ke{constructor(a){l(this,"scene");l(this,"toasts",[]);l(this,"baseY",100);l(this,"spacing",60);this.scene=a}show(a){const e=new mt(this.scene,{...a,y:this.calculateY(),onComplete:()=>this.removeToast(e)});return this.toasts.push(e),e}calculateY(){return this.baseY+this.toasts.length*this.spacing}removeToast(a){const e=this.toasts.indexOf(a);e>-1&&(this.toasts.splice(e,1),this.toasts.forEach((t,i)=>{this.scene.tweens.add({targets:t,y:this.baseY+i*this.spacing,duration:200,ease:"Power2"})}))}info(a,e){return this.show({message:a,type:"info",icon:e})}success(a,e){return this.show({message:a,type:"success",icon:e})}warning(a,e){return this.show({message:a,type:"warning",icon:e})}error(a,e){return this.show({message:a,type:"error",icon:e})}clear(){this.toasts.forEach(a=>a.dismiss()),this.toasts=[]}}class mt extends p.GameObjects.Container{constructor(e,t){const i=e.cameras.main.centerX,s=t.y;super(e,i,s);l(this,"onComplete");this.onComplete=t.onComplete;const o=t.type||"info",n=t.duration||3e3,r=dt[o],c=t.icon||ft[o],h=e.add.text(0,0,t.message,{fontSize:"16px"}),d=h.width;h.destroy();const m=Math.max(200,d+80),f=44,u=e.add.graphics();u.fillStyle(1710638,.95),u.fillRoundedRect(-m/2,-f/2,m,f,8),u.lineStyle(2,r,.8),u.strokeRoundedRect(-m/2,-f/2,m,f,8),this.add(u);const g=e.add.graphics();g.fillStyle(r,1),g.fillRoundedRect(-m/2,-f/2,6,f,{tl:8,tr:0,br:0,bl:8}),this.add(g);const y=e.add.text(-m/2+24,0,c,{fontSize:"18px"});y.setOrigin(.5),this.add(y);const b=e.add.text(8,0,t.message,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#ffffff"});b.setOrigin(.5),this.add(b),this.setDepth(500),this.setScrollFactor(0),e.add.existing(this),this.setAlpha(0),this.x=i+200,e.tweens.add({targets:this,x:i,alpha:1,duration:300,ease:"Power2"}),e.time.delayedCall(n,()=>this.dismiss())}dismiss(){this.scene.tweens.add({targets:this,x:this.x+200,alpha:0,duration:200,ease:"Power2",onComplete:()=>{this.onComplete&&this.onComplete(),this.destroy()}})}}class Ws extends p.GameObjects.Container{constructor(a,e,t,i="ðŸ†"){const s=a.cameras.main.centerX,o=150;super(a,s,o);const n=300,r=80,c=a.add.graphics();c.fillStyle(1710638,.95),c.fillRoundedRect(-n/2,-r/2,n,r,12),c.lineStyle(3,15844367,1),c.strokeRoundedRect(-n/2,-r/2,n,r,12),this.add(c);const h=a.add.graphics();h.fillStyle(15844367,.2),h.fillRoundedRect(-n/2-4,-r/2-4,n+8,r+8,14),this.add(h),this.sendToBack(h);const d=a.add.text(-n/2+40,0,i,{fontSize:"36px"});d.setOrigin(.5),this.add(d);const m=a.add.text(10,-12,e,{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#f1c40f",fontStyle:"bold"});m.setOrigin(.5),this.add(m);const f=a.add.text(10,14,t,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#bdc3c7"});f.setOrigin(.5),this.add(f),this.setDepth(510),this.setScrollFactor(0),a.add.existing(this),this.setAlpha(0),this.setScale(.5),this.y=o-50,a.tweens.add({targets:this,y:o,alpha:1,scaleX:1,scaleY:1,duration:500,ease:"Back.easeOut"}),a.tweens.add({targets:h,alpha:.5,duration:500,yoyo:!0,repeat:3}),a.time.delayedCall(4e3,()=>{a.tweens.add({targets:this,y:o-50,alpha:0,duration:300,onComplete:()=>this.destroy()})})}}class pt extends p.Scene{constructor(){super({key:"StoreScene"});l(this,"audioSystem");l(this,"toastManager");l(this,"gemText");l(this,"currentTab","characters");l(this,"contentContainer")}create(){this.audioSystem=new V(this),this.toastManager=new Ke(this),this.cameras.main.setBackgroundColor(1710638),this.createHeader(),this.createTabs(),this.contentContainer=this.add.container(0,0),this.showCharactersTab(),this.cameras.main.fadeIn(300)}createHeader(){new E(this,{x:80,y:40,width:100,height:40,text:"â† Back",fontSize:16,style:"secondary",onClick:()=>{this.audioSystem.playClick(),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MenuScene")})}}),this.add.text(this.cameras.main.centerX,40,"ðŸ›’ STORE",{fontFamily:"Arial, sans-serif",fontSize:"36px",color:"#f1c40f",fontStyle:"bold"}).setOrigin(.5),this.createGemDisplay()}createGemDisplay(){const e=C.getInstance().getGems(),t=this.add.container(this.cameras.main.width-100,40),i=this.add.graphics();i.fillStyle(2899536,.9),i.fillRoundedRect(-60,-20,120,40,10),i.lineStyle(2,15844367,.5),i.strokeRoundedRect(-60,-20,120,40,10),t.add(i);const s=this.add.text(-40,0,"ðŸ’Ž",{fontSize:"20px"});s.setOrigin(.5),t.add(s),this.gemText=this.add.text(10,0,e.toString(),{fontFamily:"Arial, sans-serif",fontSize:"20px",color:"#f1c40f",fontStyle:"bold"}),this.gemText.setOrigin(.5),t.add(this.gemText)}updateGemDisplay(){this.gemText&&this.gemText.setText(C.getInstance().getGems().toString())}createTabs(){new E(this,{x:this.cameras.main.centerX-100,y:100,width:150,height:40,text:"Characters",fontSize:16,style:this.currentTab==="characters"?"primary":"secondary",onClick:()=>{this.currentTab="characters",this.showCharactersTab()}}),new E(this,{x:this.cameras.main.centerX+100,y:100,width:150,height:40,text:"Meta Upgrades",fontSize:16,style:this.currentTab==="meta"?"primary":"secondary",onClick:()=>{this.currentTab="meta",this.showMetaTab()}})}showCharactersTab(){var d,m;this.clearContent();const e=C.getInstance().getUnlockedCharacters(),t=J.filter(f=>f.unlockCost>0&&!e.includes(f.id)),i=this.add.text(this.cameras.main.centerX,160,"Unlock New Characters",{fontFamily:"Arial, sans-serif",fontSize:"20px",color:"#bdc3c7"});i.setOrigin(.5),(d=this.contentContainer)==null||d.add(i);const s=4,o=180,n=240,r=this.cameras.main.centerX-(Math.min(t.length,s)-1)*(o+20)/2,c=200;t.forEach((f,u)=>{const g=Math.floor(u/s),y=u%s,b=r+y*(o+20),T=c+g*(n+20);this.createCharacterCard(f,b,T,o,n)});const h=this.add.text(this.cameras.main.centerX,this.cameras.main.height-50,`Unlocked: ${e.length} / ${J.length}`,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#7f8c8d"});h.setOrigin(.5),(m=this.contentContainer)==null||m.add(h)}createCharacterCard(e,t,i,s,o){var T;const r=C.getInstance().getGems()>=e.unlockCost,c=this.add.container(t,i);(T=this.contentContainer)==null||T.add(c);const h=this.add.graphics();h.fillStyle(2899536,1),h.fillRoundedRect(-s/2,-20,s,o,12),h.lineStyle(2,r?2600544:8359053,.8),h.strokeRoundedRect(-s/2,-20,s,o,12),c.add(h);const d=this.add.graphics();d.fillStyle(e.color,1),d.fillRoundedRect(-s/2,-20,s,8,{tl:12,tr:12,bl:0,br:0}),c.add(d);const m=this.add.circle(0,40,30,e.color);c.add(m);const f=this.add.text(0,90,e.name,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#ffffff",fontStyle:"bold"});f.setOrigin(.5),c.add(f);const u=this.add.text(0,110,e.role.toUpperCase(),{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#bdc3c7"});u.setOrigin(.5),c.add(u);const g=this.add.text(0,135,`âœ¨ ${e.trait.name}`,{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#27ae60"});g.setOrigin(.5),c.add(g);const y=this.add.text(0,155,`âš ï¸ ${e.downside.name}`,{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#e74c3c"});y.setOrigin(.5),c.add(y);const b=this.add.text(0,185,`ðŸ’Ž ${e.unlockCost}`,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:r?"#f1c40f":"#7f8c8d",fontStyle:"bold"});if(b.setOrigin(.5),c.add(b),r){const x=this.add.zone(0,100,s,o).setInteractive({useHandCursor:!0});c.add(x),x.on("pointerover",()=>{h.clear(),h.fillStyle(3426654,1),h.fillRoundedRect(-s/2,-20,s,o,12),h.lineStyle(3,2600544,1),h.strokeRoundedRect(-s/2,-20,s,o,12)}),x.on("pointerout",()=>{h.clear(),h.fillStyle(2899536,1),h.fillRoundedRect(-s/2,-20,s,o,12),h.lineStyle(2,2600544,.8),h.strokeRoundedRect(-s/2,-20,s,o,12)}),x.on("pointerdown",()=>{this.buyCharacter(e,c)})}}buyCharacter(e,t){const i=C.getInstance();i.spendGems(e.unlockCost)?(i.unlockCharacter(e.id),this.audioSystem.playUpgrade(),this.toastManager.success(`Unlocked ${e.name}!`,"ðŸŽ‰"),this.tweens.add({targets:t,scaleX:1.1,scaleY:1.1,duration:150,yoyo:!0,onComplete:()=>{this.tweens.add({targets:t,alpha:0,y:t.y-30,duration:300,onComplete:()=>{t.destroy(),this.updateGemDisplay()}})}})):(this.audioSystem.playError(),this.toastManager.error("Not enough gems!"))}showMetaTab(){var s;this.clearContent();const e=this.add.text(this.cameras.main.centerX,160,"Permanent Upgrades",{fontFamily:"Arial, sans-serif",fontSize:"20px",color:"#bdc3c7"});e.setOrigin(.5),(s=this.contentContainer)==null||s.add(e);const t=200,i=70;lt.slice(0,6).forEach((o,n)=>{const r=t+n*i;this.createMetaUpgradeRow(o,r)})}createMetaUpgradeRow(e,t){var b;const i=C.getInstance(),s=i.getMetaUpgradeLevel(e.id),o=s>=e.maxLevel,n=o?1/0:ct(e,s),c=i.getGems()>=n,h=this.add.container(this.cameras.main.centerX,t);(b=this.contentContainer)==null||b.add(h);const d=this.add.graphics();d.fillStyle(2899536,.8),d.fillRoundedRect(-350,-25,700,60,10),h.add(d);const m=this.add.text(-320,0,e.icon,{fontSize:"28px"});m.setOrigin(.5),h.add(m);const f=this.add.text(-260,-10,e.name,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#ffffff",fontStyle:"bold"});h.add(f);const u=this.add.text(-260,10,e.description,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7f8c8d"});h.add(u);let g="";for(let T=0;T<e.maxLevel;T++)g+=T<s?"â—":"â—‹";const y=this.add.text(150,0,g,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#f1c40f"});if(y.setOrigin(.5),h.add(y),!o){const T=ht(e,s+1),x=this.add.text(230,0,`+${T}%`,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#27ae60"});x.setOrigin(.5),h.add(x)}if(o){const T=this.add.text(300,0,"MAXED",{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#7f8c8d"});T.setOrigin(.5),h.add(T)}else new E(this,{x:this.cameras.main.centerX+300,y:t,width:80,height:35,text:`ðŸ’Ž ${n}`,fontSize:14,style:c?"success":"secondary",disabled:!c,onClick:()=>{i.spendGems(n)&&(i.setMetaUpgradeLevel(e.id,s+1),this.audioSystem.playUpgrade(),this.toastManager.success(`${e.name} upgraded!`),this.updateGemDisplay(),this.showMetaTab())}})}clearContent(){var e;(e=this.contentContainer)==null||e.removeAll(!0)}}class ut extends p.Scene{constructor(){super({key:"CharacterSelectScene"});l(this,"audioSystem");l(this,"selectedCharacter");l(this,"characterCards",new Map);l(this,"detailsPanel");l(this,"playButton")}create(){this.audioSystem=new V(this),this.cameras.main.setBackgroundColor(1710638),this.createHeader(),this.createCharacterGrid(),this.createDetailsPanel();const e=C.getInstance().getLastPlayedCharacter(),t=C.getInstance().getUnlockedCharacters();e&&t.includes(e)?this.selectCharacter(ke(e)):t.length>0&&this.selectCharacter(ke(t[0])),this.cameras.main.fadeIn(300)}createHeader(){new E(this,{x:80,y:40,width:100,height:40,text:"â† Back",fontSize:16,style:"secondary",onClick:()=>{this.audioSystem.playClick(),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MenuScene")})}}),this.add.text(this.cameras.main.centerX,40,"SELECT YOUR PLAYER",{fontFamily:"Arial, sans-serif",fontSize:"32px",color:"#f1c40f",fontStyle:"bold"}).setOrigin(.5)}createCharacterGrid(){const e=C.getInstance().getUnlockedCharacters(),t=J,i=5,s=100,o=130,n=80,r=100,c=20,h=20;t.forEach((d,m)=>{const f=e.includes(d.id),u=Math.floor(m/i),g=m%i,y=n+g*(s+c),b=r+u*(o+h),T=this.createCharacterCard(d,y,b,s,o,f);this.characterCards.set(d.id,T)})}createCharacterCard(e,t,i,s,o,n){const r=this.add.container(t,i),c=this.add.graphics();if(c.fillStyle(n?2899536:1710618,1),c.fillRoundedRect(0,0,s,o,10),c.lineStyle(2,n?e.color:4473924,.8),c.strokeRoundedRect(0,0,s,o,10),r.add(c),n){const m=this.add.graphics();m.fillStyle(e.color,1),m.fillRoundedRect(0,0,s,5,{tl:10,tr:10,bl:0,br:0}),r.add(m)}if(n){const m=this.add.circle(s/2,45,25,e.color);r.add(m);const f={forward:"âš¡",midfielder:"ðŸ”„",defender:"ðŸ›¡ï¸",goalkeeper:"ðŸ§¤"},u=this.add.text(s/2,45,f[e.role]||"â—",{fontSize:"18px"});u.setOrigin(.5),r.add(u)}else{const m=this.add.text(s/2,45,"ðŸ”’",{fontSize:"24px"});m.setOrigin(.5),r.add(m)}const h=this.add.text(s/2,85,e.name.split(" ")[0],{fontFamily:"Arial, sans-serif",fontSize:"12px",color:n?"#ffffff":"#666666",fontStyle:"bold"});h.setOrigin(.5),r.add(h);const d=this.add.text(s/2,102,e.role.toUpperCase(),{fontFamily:"Arial, sans-serif",fontSize:"9px",color:n?"#bdc3c7":"#444444"});if(d.setOrigin(.5),r.add(d),!n){const m=this.add.text(s/2,118,`ðŸ’Ž ${e.unlockCost}`,{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#7f8c8d"});m.setOrigin(.5),r.add(m)}if(n){const m=this.add.zone(s/2,o/2,s,o).setInteractive({useHandCursor:!0});r.add(m),m.on("pointerover",()=>{var f;((f=this.selectedCharacter)==null?void 0:f.id)!==e.id&&this.tweens.add({targets:r,scaleX:1.05,scaleY:1.05,duration:100})}),m.on("pointerout",()=>{var f;((f=this.selectedCharacter)==null?void 0:f.id)!==e.id&&this.tweens.add({targets:r,scaleX:1,scaleY:1,duration:100})}),m.on("pointerdown",()=>{this.audioSystem.playClick(),this.selectCharacter(e)})}return r}selectCharacter(e){if(this.selectedCharacter){const i=this.characterCards.get(this.selectedCharacter.id);i&&this.tweens.add({targets:i,scaleX:1,scaleY:1,duration:100})}this.selectedCharacter=e;const t=this.characterCards.get(e.id);t&&this.tweens.add({targets:t,scaleX:1.1,scaleY:1.1,duration:100}),this.updateDetailsPanel(e),this.playButton&&this.playButton.setDisabled(!1)}createDetailsPanel(){this.detailsPanel=this.add.container(650,100);const o=this.add.graphics();o.fillStyle(1710638,.95),o.fillRoundedRect(0,0,350,450,15),o.lineStyle(2,3447003,.5),o.strokeRoundedRect(0,0,350,450,15),this.detailsPanel.add(o);const n=this.add.text(350/2,450/2,"Select a character",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#7f8c8d"});n.setOrigin(.5),n.setName("placeholder"),this.detailsPanel.add(n),this.playButton=new E(this,{x:650+350/2,y:590,width:200,height:50,text:"â–¶ START RUN",fontSize:20,style:"success",disabled:!0,onClick:()=>{this.selectedCharacter&&this.startRun()}})}updateDetailsPanel(e){if(!this.detailsPanel)return;this.detailsPanel.getAll().filter(T=>T.name!=="bg"&&T.type!=="Graphics").forEach(T=>T.destroy());const i=350,s=this.add.text(i/2,30,e.name,{fontFamily:"Arial, sans-serif",fontSize:"24px",color:"#ffffff",fontStyle:"bold"});s.setOrigin(.5),this.detailsPanel.add(s);const o=this.add.text(i/2,55,e.role.toUpperCase(),{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#"+e.color.toString(16).padStart(6,"0")});o.setOrigin(.5),this.detailsPanel.add(o);const n=this.add.text(i/2,85,e.description,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#bdc3c7",align:"center",wordWrap:{width:i-40}});n.setOrigin(.5),this.detailsPanel.add(n);const r=130,c=[{name:"Speed",value:e.stats.speed},{name:"Stamina",value:e.stats.stamina},{name:"Control",value:e.stats.control},{name:"Shot Power",value:e.stats.shotPower},{name:"Pass Power",value:e.stats.passPower},{name:"Tackle",value:e.stats.tackle},{name:"Dodge",value:e.stats.dodge}];c.forEach((T,x)=>{const w=r+x*28,D=this.add.text(20,w,T.name,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#bdc3c7"});this.detailsPanel.add(D);const S=this.add.graphics();S.fillStyle(2899536,1),S.fillRoundedRect(120,w-2,150,16,4),this.detailsPanel.add(S);const v=this.add.graphics(),A=T.value/10*146,M=T.value>=8?2600544:T.value>=5?15965202:15158332;v.fillStyle(M,1),v.fillRoundedRect(122,w,A,12,3),this.detailsPanel.add(v);const P=this.add.text(285,w,T.value.toString(),{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#ffffff"});P.setOrigin(0,0),this.detailsPanel.add(P)});const h=r+c.length*28+20,d=this.add.text(20,h,"âœ¨ TRAIT",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#27ae60",fontStyle:"bold"});this.detailsPanel.add(d);const m=this.add.text(20,h+18,e.trait.name,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#ffffff",fontStyle:"bold"});this.detailsPanel.add(m);const f=this.add.text(20,h+36,e.trait.description,{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#95a5a6",wordWrap:{width:i-40}});this.detailsPanel.add(f);const u=h+70,g=this.add.text(20,u,"âš ï¸ DOWNSIDE",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#e74c3c",fontStyle:"bold"});this.detailsPanel.add(g);const y=this.add.text(20,u+18,e.downside.name,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#ffffff",fontStyle:"bold"});this.detailsPanel.add(y);const b=this.add.text(20,u+36,e.downside.description,{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#95a5a6",wordWrap:{width:i-40}});this.detailsPanel.add(b)}startRun(){this.selectedCharacter&&(C.getInstance().setLastPlayedCharacter(this.selectedCharacter.id),C.getInstance().addUniqueToStat("uniqueCharactersPlayed",this.selectedCharacter.id),this.audioSystem.playMomentStart(),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("RunScene",{character:this.selectedCharacter})}))}}const gt="modulepreload",yt=function(k){return"/"+k},be={},Te=function(a,e,t){let i=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),n=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(e.map(r=>{if(r=yt(r),r in be)return;be[r]=!0;const c=r.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${h}`))return;const d=document.createElement("link");if(d.rel=c?"stylesheet":gt,c||(d.as="script"),d.crossOrigin="",d.href=r,n&&d.setAttribute("nonce",n),document.head.appendChild(d),c)return new Promise((m,f)=>{d.addEventListener("load",m),d.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${r}`)))})}))}function s(o){const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=o,window.dispatchEvent(n),!n.defaultPrevented)throw o}return i.then(o=>{for(const n of o||[])n.status==="rejected"&&s(n.reason);return a().catch(s)})},fe=750,me=15,St=1e3,kt=.975,xe=1200,we=30,ae=1800,bt=.99,W=1850,Ce=12,Tt=.75,oe=.35,ve=180,xt=320,wt=420,Ct=200,Pe=.18,De=.9,vt=85,Pt=8,Dt=180,At=60,Mt=6,Rt=.65,Et=.05,Bt=420,It=580,Ot=450,Ae=70,Gt=.018,Lt=180,Ft=22,Me=30,_t=45,Ht=600,Re=80,Ut=850,ne=1,Ee=1.35,Be=500,Ie=200,Oe=600,Ge=850,$t=700,zt=100,Yt=2,Nt=70,Y=75,Xt=.1,Wt=600,Le=1,Kt=200,je=.65,jt=95,Vt=160,Fe=Math.PI/3.5,qt=70,Qt=400,Jt=28,Zt=520,es=300,ts=25,_e=1200,j=120,q=24,H=150,pe=4e3,ue=30,ge=90,Z=70,Ve=220,ee=400,te=280,qe=800,Qe=80,Je=200,se=.22,z=300,He=100,Ue=100,$e=28,ss=18,is=.7,as=140,ze=700,os=350,ns=100,rs=170,ls=.35,Ye=250,re=75,$=3e3,cs=15,hs=20,ds=15,fs=120,ms=280,ps=60,Ne=.03,us=1200,gs=20,Xe=100,Ze=.08,ys=.97;class Ss extends p.Physics.Arcade.Sprite{constructor(e,t,i,s){super(e,t,i,"player_0");l(this,"character");l(this,"stats");l(this,"hasBall",!1);l(this,"isMoving",!1);l(this,"isStunned",!1);l(this,"isShooting",!1);l(this,"isDodging",!1);l(this,"justReceivedBall",!1);l(this,"recentlyLostBall",!1);l(this,"isCharging",!1);l(this,"isHitstop",!1);l(this,"isCallingForPass",!1);l(this,"isInvulnerable",!1);l(this,"callingForPassUntil",0);l(this,"health",He);l(this,"maxHealth",He);l(this,"lastDamageTime",0);l(this,"lastDamageAmount",0);l(this,"stamina",Ue);l(this,"maxStamina",Ue);l(this,"canDash",!0);l(this,"shootCooldown",0);l(this,"passCooldown",0);l(this,"tackleCooldown",0);l(this,"dodgeCooldown",0);l(this,"onHealthChange");l(this,"onStaminaChange");l(this,"onDeath");l(this,"chargeStartTime",0);l(this,"chargeGraphics");l(this,"targetVelocityX",0);l(this,"targetVelocityY",0);l(this,"facingAngle",0);l(this,"stickGraphics");l(this,"shotLineGraphics");l(this,"passLineGraphics");l(this,"upgradeSystem");l(this,"onShoot");l(this,"onPass");l(this,"onTackle");l(this,"onDodge");l(this,"onShootFailed");l(this,"onPassFailed");this.character=s,this.stats={...s.stats},e.add.existing(this),e.physics.add.existing(this),this.setCollideWorldBounds(!0),this.setCircle(20,4,8),this.setDrag(100),this.setDepth(10);const o=this.getColorIndex(s.color);this.setTexture(`player_${o}`),this.stickGraphics=e.add.graphics(),this.stickGraphics.setDepth(11),this.shotLineGraphics=e.add.graphics(),this.shotLineGraphics.setDepth(9),this.passLineGraphics=e.add.graphics(),this.passLineGraphics.setDepth(9),this.chargeGraphics=e.add.graphics(),this.chargeGraphics.setDepth(12)}getColorIndex(e){const i=[3447003,15158332,3066993,10181046,15965202,1752220,15105570,9323693,15844367,1482885,12597547,2600544,13849600,2719929,9109504,48340,6765239,16733986,3426654,15277667].indexOf(e);return i>=0?i:0}setUpgradeSystem(e){this.upgradeSystem=e}getModifiedStat(e){const t=this.stats[e];return this.upgradeSystem?this.upgradeSystem.getModifiedStat(t,e):t}update(e,t){if(this.updateCooldowns(e),!this.isHitstop){if(this.isStunned){this.setVelocity(this.body.velocity.x*.92,this.body.velocity.y*.92),this.cancelCharge();return}this.isDodging||(this.processMovement(t,e),this.processActions(t),this.updateVisuals(t),this.updateChargeUI(),this.regenerateStamina(e))}}processMovement(e,t){const i=this.getModifiedStat("speed")*Ct/6;this.targetVelocityX=e.moveX*i,this.targetVelocityY=e.moveY*i;const s=this.body.velocity.x,o=this.body.velocity.y;let n=s,r=o;this.targetVelocityX!==0?n+=(this.targetVelocityX-s)*Pe:n*=De,this.targetVelocityY!==0?r+=(this.targetVelocityY-o)*Pe:r*=De,this.setVelocity(n,r),this.isMoving=e.isMoving,e.isMoving?this.facingAngle=Math.atan2(e.moveY,e.moveX):e.hasMouseMoved&&(this.facingAngle=e.aimAngle)}processActions(e){if(e.callForPass&&!this.hasBall&&this.callForPass(),this.callingForPassUntil>0&&this.scene.time.now>this.callingForPassUntil&&(this.isCallingForPass=!1,this.callingForPassUntil=0),this.hasBall){if((e.shoot||e.mouseDown)&&this.shootCooldown<=0&&!this.isCharging&&this.startCharge(),this.isCharging){const t=this.scene.time.now-this.chargeStartTime;e.shootReleased||!e.shootHeld&&!e.mouseDown?t<150&&this.passCooldown<=0?(this.cancelCharge(),this.tryPass(e.aimAngle)):this.releaseChargedShot(e.aimAngle):this.hasBall||this.cancelCharge()}e.pass&&this.passCooldown<=0&&!this.isCharging&&this.tryPass(e.aimAngle)}else(e.shoot||e.tackle)&&this.tackleCooldown<=0&&this.tackle();e.dodge&&this.dodgeCooldown<=0&&this.stamina>=20&&this.dodge(e.moveX||Math.cos(e.aimAngle),e.moveY||Math.sin(e.aimAngle))}startCharge(){this.isCharging||(this.isCharging=!0,this.chargeStartTime=this.scene.time.now)}getChargePercent(){if(!this.isCharging)return 0;const e=this.scene.time.now-this.chargeStartTime;return p.Math.Clamp((e-Re)/(Ut-Re),0,1)}getChargePowerMult(){const e=this.getChargePercent();return p.Math.Linear(ne,Ee,e)}releaseChargedShot(e){if(!this.hasBall){this.cancelCharge();return}const t=this.getChargePowerMult();this.cancelCharge();const i=this.getModifiedStat("shotPower"),s=xe+i*we,o=Math.min(s*t,ae);this.shoot(o,e,t>1.1)}cancelCharge(){var e;this.isCharging=!1,this.chargeStartTime=0,(e=this.chargeGraphics)==null||e.clear()}updateChargeUI(){if(!this.chargeGraphics||(this.chargeGraphics.clear(),!this.isCharging))return;const e=this.getChargePercent();if(e<=0)return;const t=36,i=6,s=this.x-t/2,o=this.y-38;this.chargeGraphics.fillStyle(3355443,.8),this.chargeGraphics.fillRect(s,o,t,i);const n=e>=.9?15844367:3447003;this.chargeGraphics.fillStyle(n,1),this.chargeGraphics.fillRect(s+1,o+1,(t-2)*e,i-2),this.chargeGraphics.lineStyle(1,16777215,.8),this.chargeGraphics.strokeRect(s,o,t,i)}tryShoot(e,t=0){var n;if(this.shootCooldown>0)return!1;if(!this.hasBall)return(n=this.onShootFailed)==null||n.call(this),!1;const i=this.getModifiedStat("shotPower"),o=Math.min(xe+i*we,ae)*(ne+t*(Ee-ne));return this.shoot(Math.min(o,ae),e,t>.5),!0}shoot(e,t,i=!1){var n,r;this.isShooting=!0,this.hasBall=!1,this.shootCooldown=Be,(n=this.upgradeSystem)==null||n.emitEvent("shot",{player:this,position:{x:this.x,y:this.y},scene:this.scene,time:this.scene.time.now}),(r=this.onShoot)==null||r.call(this,e,t),this.playStickSwing(t),this.playMuzzleFlash(t,!0);const s=i?.012:.008,o=i?150:100;this.scene.cameras.main.shake(o,s),i?(this.applyHitstop(40),this.setTint(15844367),this.scene.time.delayedCall(60,()=>this.clearTint())):(this.setTint(16737792),this.scene.time.delayedCall(50,()=>this.clearTint())),this.scene.tweens.add({targets:this,scaleX:i?1.28:1.18,scaleY:i?.72:.82,duration:i?80:60,yoyo:!0,ease:"Power2",onComplete:()=>{this.isShooting=!1,this.setScale(1)}})}tryPass(e){var t;return this.passCooldown>0?!1:this.hasBall?(this.performPass(e),!0):((t=this.onPassFailed)==null||t.call(this),!1)}performPass(e){var s,o;this.hasBall=!1,this.passCooldown=Ie;const t=this.getModifiedStat("passPower"),i=Math.min(fe+t*me,St);(s=this.upgradeSystem)==null||s.emitEvent("pass",{player:this,position:{x:this.x,y:this.y},scene:this.scene,time:this.scene.time.now}),(o=this.onPass)==null||o.call(this,e,i),this.playPassLine(e),this.scene.cameras.main.shake(30,.002),this.scene.tweens.add({targets:this,scaleX:1.05,scaleY:.95,duration:35,yoyo:!0}),this.setTint(3447003),this.scene.time.delayedCall(80,()=>this.clearTint())}tackle(){var s,o;this.tackleCooldown=Oe,this.stamina-=15,(s=this.upgradeSystem)==null||s.emitEvent("tackle",{player:this,position:{x:this.x,y:this.y},scene:this.scene,time:this.scene.time.now}),(o=this.onTackle)==null||o.call(this);const e=At+this.getModifiedStat("tackle")*Mt,t=Math.cos(this.facingAngle)*e,i=Math.sin(this.facingAngle)*e;this.scene.tweens.add({targets:this,x:this.x+t,y:this.y+i,duration:120,ease:"Power2"})}dodge(e,t){var o,n;if(!this.consumeStamina($e)){console.log("[STAMINA] Cannot dash - not enough stamina");return}this.isDodging=!0,this.dodgeCooldown=Ge;const i=Math.sqrt(e*e+t*t)||1;e/=i,t/=i;const s=vt+this.getModifiedStat("dodge")*Pt;(o=this.upgradeSystem)==null||o.emitEvent("dodge",{player:this,position:{x:this.x,y:this.y},scene:this.scene,time:this.scene.time.now}),(n=this.onDodge)==null||n.call(this),this.scene.tweens.add({targets:this,x:this.x+e*s,y:this.y+t*s,duration:Dt,ease:"Power2",onComplete:()=>{this.isDodging=!1}}),this.scene.tweens.add({targets:this,alpha:.5,duration:80,yoyo:!0})}playStickSwing(e){if(!this.stickGraphics)return;const t=e-Math.PI/3,i=e+Math.PI/6,s=38;let o=t;const n=80,r=this.scene.time.now,c=()=>{const h=this.scene.time.now-r,d=Math.min(h/n,1);o=p.Math.Linear(t,i,d),this.stickGraphics.clear(),this.stickGraphics.lineStyle(5,9127187,1),this.stickGraphics.beginPath(),this.stickGraphics.moveTo(this.x,this.y),this.stickGraphics.lineTo(this.x+Math.cos(o)*s,this.y+Math.sin(o)*s),this.stickGraphics.strokePath(),this.stickGraphics.fillStyle(3355443,1),this.stickGraphics.fillCircle(this.x+Math.cos(o)*s,this.y+Math.sin(o)*s,6),d<1?this.scene.time.delayedCall(16,c):this.scene.time.delayedCall(40,()=>{this.stickGraphics.clear()})};c()}playMuzzleFlash(e,t){const i=this.shotLineGraphics;if(!i)return;const s=t?75:50,o=t?8:5,n=t?15844367:3447003,r=this.x+Math.cos(e)*25,c=this.y+Math.sin(e)*25,h=this.x+Math.cos(e)*s,d=this.y+Math.sin(e)*s;i.clear(),i.lineStyle(o,n,.9),i.beginPath(),i.moveTo(r,c),i.lineTo(h,d),i.strokePath(),i.fillStyle(16777215,.9),i.fillCircle(h,d,t?10:6);const m={alpha:1};this.scene.tweens.add({targets:m,alpha:0,duration:70,onUpdate:()=>{i.setAlpha(m.alpha)},onComplete:()=>{i.clear(),i.setAlpha(1)}})}playPassLine(e){const t=this.passLineGraphics;if(!t)return;const i=60,s=this.x+Math.cos(e)*25,o=this.y+Math.sin(e)*25,n=this.x+Math.cos(e)*i,r=this.y+Math.sin(e)*i;t.clear(),t.lineStyle(5,3066993,.9),t.beginPath(),t.moveTo(s,o),t.lineTo(n,r),t.strokePath(),t.fillStyle(3066993,.9),t.fillCircle(n,r,6);const c={alpha:1};this.scene.tweens.add({targets:c,alpha:0,duration:100,onUpdate:()=>{t.setAlpha(c.alpha)},onComplete:()=>{t.clear(),t.setAlpha(1)}})}updateCooldowns(e){this.shootCooldown=Math.max(0,this.shootCooldown-e),this.passCooldown=Math.max(0,this.passCooldown-e),this.tackleCooldown=Math.max(0,this.tackleCooldown-e),this.dodgeCooldown=Math.max(0,this.dodgeCooldown-e)}regenerateStamina(e){this.regenStamina(e)}updateVisuals(e){const t=this.facingAngle*.1;if(this.rotation=p.Math.Angle.RotateTo(this.rotation,t,.1),this.hasBall&&this.isMoving){const i=Math.sin(this.scene.time.now*.02)*2;this.y+=i*.1}}callForPass(){this.isCallingForPass=!0,this.callingForPassUntil=this.scene.time.now+us}receiveBall(){var e;this.hasBall=!0,this.justReceivedBall=!0,this.isCallingForPass=!1,this.callingForPassUntil=0,(e=this.upgradeSystem)==null||e.emitEvent("receive",{player:this,position:{x:this.x,y:this.y},scene:this.scene,time:this.scene.time.now}),this.scene.time.delayedCall(1e3,()=>{this.justReceivedBall=!1})}loseBall(){this.hasBall=!1,this.recentlyLostBall=!0,this.cancelCharge(),this.scene.time.delayedCall(2e3,()=>{this.recentlyLostBall=!1})}applyStun(e){this.isStunned=!0,this.cancelCharge();let t=e;this.upgradeSystem&&(t=this.upgradeSystem.getModifiedStat(e,"stunDuration")),this.scene.time.delayedCall(t,()=>{this.isStunned=!1}),this.scene.tweens.add({targets:this,tint:16711680,duration:80,yoyo:!0,repeat:Math.floor(t/160)})}takeDamage(e,t="tackle"){var s,o;let i=e;if(this.upgradeSystem){const n=this.upgradeSystem.getModifiedStat(0,"damageReduction");i=Math.max(1,e-n)}return this.health=Math.max(0,this.health-i),this.lastDamageTime=this.scene.time.now,this.lastDamageAmount=i,console.log(`[HEALTH] Took ${i} damage (${t}). Health: ${this.health}/${this.maxHealth}`),this.scene.tweens.add({targets:this,tint:16711680,duration:100,yoyo:!0}),(s=this.onHealthChange)==null||s.call(this,this.health,this.maxHealth,i),this.health<=0?(console.log("[HEALTH] Player DIED - moment should fail"),(o=this.onDeath)==null||o.call(this,"tackled"),!0):!1}heal(e){var i;const t=this.health;this.health=Math.min(this.maxHealth,this.health+e),this.health!==t&&((i=this.onHealthChange)==null||i.call(this,this.health,this.maxHealth,-(this.health-t)))}resetHealth(){var e;this.health=this.maxHealth,(e=this.onHealthChange)==null||e.call(this,this.health,this.maxHealth,0)}consumeStamina(e){var t;return this.stamina<e?!1:(this.stamina=Math.max(0,this.stamina-e),this.updateCanDash(),(t=this.onStaminaChange)==null||t.call(this,this.stamina,this.maxStamina),!0)}regenStamina(e){var s;if(this.stamina>=this.maxStamina||this.isDodging)return;let t=ss;this.hasBall&&(t*=is);const i=t*(e/1e3);this.stamina=Math.min(this.maxStamina,this.stamina+i),this.updateCanDash(),(s=this.onStaminaChange)==null||s.call(this,this.stamina,this.maxStamina)}updateCanDash(){this.canDash=this.stamina>=$e}restoreStamina(e){var i;const t=this.stamina;this.stamina=Math.min(this.maxStamina,this.stamina+e),this.updateCanDash(),this.stamina!==t&&((i=this.onStaminaChange)==null||i.call(this,this.stamina,this.maxStamina))}resetStamina(){var e;this.stamina=this.maxStamina,this.updateCanDash(),(e=this.onStaminaChange)==null||e.call(this,this.stamina,this.maxStamina)}applyHitstop(e){this.isHitstop=!0,this.scene.time.delayedCall(e,()=>{this.isHitstop=!1})}applyKnockback(e,t,i){const s=Math.sqrt(e*e+t*t)||1,o=this.body.velocity;this.setVelocity(o.x+e/s*i,o.y+t/s*i)}addShield(e){const t=this.scene.add.sprite(this.x,this.y,"effect_shield");t.setAlpha(.7),t.setDepth(11);const i=this.scene.time.addEvent({delay:16,callback:()=>{t.setPosition(this.x,this.y)},loop:!0});this.scene.time.delayedCall(e,()=>{i.destroy(),this.scene.tweens.add({targets:t,alpha:0,duration:200,onComplete:()=>t.destroy()})})}getCooldowns(){return{shoot:this.shootCooldown/Be,pass:this.passCooldown/Ie,tackle:this.tackleCooldown/Oe,dodge:this.dodgeCooldown/Ge}}canShoot(){return this.hasBall&&this.shootCooldown<=0&&!this.isStunned&&!this.isDodging}canPass(){return this.hasBall&&this.passCooldown<=0&&!this.isStunned&&!this.isDodging}getBallOffset(){return{x:this.x+Math.cos(this.facingAngle)*25,y:this.y+Math.sin(this.facingAngle)*25}}getFacingAngle(){return this.facingAngle}getChargePercentage(){return this.getChargePercent()}destroy(e){var t,i,s,o;(t=this.stickGraphics)==null||t.destroy(),(i=this.shotLineGraphics)==null||i.destroy(),(s=this.passLineGraphics)==null||s.destroy(),(o=this.chargeGraphics)==null||o.destroy(),super.destroy(e)}}class ks extends p.Physics.Arcade.Sprite{constructor(e,t,i){super(e,t,i,"ball");l(this,"owner",null);l(this,"isLoose",!0);l(this,"isAerial",!1);l(this,"lastOwner",null);l(this,"lastShooter",null);l(this,"isRebound",!1);l(this,"lastPossessingTeam","none");l(this,"lastShotTeam","none");l(this,"lastShotFromInsideD",!1);l(this,"lastShotTime",0);l(this,"lastShotX",0);l(this,"lastShotY",0);l(this,"lastTouchInDTeam","none");l(this,"lastTouchInDTime",0);l(this,"lastTouchInDKind","none");l(this,"lastTouchInDX",0);l(this,"lastTouchInDY",0);l(this,"lastToucherId","");l(this,"intendedReceiver",null);l(this,"passStartTime",0);l(this,"noRecaptureUntil",0);l(this,"prevX",0);l(this,"prevY",0);l(this,"curveAmount",0);l(this,"spinAmount",0);l(this,"isBoomerang",!1);l(this,"boomerangOrigin");l(this,"isPredictive",!1);l(this,"speedMultiplier",1);l(this,"magnetTarget");l(this,"trail");l(this,"trailPoints",[]);l(this,"lastKickType","shot");e.add.existing(this),e.physics.add.existing(this),this.setCircle(8,2,2),this.setBounce(Tt),this.setCollideWorldBounds(!0),this.setDrag(30),this.setMaxVelocity(W,W),this.setDepth(15),this.prevX=t,this.prevY=i,this.trail=e.add.graphics(),this.trail.setDepth(14)}update(e){this.prevX=this.x,this.prevY=this.y,this.owner?this.followOwner():(this.updatePhysics(e),this.applyReceiveAssist()),this.updateTrail(),this.checkRebound(),this.isBoomerang&&this.boomerangOrigin&&this.isLoose&&this.handleBoomerang(),this.magnetTarget&&this.handleMagnet()}followOwner(){var i,s;if(!this.owner)return;const e=((s=(i=this.owner).getBallOffset)==null?void 0:s.call(i))||{x:this.owner.x+25,y:this.owner.y},t=Math.sin(this.scene.time.now*.012)*2.5;this.setPosition(e.x+t*.5,e.y+t*.3),this.setVelocity(0,0),this.isLoose=!1}updatePhysics(e){const t=this.body.velocity,i=t.length();if(i>Ce){const s=this.lastKickType==="pass"?kt:bt;this.setVelocity(t.x*s,t.y*s)}if(this.spinAmount!==0&&i>50){const s=-t.y/i,o=t.x/i;this.setVelocity(t.x+s*this.spinAmount*i,t.y+o*this.spinAmount*i),this.spinAmount*=ys,Math.abs(this.spinAmount)<.001&&(this.spinAmount=0)}if(this.curveAmount!==0&&i>50){const s=-t.y/i,o=t.x/i;this.setVelocity(t.x+s*this.curveAmount*i*.05,t.y+o*this.curveAmount*i*.05),this.curveAmount*=.98}if(i>W){const s=W/i;this.setVelocity(t.x*s,t.y*s)}i<Ce&&this.setVelocity(0,0)}updateTrail(){this.body.velocity.length()>150&&this.trailPoints.unshift({x:this.x,y:this.y,alpha:1}),this.trailPoints.length>12&&this.trailPoints.pop(),this.trailPoints.forEach(t=>{t.alpha*=.82}),this.trailPoints=this.trailPoints.filter(t=>t.alpha>.05),this.trail.clear(),this.trailPoints.forEach((t,i)=>{const s=7*(1-i/this.trailPoints.length);this.trail.fillStyle(16777215,t.alpha*.6),this.trail.fillCircle(t.x,t.y,s)})}checkRebound(){const e=this.body.velocity;this.lastShooter&&e.length()>50&&(this.isRebound=!0),e.length()<30&&this.scene.time.delayedCall(500,()=>{this.isRebound=!1,this.lastShooter=null})}handleBoomerang(){if(!this.boomerangOrigin)return;if(this.body.velocity.length()<100){const t=this.boomerangOrigin.x-this.x,i=this.boomerangOrigin.y-this.y;Math.sqrt(t*t+i*i)>30?this.setVelocity(t*2,i*2):(this.isBoomerang=!1,this.boomerangOrigin=void 0)}}handleMagnet(){if(!this.magnetTarget)return;const e=this.magnetTarget.x-this.x,t=this.magnetTarget.y-this.y,i=this.body.velocity;this.setVelocity(i.x+e*.025,i.y+t*.025)}kick(e,t,i=0,s="shot"){this.lastKickType=s;const o=Math.sqrt(e.x*e.x+e.y*e.y)||1,n=e.x/o,r=e.y/o,c=Math.min(t*this.speedMultiplier,W);this.setVelocity(n*c,r*c),i!==0&&s==="shot"&&(this.spinAmount=i),s==="shot"&&(this.trailPoints=[]),this.speedMultiplier=1}shoot(e,t,i){this.owner=null,this.lastOwner=i,this.lastShooter=i,this.isLoose=!0;const s={x:Math.cos(t),y:Math.sin(t)},o=Ze*(Math.random()-.5)*2;this.kick(s,e,o,"shot")}recordShotOrigin(e,t,i,s){this.lastShotTeam=i,this.lastShotFromInsideD=s,this.lastShotTime=this.scene.time.now,this.lastShotX=e,this.lastShotY=t,console.log(`[SHOT_ORIGIN] Team: ${i}, InD: ${s}, Pos: (${Math.round(e)}, ${Math.round(t)})`)}isLastShotRecent(){return this.scene.time.now-this.lastShotTime<pe}clearShotOrigin(){this.lastShotTeam="none",this.lastShotFromInsideD=!1,this.lastShotTime=0,this.lastShotX=0,this.lastShotY=0}registerTouch(e,t,i,s,o,n){const r=this.scene.time.now;n&&(this.lastTouchInDTeam=e,this.lastTouchInDTime=r,this.lastTouchInDKind=o,this.lastTouchInDX=i,this.lastTouchInDY=s,this.lastToucherId=t,console.log(`[TOUCH_IN_D] Team: ${e}, Kind: ${o}, Pos: (${Math.round(i)}, ${Math.round(s)})`))}isLastTouchInDRecent(){return this.scene.time.now-this.lastTouchInDTime<pe}clearTouchTracking(){this.lastTouchInDTeam="none",this.lastTouchInDTime=0,this.lastTouchInDKind="none",this.lastTouchInDX=0,this.lastTouchInDY=0,this.lastToucherId=""}getTouchDebugInfo(){return{team:this.lastTouchInDTeam,kind:this.lastTouchInDKind,msAgo:this.scene.time.now-this.lastTouchInDTime,x:this.lastTouchInDX,y:this.lastTouchInDY}}pass(e,t,i,s){this.owner=null,this.lastOwner=i,this.isLoose=!0,this.intendedReceiver=s||null,this.passStartTime=this.scene.time.now,this.noRecaptureUntil=this.scene.time.now+fs;const o={x:Math.cos(t),y:Math.sin(t)};this.kick(o,e,0,"pass"),this.isBoomerang&&(this.boomerangOrigin={x:i.x,y:i.y})}canBePickedUpBy(e){return!(this.scene.time.now<this.noRecaptureUntil&&e===this.lastOwner)}applyReceiveAssist(){if(!this.intendedReceiver||!this.isLoose)return;if(this.scene.time.now-this.passStartTime>ms){this.intendedReceiver=null;return}const t=this.intendedReceiver,i=p.Math.Distance.Between(this.x,this.y,t.x,t.y);if(i<ps&&i>10){const s=t.x-this.x,o=t.y-this.y,n=this.body.velocity;this.setVelocity(n.x+s*Ne,n.y+o*Ne)}}attachTo(e){const t=this.lastPossessingTeam;return this.lastOwner=this.owner,this.owner=e,this.isLoose=!1,this.isRebound=!1,this.lastShooter=null,e&&(this.lastPossessingTeam=this.getTeamOf(e)),this.intendedReceiver=null,this.noRecaptureUntil=0,this.curveAmount=0,this.spinAmount=0,this.isBoomerang=!1,this.boomerangOrigin=void 0,this.isPredictive=!1,this.magnetTarget=void 0,t}getTeamOf(e){var t,i,s,o;return e?e.enemyType!==void 0||((t=e.constructor)==null?void 0:t.name)==="EnemyAI"?"enemy":(e.character!==void 0||((i=e.constructor)==null?void 0:i.name)==="Player"||((s=e.constructor)==null?void 0:s.name)==="TeammateAI"||((o=e.aiConfig)==null?void 0:o.role)!==void 0)&&e.enemyType===void 0?"player":"none":"none"}wasStolen(e,t){return e==="enemy"&&t==="player"}setLastPossessingTeam(e){this.lastPossessingTeam=e}drop(){this.lastOwner=this.owner,this.owner=null,this.isLoose=!0;const e=Math.random()*Math.PI*2,t=ve+Math.random()*(xt-ve);this.setVelocity(Math.cos(e)*t,Math.sin(e)*t)}resetToCenter(){this.setPosition(600,350),this.setVelocity(0,0),this.owner=null,this.lastOwner=null,this.lastShooter=null,this.isLoose=!0,this.isRebound=!1,this.prevX=600,this.prevY=350,this.lastPossessingTeam="none",this.clearShotOrigin(),this.clearTouchTracking(),this.trailPoints=[],this.trail.clear(),this.curveAmount=0,this.spinAmount=0,this.isBoomerang=!1,this.boomerangOrigin=void 0,this.isPredictive=!1,this.magnetTarget=void 0,this.speedMultiplier=1}setCurve(e){this.curveAmount=e}setSpin(e){this.spinAmount=e}setBoomerang(e){this.isBoomerang=e}setPredictive(e){this.isPredictive=e}setAerial(e){this.isAerial=e,e&&this.scene.tweens.add({targets:this,scaleY:1.5,duration:200,yoyo:!0})}setSpeedMultiplier(e){this.speedMultiplier=e}applyMagnet(e,t,i){this.magnetTarget={x:e,y:t},this.scene.time.delayedCall(100,()=>{this.magnetTarget=void 0})}wasRecentlyShot(){return this.lastShooter!==null&&this.body.velocity.length()>100}getPredictedPosition(e){const t=this.body.velocity;return{x:this.x+t.x*e*.001,y:this.y+t.y*e*.001}}getSpeed(){return this.body.velocity.length()}crossedLine(e,t){return t==="right"?this.prevX<e&&this.x>=e:this.prevX>e&&this.x<=e}destroy(e){this.trail.destroy(),super.destroy(e)}}class L{constructor(a){l(this,"scene");l(this,"fieldWidth",1200);l(this,"fieldHeight",700);l(this,"goalWidth",120);l(this,"playerTeamState","attack");l(this,"enemyTeamState","defend");l(this,"transitionTimer",0);l(this,"enemyDefenseAssignments",new Map);l(this,"teammateDefenseAssignments",new Map);l(this,"lastPlannerUpdate",0);l(this,"playerTeamChasers",new Set);l(this,"enemyTeamChasers",new Set);l(this,"primaryChaser",new Map);l(this,"lastPassTime",new Map);l(this,"lastDecisionTime",new Map);l(this,"tackleBackoffUntil",new Map);l(this,"tackleStats",{attempts:0,successes:0,blockedByCooldown:0,blockedByAngle:0,blockedByRange:0});l(this,"entityLastPositions",new Map);l(this,"currentObjective",{type:"score",timeRemaining:60,targetTeam:"player",urgency:0});l(this,"difficultyMultiplier",1);l(this,"momentNumber",1);l(this,"activePlay",null);l(this,"playExpiresAt",0);l(this,"inDPossessionTime",new Map);l(this,"lastFinishCheckTime",new Map);l(this,"entityStuckCounter",new Map);l(this,"playerTeamDefender",null);l(this,"enemyTeamDefender",null);this.scene=a}setObjective(a){this.currentObjective=a}setActivePlay(a){this.activePlay=a,this.playExpiresAt=this.scene.time.now+8e3}getActivePlay(){return this.scene.time.now>this.playExpiresAt&&(this.activePlay=null),this.activePlay}setDifficulty(a,e=!1){this.momentNumber=a,this.difficultyMultiplier=1+(a-1)*.05+(e?.2:0)}updateTeamStates(a,e,t,i,s){const o=this.isTeamHasBall(a,e,t),n=this.isEnemyHasBall(a,i);this.handleTransitions(o,n,s);const r=this.scene.time.now;r-this.lastPlannerUpdate>=as&&(this.lastPlannerUpdate=r,o&&this.runDefensePlanner(i,a,e,t,!1),n&&this.runDefensePlanner(t,a,e,i,!0)),this.playerTeamChasers.clear(),this.enemyTeamChasers.clear()}runDefensePlanner(a,e,t,i,s){const o=e.owner;if(!o)return;const n=s?this.teammateDefenseAssignments:this.enemyDefenseAssignments,r=this.scene.time.now,c=a.map(g=>({entity:g,dist:p.Math.Distance.Between(g.x,g.y,o.x,o.y),currentAssignment:n.get(g)}));c.sort((g,y)=>g.dist-y.dist),c.some(g=>{const y=g.currentAssignment;return y?!(r-y.assignedAt<ze):!0});const h=s?this.fieldWidth-30:30,d=this.fieldHeight/2,f=p.Math.Distance.Between(o.x,o.y,h,d)<os,u=a.length;for(let g=0;g<c.length;g++){const{entity:y,dist:b,currentAssignment:T}=c[g];if(T&&r-T.assignedAt<ze){this.updateDefenseTarget(T,o,h,d,i,f,s);continue}let x,w;if(g===0)x="PRIMARY_PRESSER",w={x:o.x,y:o.y};else if(g===1&&u>=2)f||u<=2?(x="SHOT_BLOCKER",w=this.getShotBlockerPosition(o,h,d)):(x="SECOND_PRESSER",w=this.getSecondPresserPosition(o,h,d));else if(g===u-1||g===2&&u===3)x="LAST_MAN",w=this.getLastManPosition(o,e,h,d,f);else{const S=this.findUnmarkedAttacker(y,i,o,n);S?(x="MARKER",w=this.getMarkingPosition(S,h,d)):(x="SHOT_BLOCKER",w=this.getShotBlockerPosition(o,h,d))}const D=x==="PRIMARY_PRESSER"&&b<re+20;n.set(y,{entity:y,role:x,target:w,assignedAt:r,inCommitMode:D,commitUntil:D?r+Ye:0})}}updateDefenseTarget(a,e,t,i,s,o,n){const r=this.scene.time.now;switch(a.role){case"PRIMARY_PRESSER":a.target={x:e.x,y:e.y},p.Math.Distance.Between(a.entity.x,a.entity.y,e.x,e.y)<re+20&&!a.inCommitMode&&(a.inCommitMode=!0,a.commitUntil=r+Ye),r>a.commitUntil&&(a.inCommitMode=!1);break;case"SECOND_PRESSER":a.target=this.getSecondPresserPosition(e,t,i);break;case"SHOT_BLOCKER":a.target=this.getShotBlockerPosition(e,t,i);break;case"LAST_MAN":const h=this.scene.registry.get("ball");a.target=this.getLastManPosition(e,h,t,i,o);break}}getSecondPresserPosition(a,e,t){const i=Math.atan2(t-a.y,e-a.x),s=80;return{x:a.x+Math.cos(i)*s,y:a.y+Math.sin(i)*s}}getShotBlockerPosition(a,e,t){const i=ls;return{x:p.Math.Linear(a.x,e,i),y:p.Math.Linear(a.y,t,i)}}getLastManPosition(a,e,t,i,s){const o=(e==null?void 0:e.x)??a.x,n=(e==null?void 0:e.y)??a.y,r=t-o,c=i-n,h=Math.sqrt(r*r+c*c)||1,d=s?ns:rs;let m=t-r/h*d,f=i-c/h*d*.5;return f=p.Math.Linear(f,n,.3),m=p.Math.Clamp(m,50,this.fieldWidth-50),f=p.Math.Clamp(f,150,this.fieldHeight-150),{x:m,y:f}}getMarkingPosition(a,e,t){return{x:p.Math.Linear(a.x,e,.25),y:a.y}}findUnmarkedAttacker(a,e,t,i){for(const s of e){if(s===t)continue;let o=!1;if(i.forEach(n=>{if(n.role==="MARKER"){const r=n.target;p.Math.Distance.Between(r.x,r.y,s.x,s.y)<50&&(o=!0)}}),!o)return s}return null}getDefenderDecision(a,e,t,i,s,o,n){const r=o?30:this.fieldWidth-30,c=this.fieldHeight/2;if(n){const T=(o?i:s.filter(w=>w!==a)).find(w=>Math.abs(w.x-r)>150);return T&&!this.isOnPassCooldown(a)?(console.log("[DEFENDER] Safe clearance pass"),this.setPassCooldown(a),{action:"pass",targetEntity:T,priority:10}):{action:"move",targetX:o?a.x+80:a.x-80,targetY:a.y,priority:8}}o?r+this.fieldWidth*.25:r-this.fieldWidth*.25;const h=o?this.fieldWidth*.55:this.fieldWidth*.45,d=o?s:[t,...i],m=H;let f=e.owner,u=1/0;for(const b of d){const T=p.Math.Distance.Between(b.x,b.y,r,c);T<u&&(u=T,f=b)}if(f&&u<m){const b=p.Math.Distance.Between(a.x,a.y,f.x,f.y);return console.log("[DEFENDER] Attacker in D! Closing down aggressively"),b<50&&f.hasBall?{action:"tackle",targetEntity:f,priority:15}:{action:"move",targetX:f.x,targetY:f.y,priority:14}}const g=o?Math.min(Math.max(e.x-60,r+80),h):Math.max(Math.min(e.x+60,r-80),h);let y=e.y;return f&&(y=(e.y+f.y)/2),y=p.Math.Clamp(y,100,this.fieldHeight-100),console.log(`[DEFENDER] Holding position at (${Math.round(g)}, ${Math.round(y)})`),{action:"move",targetX:g,targetY:y,priority:8}}getEnemyDecision(a,e,t,i,s,o,n=0){var h;if(this.isAssignedDefender(a,!1))return this.getDefenderDecision(a,e,t,i,s,!1,o);const r=this.enemyDefenseAssignments.get(a);if(o)return this.getOffensiveDecision(a,e,t,i,s,!1);if(e.owner===null)return this.getLooseBallDecision(a,e,t,i,s,!1,n);if(this.isEnemyHasBall(e,s))return this.getSupportDecision(a,e,s,!1,n);if(r)return this.executeDefenseAssignment(a,r,e,t,i);const c=this.getFormationPosition(a,((h=a.aiConfig)==null?void 0:h.role)||"midfielder",n,!1,e);return{action:"move",targetX:c.x,targetY:c.y,priority:3}}getTeammateDecision(a,e,t,i,s,o,n=0){var h;if(this.isAssignedDefender(a,!0))return this.getDefenderDecision(a,e,t,i,s,!0,o);const r=this.teammateDefenseAssignments.get(a);if(o)return this.getTeammateOffensiveDecision(a,e,t,i,s);if(e.owner===null)return this.getLooseBallDecision(a,e,t,i,s,!0,n);if(this.isTeamHasBall(e,t,i))return this.getTeammateSupportDecision(a,e,t,i,s,n);if(r)return this.executeDefenseAssignment(a,r,e,s[0],s);const c=this.getFormationPosition(a,((h=a.aiConfig)==null?void 0:h.role)||"midfielder",n,!0,e);return{action:"move",targetX:c.x,targetY:c.y,priority:3}}executeDefenseAssignment(a,e,t,i,s){var n;const o=p.Math.Distance.Between(a.x,a.y,i.x,i.y);switch(this.scene.time.now,e.role){case"PRIMARY_PRESSER":if(e.inCommitMode||o<Y)if(this.isTackleOnCooldown(a))this.recordTackleBlocked("cooldown");else if(o<re){const r=o<Y*je,c=i.x-a.x,h=i.y-a.y,d=((n=a.body)==null?void 0:n.velocity)||{x:0,y:0},m=Math.sqrt(d.x*d.x+d.y*d.y)||1,f=(c*d.x+h*d.y)/(o*m);if(!(r||f>Xt))this.recordTackleBlocked("angle");else if(Math.random()<Le)return{action:"tackle",targetEntity:i,priority:10}}else this.recordTackleBlocked("range");return{action:"move",targetX:i.x,targetY:i.y,priority:9};case"SECOND_PRESSER":if(o<Y){if(this.isTackleOnCooldown(a))this.recordTackleBlocked("cooldown");else if(Math.random()<Le*.8)return{action:"tackle",targetEntity:i,priority:9}}return{action:"move",targetX:e.target.x,targetY:e.target.y,priority:8};case"SHOT_BLOCKER":return{action:"move",targetX:e.target.x,targetY:e.target.y,priority:7};case"LAST_MAN":return{action:"move",targetX:e.target.x,targetY:e.target.y,priority:8};case"MARKER":return{action:"move",targetX:e.target.x,targetY:e.target.y,priority:6};default:return{action:"move",targetX:e.target.x,targetY:e.target.y,priority:5}}}isInsideAttackingD(a,e,t){const i=t?this.fieldWidth-30:30,s=this.fieldHeight/2;return p.Math.Distance.Between(a,e,i,s)<=H}assignDefenders(a,e){a.length>0&&(this.playerTeamDefender=a.reduce((t,i)=>{var n,r;const s=((n=i.stats)==null?void 0:n.speed)||i.speed||100,o=((r=t.stats)==null?void 0:r.speed)||t.speed||100;return s<o?i:t},a[0]),this.playerTeamDefender&&(this.playerTeamDefender.assignedRole="DEFENDER",console.log(`[DEFENDER] Player team defender assigned: ${this.playerTeamDefender.id||"teammate"}`))),e.length>0&&(this.enemyTeamDefender=e.reduce((t,i)=>{var n,r;const s=((n=i.stats)==null?void 0:n.speed)||i.speed||100,o=((r=t.stats)==null?void 0:r.speed)||t.speed||100;return s<o?i:t},e[0]),this.enemyTeamDefender&&(this.enemyTeamDefender.assignedRole="DEFENDER",console.log(`[DEFENDER] Enemy team defender assigned: ${this.enemyTeamDefender.id||"enemy"}`)))}isAssignedDefender(a,e){return e?a===this.playerTeamDefender:a===this.enemyTeamDefender}getOffensiveDecision(a,e,t,i,s,o){const n=o?this.fieldWidth-30:30,r=this.fieldHeight/2,c=o?this.fieldWidth-30:30,h=o?s:[t,...i],d=o?i:s.filter(P=>P!==a),m=p.Math.Distance.Between(a.x,a.y,n,r),f=Math.abs(a.x-c);this.scene.time.now;const u=H,g=this.isInsideAttackingD(a.x,a.y,o);if(g){const P=this.inDPossessionTime.get(a)||0;this.inDPossessionTime.set(a,P+16)}else this.inDPossessionTime.set(a,0);const y=this.inDPossessionTime.get(a)||0;if(a.body&&Math.abs(a.body.velocity.x)<5&&Math.abs(a.body.velocity.y)<5&&g){const P=(this.entityStuckCounter.get(a)||0)+1;this.entityStuckCounter.set(a,P)}else this.entityStuckCounter.set(a,0);const T=(this.entityStuckCounter.get(a)||0)>15,x=g&&f<zt,w=y>$t,D=f<25;if(g&&(x||w||T||D)){console.log(`[AI FINISH] enter finish state - inD=${g} closeRange=${x} stall=${w} stuck=${T} atGoalLine=${D}`),this.inDPossessionTime.set(a,0),this.entityStuckCounter.set(a,0);const P=h.filter(O=>p.Math.Distance.Between(a.x,a.y,O.x,O.y)<60&&Math.abs(O.x-n)<Math.abs(a.x-n)),R=d.filter(O=>p.Math.Distance.Between(O.x,O.y,n,r)<u&&O!==a);let B="closeRange";if(w&&(B="stallTimeout"),T&&(B="stuck"),D&&(B="atGoalLine"),P.length>=2&&R.length>0&&!this.isOnPassCooldown(a)){const O=R[0];return console.log(`[AI FINISH] action=pass reason=${B} blockers=${P.length}`),this.setPassCooldown(a),{action:"pass",targetEntity:O,priority:15}}if(D){const O=a.y+(a.y>r?-30:30),ie=p.Math.Clamp(O,100,this.fieldHeight-100);return console.log(`[AI FINISH] action=strafeShoot reason=${B} strafeY=${Math.round(ie)}`),{action:"shoot",targetX:n,targetY:r+(Math.random()-.5)*50,priority:15}}const I=r+(Math.random()>.5?-40:40);return console.log(`[AI FINISH] action=shoot reason=${B} distToGoal=${Math.round(m)}`),{action:"shoot",targetX:n,targetY:I,priority:15}}const A=h.filter(P=>p.Math.Distance.Between(a.x,a.y,P.x,P.y)<jt).length>0;if(g&&m<Vt){const P=h.filter(I=>p.Math.Distance.Between(a.x,a.y,I.x,I.y)<80&&Math.abs(I.x-n)<Math.abs(a.x-n)),R=Math.atan2(r-a.y,n-a.x),B=o?Math.abs(R)<Fe:Math.abs(Math.abs(R)-Math.PI)<Fe;if(P.length<=1&&B)return console.log(`[AI] Taking shot: inside D (dist=${Math.round(m)})`),{action:"shoot",targetX:n,targetY:r+(Math.random()-.5)*60,priority:10}}else if(!g){console.log(`[AI] Shot blocked: outside D (dist=${Math.round(m)}) -> switching to PASS/DRIVE`);const P=d.find(I=>this.isInsideAttackingD(I.x,I.y,o)),R=d.find(I=>p.Math.Distance.Between(I.x,I.y,n,r)<m);if(P&&!this.isOnPassCooldown(a)&&!this.isPassLaneBlocked(a,P,h))return console.log("[AI] Passing into D to teammate"),this.setPassCooldown(a),{action:"pass",targetEntity:P,priority:11};if(R&&A&&!this.isOnPassCooldown(a)&&!this.isPassLaneBlocked(a,R,h))return console.log("[AI] Passing to teammate closer to D"),this.setPassCooldown(a),{action:"pass",targetEntity:R,priority:9};const B=this.getDEntryPoint(a,n,r,o);return console.log(`[AI] Driving toward D entry at (${Math.round(B.x)}, ${Math.round(B.y)})`),{action:"move",targetX:B.x,targetY:B.y,priority:8}}if(A&&!this.isOnPassCooldown(a)&&d.length>0){const P=this.findBestPassTarget(a,d,h,o);if(P)return this.setPassCooldown(a),{action:"pass",targetEntity:P,priority:9}}const M=this.getDEntryPoint(a,n,r,o);return{action:"move",targetX:M.x,targetY:M.y,priority:5}}getDEntryPoint(a,e,t,i){const s=H-20,n=a.y<t?t-s*.5:t+s*.5;return{x:i?this.fieldWidth-30-s*.8:30+s*.8,y:n}}getTeammateOffensiveDecision(a,e,t,i,s){return this.fieldWidth-30,this.fieldHeight/2,t.isCallingForPass&&!this.isOnPassCooldown(a)&&!this.isPassLaneBlocked(a,t,s)?(this.setPassCooldown(a),{action:"pass",targetEntity:t,priority:12}):this.getOffensiveDecision(a,e,t,i,s,!0)}getSupportDecision(a,e,t,i,s){const o=e.owner;if(!o)return this.getFormationDecision(a,i,s,e);i&&this.fieldWidth-30;const n=this.getTriangleSupportPosition(a,o,t,i);return{action:"move",targetX:n.x,targetY:n.y,priority:6}}getTeammateSupportDecision(a,e,t,i,s,o){const n=e.owner;if(!n)return this.getFormationDecision(a,!0,o,e);const r=this.getTriangleSupportPosition(a,n,[t,...i],!0);return{action:"move",targetX:r.x,targetY:r.y,priority:6}}getTriangleSupportPosition(a,e,t,i){const s=i?this.fieldWidth-30:30,o=this.fieldHeight/2,n=p.Math.Distance.Between(e.x,e.y,s,o);p.Math.Distance.Between(a.x,a.y,s,o);const r=H;if(n>r&&n<r*2.5){const f=a.y<o?o-r*.4:o+r*.4,u=i?this.fieldWidth-30-r*.6:30+r*.6;return console.log("[SUPPORT] Moving into D as pass option"),{x:u,y:f}}const c=Math.atan2(o-e.y,s-e.x),h=a.y<e.y?c-Math.PI/4:c+Math.PI/4;let d=e.x+Math.cos(h)*Xe,m=e.y+Math.sin(h)*Xe;return i?d=Math.max(d,e.x+30):d=Math.min(d,e.x-30),{x:p.Math.Clamp(d,80,this.fieldWidth-80),y:p.Math.Clamp(m,80,this.fieldHeight-80)}}getLooseBallDecision(a,e,t,i,s,o,n){var m,f;const r=p.Math.Distance.Between(a.x,a.y,e.x,e.y),c=((m=a.aiConfig)==null?void 0:m.role)||"midfielder";let h;switch(c){case"forward":h=380;break;case"midfielder":h=320;break;case"defender":h=220;break;default:h=280}const d=o?[t,...i]:s;if(r<h&&this.canChaseLooseBall(a,e,d,o)){const u=((f=e.getPredictedPosition)==null?void 0:f.call(e,280))||{x:e.x,y:e.y};return{action:"move",targetX:u.x,targetY:u.y,priority:9}}return this.getFormationDecision(a,o,n,e)}getFormationDecision(a,e,t,i){var o;const s=this.getFormationPosition(a,((o=a.aiConfig)==null?void 0:o.role)||"midfielder",t,e,i);return{action:"move",targetX:s.x,targetY:s.y,priority:3}}getFormationPosition(a,e,t,i,s){const o=(s==null?void 0:s.x)||this.fieldWidth/2;let n,r;if(i)switch(e){case"defender":n=Math.min(o-120,220),r=this.fieldHeight/2+(t%2===0?-120:120);break;case"midfielder":n=Math.max(Math.min(o-40,550),200),r=this.fieldHeight/2+(t%2===0?-170:170);break;case"forward":n=Math.min(o+120,this.fieldWidth-180),r=this.fieldHeight/2+(t%2===0?-80:80);break;default:n=this.fieldWidth*.4,r=this.fieldHeight/2}else switch(e){case"defender":n=Math.max(o+120,this.fieldWidth-220),r=this.fieldHeight/2+(t%2===0?-120:120);break;case"midfielder":n=Math.min(Math.max(o+40,650),this.fieldWidth-200),r=this.fieldHeight/2+(t%2===0?-170:170);break;case"forward":n=Math.max(o-120,180),r=this.fieldHeight/2+(t%2===0?-80:80);break;default:n=this.fieldWidth*.6,r=this.fieldHeight/2}return{x:p.Math.Clamp(n,60,this.fieldWidth-60),y:p.Math.Clamp(r,60,this.fieldHeight-60)}}handleTransitions(a,e,t){this.transitionTimer>0?(this.transitionTimer-=t,this.transitionTimer<=0&&(this.playerTeamState==="transition"&&(this.playerTeamState=a?"attack":"defend"),this.enemyTeamState==="transition"&&(this.enemyTeamState=e?"attack":"defend"))):a&&this.playerTeamState==="defend"?(this.playerTeamState="transition",this.enemyTeamState="transition",this.transitionTimer=1e3):e&&this.enemyTeamState==="defend"&&(this.playerTeamState="transition",this.enemyTeamState="transition",this.transitionTimer=1e3)}isTeamHasBall(a,e,t){return a.owner?a.owner===e||t.includes(a.owner):!1}isEnemyHasBall(a,e){return a.owner?e.includes(a.owner):!1}isOnPassCooldown(a){const e=this.lastPassTime.get(a);return e?this.scene.time.now-e<Zt:!1}setPassCooldown(a){this.lastPassTime.set(a,this.scene.time.now)}isTackleOnCooldown(a){const e=this.tackleBackoffUntil.get(a)||0;return this.scene.time.now<e}setTackleBackoff(a,e=800){this.tackleBackoffUntil.set(a,this.scene.time.now+e)}recordTackleAttempt(a){this.tackleStats.attempts++,a&&this.tackleStats.successes++}recordTackleBlocked(a){switch(a){case"cooldown":this.tackleStats.blockedByCooldown++;break;case"angle":this.tackleStats.blockedByAngle++;break;case"range":this.tackleStats.blockedByRange++;break}}getTackleStats(){return{...this.tackleStats}}canChaseLooseBall(a,e,t,i){const s=i?this.playerTeamChasers:this.enemyTeamChasers;if(s.has(a))return!0;const o=t.map(r=>({entity:r,dist:p.Math.Distance.Between(r.x,r.y,e.x,e.y)}));return o.sort((r,c)=>r.dist-c.dist),o.findIndex(r=>r.entity===a)<Yt?(s.add(a),!0):!1}findBestPassTarget(a,e,t,i){if(e.length===0)return null;let s=null,o=-1/0;i&&this.fieldWidth;for(const n of e){if(n===a)continue;const r=p.Math.Distance.Between(a.x,a.y,n.x,n.y);if(r<qt||r>Qt)continue;let c=50;this.isPassLaneBlocked(a,n,t)?c-=40:c+=20,i&&n.x>a.x&&(c+=15),!i&&n.x<a.x&&(c+=15);let h=1/0;for(const d of t){const m=p.Math.Distance.Between(n.x,n.y,d.x,d.y);m<h&&(h=m)}h>80&&(c+=20),c>o&&(o=c,s=n)}return o>gs?s:null}isPassLaneBlocked(a,e,t){const i=e.x-a.x,s=e.y-a.y,o=Math.sqrt(i*i+s*s);if(o<1)return!1;const n=i/o,r=s/o;for(const c of t){const h=c.x-a.x,d=c.y-a.y,m=h*n+d*r;if(m<0||m>o)continue;if(Math.abs(h*r-d*n)<Jt)return!0}return!1}findDribbleTarget(a,e,t,i){let s=t-a.x,o=i-a.y;const n=Math.sqrt(s*s+o*o)||1;s/=n,o/=n;let r=0,c=0;for(const f of e){const u=a.x-f.x,g=a.y-f.y,y=Math.sqrt(u*u+g*g);if(y<120&&y>0){const b=(120-y)/120;r+=u/y*b,c+=g/y*b}}const h=s+r*.6,d=o+c*.6,m=Math.sqrt(h*h+d*d)||1;return{x:a.x+h/m*60,y:a.y+d/m*60}}getDefenseAssignment(a){return this.enemyDefenseAssignments.get(a)||this.teammateDefenseAssignments.get(a)}getAllDefenseAssignments(){return{enemies:Array.from(this.enemyDefenseAssignments.values()),teammates:Array.from(this.teammateDefenseAssignments.values())}}static createDefenderConfig(a=.5){return{role:"defender",aggressiveness:.4+a*.3,skill:.4+a*.4,speed:.85+a*.1,reactionTime:400-a*200}}static createMidfielderConfig(a=.5){return{role:"midfielder",aggressiveness:.5+a*.3,skill:.5+a*.3,speed:.9+a*.1,reactionTime:350-a*150}}static createForwardConfig(a=.5){return{role:"forward",aggressiveness:.6+a*.3,skill:.6+a*.3,speed:.95+a*.1,reactionTime:300-a*150}}static createSweeperConfig(a=.5){return{role:"sweeper",aggressiveness:.3+a*.2,skill:.5+a*.3,speed:.8+a*.1,reactionTime:300-a*100}}static createBossConfig(a){switch(a){case"pressMachine":return{role:"midfielder",aggressiveness:.95,skill:.7,speed:1.1,reactionTime:150};case"starForward":return{role:"forward",aggressiveness:.8,skill:.95,speed:1.2,reactionTime:100};default:return L.createForwardConfig(.8)}}}class bs extends p.Physics.Arcade.Sprite{constructor(e,t,i,s,o=0,n){super(e,t,i,`player_${o}`);l(this,"aiConfig");l(this,"aiSystem");l(this,"currentDecision");l(this,"decisionTimer",0);l(this,"currentState","idle");l(this,"lastPosition",{x:0,y:0});l(this,"stuckTime",0);l(this,"STUCK_THRESHOLD_MS",600);l(this,"STUCK_SPEED_THRESHOLD",5);l(this,"hasBall",!1);l(this,"isStunned",!1);l(this,"speed",180);l(this,"tackleRange",40);l(this,"passRange",300);l(this,"facingAngle",0);l(this,"player");l(this,"teammates",[]);l(this,"enemies",[]);l(this,"ball");l(this,"onShoot");l(this,"onPass");l(this,"onTackle");switch(s){case"defender":this.aiConfig=L.createDefenderConfig(.5);break;case"forward":this.aiConfig=L.createForwardConfig(.5);break;default:this.aiConfig=L.createMidfielderConfig(.5)}this.aiSystem=n||new L(e),this.lastPosition={x:t,y:i},this.stuckTime=0,e.add.existing(this),e.physics.add.existing(this),this.setCircle(20,4,8),this.setCollideWorldBounds(!0),this.setDepth(9),this.speed=180*this.aiConfig.speed}update(e){if(this.isStunned){this.setVelocity(this.body.velocity.x*.9,this.body.velocity.y*.9);return}const t=Math.sqrt(this.body.velocity.x**2+this.body.velocity.y**2),i=p.Math.Distance.Between(this.x,this.y,this.lastPosition.x,this.lastPosition.y);t<this.STUCK_SPEED_THRESHOLD&&i<3?(this.stuckTime+=e,this.stuckTime>this.STUCK_THRESHOLD_MS&&(this.decisionTimer=0,this.stuckTime=0,this.currentDecision=void 0)):this.stuckTime=0,this.lastPosition={x:this.x,y:this.y},this.decisionTimer-=e,this.decisionTimer<=0&&(this.makeDecision(),this.decisionTimer=this.aiConfig.reactionTime),this.executeDecision(e),this.updateVisuals()}makeDecision(){!this.ball||!this.player||(this.currentDecision=this.aiSystem.getTeammateDecision(this,this.ball,this.player,this.teammates,this.enemies,this.hasBall))}executeDecision(e){if(!this.currentDecision){this.currentState="no_decision";return}const t=this.currentDecision;switch(this.hasBall?this.currentState="CARRIER":t.action==="tackle"?this.currentState="PRESS":t.priority>=7?this.currentState="DEFEND":t.priority>=5?this.currentState="SUPPORT":this.currentState="SHAPE",t.action){case"move":this.currentState=this.hasBall?"CARRIER":t.priority>=6?"SUPPORT":"MOVE",this.moveToward(t.targetX,t.targetY,e);break;case"shoot":this.currentState="SHOOT",this.hasBall&&this.shoot(t.targetX,t.targetY);break;case"pass":this.currentState="PASS",this.hasBall&&t.targetEntity&&this.pass(t.targetEntity);break;case"tackle":!this.hasBall&&t.targetEntity&&this.tackle(t.targetEntity);break;case"wait":this.setVelocity(0,0);break}}moveToward(e,t,i){const s=e-this.x,o=t-this.y,n=Math.sqrt(s*s+o*o);if(n>5){const r=this.speed;this.setVelocity(s/n*r,o/n*r),this.facingAngle=Math.atan2(o,s)}else this.setVelocity(0,0)}shoot(e,t){if(!this.hasBall)return;const i=Math.atan2(t-this.y,e-this.x),o=p.Math.Distance.Between(this.x,this.y,e,t)<150,n=1e3+this.aiConfig.skill*150,r=o?n*.9:n,c=o?.1:.2,h=i+(Math.random()-.5)*c;this.hasBall=!1,console.log(`[TEAMMATE SHOOT] closeRange=${o} power=${Math.round(r)}`),this.onShoot&&this.onShoot(r,h)}pass(e){if(!this.hasBall||!e)return;const t=Math.atan2(e.y-this.y,e.x-this.x);this.hasBall=!1,this.onPass&&this.onPass(t,e)}tackle(e){if(!e)return;p.Math.Distance.Between(this.x,this.y,e.x,e.y)<this.tackleRange+20?this.onTackle&&this.onTackle(e):this.moveToward(e.x,e.y,16)}updateVisuals(){this.rotation=this.facingAngle*.1}receiveBall(){this.hasBall=!0}loseBall(){this.hasBall=!1}applyStun(e){this.isStunned=!0,this.scene.time.delayedCall(e,()=>{this.isStunned=!1}),this.scene.tweens.add({targets:this,tint:16711680,duration:100,yoyo:!0,repeat:Math.floor(e/200)})}applyDebuff(e,t){if(e==="slow"){const i=this.speed;this.speed*=.5,this.scene.time.delayedCall(t,()=>{this.speed=i})}}drainStamina(e){const t=this.speed;this.speed*=.8,this.scene.time.delayedCall(500,()=>{this.speed=t})}getBallOffset(){return{x:this.x+Math.cos(this.facingAngle)*25,y:this.y+Math.sin(this.facingAngle)*25}}getFacingAngle(){return this.facingAngle}setReferences(e,t,i,s){this.player=e,this.teammates=t.filter(o=>o!==this),this.enemies=i,this.ball=s}}class Ts extends p.Physics.Arcade.Sprite{constructor(e,t,i,s,o="normal",n=.5,r){let c="enemy_mid";switch(s){case"defender":c="enemy_defender";break;case"forward":c="enemy_forward";break}o==="boss"?c="enemy_boss":o==="orange"&&(c="enemy_orange");super(e,t,i,c);l(this,"aiConfig");l(this,"aiSystem");l(this,"currentDecision");l(this,"decisionTimer",0);l(this,"currentState","idle");l(this,"lastPosition",{x:0,y:0});l(this,"stuckTime",0);l(this,"STUCK_THRESHOLD_MS",600);l(this,"STUCK_SPEED_THRESHOLD",5);l(this,"enemyType");l(this,"role");l(this,"hasBall",!1);l(this,"isStunned",!1);l(this,"speed",180);l(this,"tackleRange",50);l(this,"shotPower",1100);l(this,"facingAngle",Math.PI);l(this,"player");l(this,"playerTeammates",[]);l(this,"enemyTeammates",[]);l(this,"ball");l(this,"onShoot");l(this,"onPass");l(this,"onTackle");if(this.enemyType=o,this.role=s,o==="boss")this.aiConfig=L.createBossConfig("starForward");else switch(s){case"defender":this.aiConfig=L.createDefenderConfig(n);break;case"forward":this.aiConfig=L.createForwardConfig(n);break;default:this.aiConfig=L.createMidfielderConfig(n)}this.aiSystem=r||new L(e),this.lastPosition={x:t,y:i},this.stuckTime=0,e.add.existing(this),e.physics.add.existing(this);const h=o==="boss"?24:20;this.setCircle(h,4,o==="boss"?4:8),this.setCollideWorldBounds(!0),this.setDepth(9),this.speed=180*this.aiConfig.speed,this.shotPower=1100+this.aiConfig.skill*200,this.tackleRange=50+this.aiConfig.skill*10,o==="boss"&&(this.speed*=1.25,this.shotPower*=1.2,this.tackleRange*=1.3),o==="orange"&&(this.speed*=.8)}update(e){if(this.isStunned){this.setVelocity(this.body.velocity.x*.9,this.body.velocity.y*.9);return}const t=Math.sqrt(this.body.velocity.x**2+this.body.velocity.y**2),i=p.Math.Distance.Between(this.x,this.y,this.lastPosition.x,this.lastPosition.y);t<this.STUCK_SPEED_THRESHOLD&&i<3?(this.stuckTime+=e,this.stuckTime>this.STUCK_THRESHOLD_MS&&(this.decisionTimer=0,this.stuckTime=0,this.currentDecision=void 0)):this.stuckTime=0,this.lastPosition={x:this.x,y:this.y},this.decisionTimer-=e,this.decisionTimer<=0&&(this.makeDecision(),this.decisionTimer=this.aiConfig.reactionTime),this.executeDecision(e),this.updateVisuals()}makeDecision(){!this.ball||!this.player||(this.currentDecision=this.aiSystem.getEnemyDecision(this,this.ball,this.player,this.playerTeammates,this.enemyTeammates,this.hasBall))}executeDecision(e){if(!this.currentDecision){this.currentState="no_decision";return}const t=this.currentDecision;switch(this.hasBall?this.currentState="CARRIER":t.action==="tackle"?this.currentState="PRESS":t.priority>=8?this.currentState="PRESS":t.priority>=6?this.currentState="SUPPORT":this.currentState="SHAPE",t.action){case"move":this.currentState=this.hasBall?"CARRIER":t.priority>=7?"PRESS":"MOVE",this.moveToward(t.targetX,t.targetY,e);break;case"shoot":this.currentState="SHOOT",this.hasBall&&this.shoot(t.targetX,t.targetY);break;case"pass":this.currentState="PASS",this.hasBall&&t.targetEntity&&this.pass(t.targetEntity);break;case"tackle":this.currentState="TACKLE",!this.hasBall&&t.targetEntity&&this.tackle(t.targetEntity);break;case"wait":this.currentState="WAIT",this.setVelocity(0,0);break}}moveToward(e,t,i){const s=e-this.x,o=t-this.y,n=Math.sqrt(s*s+o*o);n>5?(this.setVelocity(s/n*this.speed,o/n*this.speed),this.facingAngle=Math.atan2(o,s)):this.setVelocity(0,0)}shoot(e,t){if(!this.hasBall)return;const i=Math.atan2(t-this.y,e-this.x),o=p.Math.Distance.Between(this.x,this.y,e,t)<150,n=o?(1-this.aiConfig.skill)*.15:(1-this.aiConfig.skill)*.3,r=i+(Math.random()-.5)*n;this.hasBall=!1;const c=o?this.shotPower*.85:this.shotPower;console.log(`[AI SHOOT] range=${o?"close":"normal"} power=${Math.round(c)} angle=${r.toFixed(2)}`),this.onShoot&&this.onShoot(c,r)}pass(e){if(!this.hasBall||!e)return;const t=Math.atan2(e.y-this.y,e.x-this.x);this.hasBall=!1,this.onPass&&this.onPass(t,e)}tackle(e){if(!e)return;p.Math.Distance.Between(this.x,this.y,e.x,e.y)<this.tackleRange+20?this.onTackle&&this.onTackle(e):this.moveToward(e.x,e.y,16)}updateVisuals(){if(this.rotation=this.facingAngle*.1,this.enemyType==="boss"){const e=1+Math.sin(this.scene.time.now*.005)*.05;this.setScale(e)}}receiveBall(){this.hasBall=!0}loseBall(){this.hasBall=!1}applyStun(e){const t=this.enemyType==="boss"?e*.5:e,i=this.enemyType==="orange"?t*.3:t;this.isStunned=!0,this.scene.time.delayedCall(i,()=>{this.isStunned=!1}),this.scene.tweens.add({targets:this,tint:16776960,duration:100,yoyo:!0,repeat:Math.floor(i/200)})}applyDebuff(e,t){if(e==="slow"){const i=this.speed;this.speed*=.6,this.scene.time.delayedCall(t,()=>{this.speed=i}),this.setTint(3447003),this.scene.time.delayedCall(t,()=>{this.clearTint()})}}drainStamina(e){const t=this.speed;this.speed*=.7,this.scene.time.delayedCall(800,()=>{this.speed=t})}getBallOffset(){return{x:this.x+Math.cos(this.facingAngle)*25,y:this.y+Math.sin(this.facingAngle)*25}}getFacingAngle(){return this.facingAngle}setReferences(e,t,i,s){this.player=e,this.playerTeammates=t,this.enemyTeammates=i.filter(o=>o!==this),this.ball=s}bossAbility(){if(this.enemyType!=="boss")return;const e=this.speed;this.speed*=1.5,this.scene.time.delayedCall(1e3,()=>{this.speed=e}),this.scene.tweens.add({targets:this,alpha:.5,duration:100,yoyo:!0,repeat:4})}}const F=.85,le=32,ce=40;class xs extends p.Physics.Arcade.Sprite{constructor(e,t,i){const s=t-30,o=s-25,n=i/2;super(e,o,n,"enemy_gk_pro");l(this,"ball");l(this,"fieldWidth",1200);l(this,"fieldHeight",700);l(this,"isLunging",!1);l(this,"lungeEndTime",0);l(this,"lungeCooldownUntil",0);l(this,"lastReactionTime",0);l(this,"goalY");l(this,"goalTopY");l(this,"goalBottomY");l(this,"gkBoxMinX");l(this,"gkBoxMaxX");l(this,"goalLineX");l(this,"saveCount",0);l(this,"lungeAttempts",0);l(this,"helmetGraphic");l(this,"idleTimer",0);this.fieldWidth=t,this.fieldHeight=i,this.goalY=i/2,this.goalLineX=s,this.gkBoxMaxX=s-ue+30,this.gkBoxMinX=s-ge,this.goalTopY=this.goalY-j/2-Z,this.goalBottomY=this.goalY+j/2+Z,this.createGKTexture(e),e.add.existing(this),e.physics.add.existing(this),this.setScale(F),this.setCircle(le,-le+ce/2,-le+ce/2+5),this.setCollideWorldBounds(!0),this.setImmovable(!1),this.setDepth(12),this.startIdleAnimation(e),console.log(`[GK] ENEMY GK spawned at RIGHT goal (x=${Math.round(o)}, y=${n}), goalLine=${s}, scale=${F}`),console.log(`[GK] GK_BOX: X[${Math.round(this.gkBoxMinX)}-${Math.round(this.gkBoxMaxX)}], Y[${Math.round(this.goalTopY)}-${Math.round(this.goalBottomY)}]`)}createGKTexture(e){if(e.textures.exists("enemy_gk_pro")){this.setTexture("enemy_gk_pro");return}const t=e.add.graphics(),i=ce,s=i/2,o=i/2;t.fillStyle(3355443,1),t.fillRoundedRect(s-14,o+2,28,16,3),t.fillStyle(5592405,1),t.fillRect(s-12,o+4,4,12),t.fillRect(s+8,o+4,4,12),t.fillStyle(16724736,1),t.fillRoundedRect(s-10,o-8,20,18,4),t.lineStyle(2,16737792,1),t.strokeRect(s-8,o-6,16,14),t.fillStyle(16768256,1),t.fillRoundedRect(s-18,o-4,8,12,2),t.fillCircle(s+16,o+2,6),t.fillStyle(16729088,1),t.fillCircle(s,o-12,10),t.lineStyle(1.5,2236962,1),t.strokeCircle(s,o-12,8),t.beginPath(),t.moveTo(s-6,o-14),t.lineTo(s+6,o-14),t.moveTo(s-6,o-10),t.lineTo(s+6,o-10),t.moveTo(s,o-16),t.lineTo(s,o-8),t.strokePath(),t.fillStyle(16737792,1),t.fillRect(s-6,o-20,12,4),t.fillStyle(9127187,1),t.fillRect(s+12,o+4,3,14),t.fillStyle(16777215,1),t.fillRect(s+12,o+14,5,4),t.lineStyle(2,0,.5),t.strokeCircle(s,o-12,11),t.generateTexture("enemy_gk_pro",i,i),t.destroy(),this.setTexture("enemy_gk_pro")}startIdleAnimation(e){e.tweens.add({targets:this,y:this.y-3,duration:600,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}setBall(e){this.ball=e}update(e){var n;if(!this.ball)return;const t=this.scene.time.now;this.isLunging&&t>this.lungeEndTime&&(this.isLunging=!1,this.clearTint(),this.setScale(F));const i=this.ball.getSpeed(),o=(((n=this.ball.body)==null?void 0:n.velocity)||{x:0}).x>50;this.shouldLunge(i,o,t)?this.performLunge():this.isLunging||this.trackBall(e),this.constrainPosition()}shouldLunge(e,t,i){if(this.isLunging||i<this.lungeCooldownUntil||i-this.lastReactionTime<Qe||(this.lastReactionTime=i,!t)||e<Je||p.Math.Distance.Between(this.x,this.y,this.ball.x,this.ball.y)>200)return!1;const o=this.ball.y+this.ball.body.velocity.y*se;return o>this.goalTopY&&o<this.goalBottomY}performLunge(){if(!this.ball)return;this.isLunging=!0,this.lungeAttempts++,this.lungeEndTime=this.scene.time.now+te,this.lungeCooldownUntil=this.scene.time.now+qe;const e=se,t=this.ball.x+this.ball.body.velocity.x*e,i=this.ball.y+this.ball.body.velocity.y*e,s=p.Math.Clamp(t,this.gkBoxMinX,this.gkBoxMaxX),o=p.Math.Clamp(i,this.goalTopY,this.goalBottomY),n=s-this.x,r=o-this.y,c=Math.sqrt(n*n+r*r)||1;this.setVelocity(n/c*ee,r/c*ee),this.setTint(16776960),this.scene.tweens.add({targets:this,scaleX:F*1.25,scaleY:F*.75,duration:te/2,yoyo:!0,ease:"Quad.easeOut",onComplete:()=>{this.setScale(F)}}),console.log(`[GK] Lunge toward (${Math.round(s)}, ${Math.round(o)})`)}trackBall(e){var h;if(!this.ball)return;let t=this.ball.y;const i=((h=this.ball.body)==null?void 0:h.velocity)||{x:0,y:0};Math.abs(i.x)>50&&(t=this.ball.y+i.y*.15),t=p.Math.Clamp(t,this.goalTopY,this.goalBottomY);let s=this.gkBoxMaxX-10;const o=p.Math.Distance.Between(this.x,this.y,this.ball.x,this.ball.y);o<150&&this.ball.x>this.fieldWidth-250&&(s=p.Math.Clamp(p.Math.Linear(this.gkBoxMaxX,this.gkBoxMinX,1-o/150),this.gkBoxMinX,this.gkBoxMaxX));const n=s-this.x,r=t-this.y,c=Math.sqrt(n*n+r*r);if(c>5){const d=Math.min(Ve,c*8);this.setVelocity(n/c*d*.3,r/c*d)}else this.setVelocity(0,0)}constrainPosition(){this.x=p.Math.Clamp(this.x,this.gkBoxMinX-10,this.gkBoxMaxX),this.y=p.Math.Clamp(this.y,this.goalTopY,this.goalBottomY)}onBallContact(e){if(e.getSpeed()<100)return;this.saveCount++,Math.atan2(e.y-this.y,e.x-this.x);const i=Math.PI+(Math.random()-.5)*1.2;e.setVelocity(-Math.abs(Math.cos(i))*z,Math.sin(i)*z*.8),e.isLoose=!0,e.owner=null,this.showSaveEffect(),console.log(`[GK] SAVE at RIGHT goal! Ball deflected LEFT. Total saves: ${this.saveCount}`)}showSaveEffect(){this.setTint(65280),this.scene.tweens.add({targets:this,scaleX:F*1.2,scaleY:F*1.2,duration:100,yoyo:!0,ease:"Quad.easeOut",onComplete:()=>{this.setScale(F),this.clearTint()}}),this.scene.cameras.main.shake(120,.01);const e=this.scene.add.text(this.x+30,this.y-40,"ðŸ§¤ SAVE!",{fontFamily:"Arial Black, Arial, sans-serif",fontSize:"24px",color:"#00ff00",stroke:"#003300",strokeThickness:4});e.setOrigin(.5),e.setDepth(200),this.scene.tweens.add({targets:e,y:e.y-50,alpha:0,scaleX:1.4,scaleY:1.4,duration:900,ease:"Quad.easeOut",onComplete:()=>e.destroy()});const t=this.scene.audioSystem;t!=null&&t.playSteal&&t.playSteal()}reset(){this.setPosition(this.goalLineX-25,this.goalY),this.setVelocity(0,0),this.isLunging=!1,this.lungeEndTime=0,this.lungeCooldownUntil=0,this.clearTint(),this.setScale(F)}getGKBox(){return{minX:this.gkBoxMinX,maxX:this.gkBoxMaxX,minY:this.goalTopY,maxY:this.goalBottomY}}getStateString(){return this.isLunging?"GK_LUNGE":"GK_HOLD"}getDebugInfo(){return{saves:this.saveCount,lunges:this.lungeAttempts,isLunging:this.isLunging}}}const _=.85,he=32,de=40;class ws extends p.Physics.Arcade.Sprite{constructor(e,t,i,s){const o=s==="enemy",n=o?t-30:30,r=o?n-25:n+25,c=i/2;super(e,r,c,s==="player"?"player_gk_pro":"enemy_gk_pro");l(this,"team");l(this,"defendsRightGoal");l(this,"ball");l(this,"fieldWidth");l(this,"fieldHeight");l(this,"isLunging",!1);l(this,"lungeEndTime",0);l(this,"lungeCooldownUntil",0);l(this,"lastReactionTime",0);l(this,"goalY");l(this,"goalTopY");l(this,"goalBottomY");l(this,"gkBoxMinX");l(this,"gkBoxMaxX");l(this,"goalLineX");l(this,"saveCount",0);l(this,"lungeAttempts",0);this.team=s,this.defendsRightGoal=o,this.fieldWidth=t,this.fieldHeight=i,this.goalY=i/2,this.goalLineX=n,o?(this.gkBoxMaxX=n-ue+30,this.gkBoxMinX=n-ge):(this.gkBoxMinX=n+ue-30,this.gkBoxMaxX=n+ge),this.goalTopY=this.goalY-j/2-Z,this.goalBottomY=this.goalY+j/2+Z,this.createGKTexture(e,s),e.add.existing(this),e.physics.add.existing(this),this.setScale(_),this.setCircle(he,-he+de/2,-he+de/2+5),this.setCollideWorldBounds(!0),this.setImmovable(!1),this.setDepth(12),this.startIdleAnimation(e);const d=o?"RIGHT":"LEFT";console.log(`[GK] ${s.toUpperCase()} GK spawned at ${d} goal (x=${Math.round(r)}, y=${c})`),console.log(`[GK] ${s} GK_BOX: X[${Math.round(this.gkBoxMinX)}-${Math.round(this.gkBoxMaxX)}], Y[${Math.round(this.goalTopY)}-${Math.round(this.goalBottomY)}]`)}createGKTexture(e,t){const i=t==="player"?"player_gk_pro":"enemy_gk_pro";if(e.textures.exists(i)){this.setTexture(i);return}const s=e.add.graphics(),o=de,n=o/2,r=o/2,c=t==="player"?3447003:16724736,h=t==="player"?2719929:16729088,d=t==="player"?6139362:16737792;s.fillStyle(3355443,1),s.fillRoundedRect(n-14,r+2,28,16,3),s.fillStyle(5592405,1),s.fillRect(n-12,r+4,4,12),s.fillRect(n+8,r+4,4,12),s.fillStyle(c,1),s.fillRoundedRect(n-10,r-8,20,18,4),s.lineStyle(2,d,1),s.strokeRect(n-8,r-6,16,14),s.fillStyle(16768256,1),s.fillRoundedRect(n-18,r-4,8,12,2),s.fillCircle(n+16,r+2,6),s.fillStyle(h,1),s.fillCircle(n,r-12,10),s.lineStyle(1.5,2236962,1),s.strokeCircle(n,r-12,8),s.beginPath(),s.moveTo(n-6,r-14),s.lineTo(n+6,r-14),s.moveTo(n-6,r-10),s.lineTo(n+6,r-10),s.moveTo(n,r-16),s.lineTo(n,r-8),s.strokePath(),s.fillStyle(d,1),s.fillRect(n-6,r-20,12,4),s.fillStyle(9127187,1),s.fillRect(n+12,r+4,3,14),s.fillStyle(16777215,1),s.fillRect(n+12,r+14,5,4),s.lineStyle(2,0,.5),s.strokeCircle(n,r-12,11),s.generateTexture(i,o,o),s.destroy(),this.setTexture(i)}startIdleAnimation(e){e.tweens.add({targets:this,y:this.y-3,duration:600,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}setBall(e){this.ball=e}update(e){var n;if(!this.ball)return;const t=this.scene.time.now;this.isLunging&&t>this.lungeEndTime&&(this.isLunging=!1,this.clearTint(),this.setScale(_));const i=((n=this.ball.body)==null?void 0:n.velocity)||{x:0,y:0},s=this.defendsRightGoal?i.x>50:i.x<-50,o=this.ball.getSpeed?this.ball.getSpeed():Math.sqrt(i.x*i.x+i.y*i.y);this.shouldLunge(o,s,t)?this.performLunge():this.isLunging||this.trackBall(e),this.constrainPosition()}shouldLunge(e,t,i){if(this.isLunging||i<this.lungeCooldownUntil||i-this.lastReactionTime<Qe||(this.lastReactionTime=i,!t)||e<Je||p.Math.Distance.Between(this.x,this.y,this.ball.x,this.ball.y)>200)return!1;const o=this.ball.y+this.ball.body.velocity.y*se;return o>this.goalTopY&&o<this.goalBottomY}performLunge(){if(!this.ball)return;this.isLunging=!0,this.lungeAttempts++,this.lungeEndTime=this.scene.time.now+te,this.lungeCooldownUntil=this.scene.time.now+qe;const e=se,t=this.ball.x+this.ball.body.velocity.x*e,i=this.ball.y+this.ball.body.velocity.y*e,s=p.Math.Clamp(t,this.gkBoxMinX,this.gkBoxMaxX),o=p.Math.Clamp(i,this.goalTopY,this.goalBottomY),n=s-this.x,r=o-this.y,c=Math.sqrt(n*n+r*r)||1;this.setVelocity(n/c*ee,r/c*ee),this.setTint(16776960),this.scene.tweens.add({targets:this,scaleX:_*1.25,scaleY:_*.75,duration:te/2,yoyo:!0,ease:"Quad.easeOut",onComplete:()=>this.setScale(_)}),console.log(`[GK] ${this.team} lunge toward (${Math.round(s)}, ${Math.round(o)})`)}trackBall(e){var c;if(!this.ball)return;let t=this.ball.y;const i=((c=this.ball.body)==null?void 0:c.velocity)||{x:0,y:0};Math.abs(i.x)>50&&(t=this.ball.y+i.y*.15),t=p.Math.Clamp(t,this.goalTopY,this.goalBottomY);let s;if(this.defendsRightGoal){s=this.gkBoxMaxX-10;const h=p.Math.Distance.Between(this.x,this.y,this.ball.x,this.ball.y);h<150&&this.ball.x>this.fieldWidth-250&&(s=p.Math.Clamp(p.Math.Linear(this.gkBoxMaxX,this.gkBoxMinX,1-h/150),this.gkBoxMinX,this.gkBoxMaxX))}else{s=this.gkBoxMinX+10;const h=p.Math.Distance.Between(this.x,this.y,this.ball.x,this.ball.y);h<150&&this.ball.x<250&&(s=p.Math.Clamp(p.Math.Linear(this.gkBoxMinX,this.gkBoxMaxX,1-h/150),this.gkBoxMinX,this.gkBoxMaxX))}const o=s-this.x,n=t-this.y,r=Math.sqrt(o*o+n*n);if(r>5){const h=Math.min(Ve,r*8);this.setVelocity(o/r*h*.3,n/r*h)}else this.setVelocity(0,0)}constrainPosition(){this.x=p.Math.Clamp(this.x,this.gkBoxMinX-10,this.gkBoxMaxX+10),this.y=p.Math.Clamp(this.y,this.goalTopY,this.goalBottomY)}onBallContact(e){if((e.getSpeed?e.getSpeed():Math.sqrt(e.body.velocity.x**2+e.body.velocity.y**2))<100)return;this.saveCount++;const i=Math.PI+(Math.random()-.5)*1.2;this.defendsRightGoal?e.setVelocity(-Math.abs(Math.cos(i))*z,Math.sin(i)*z*.8):e.setVelocity(Math.abs(Math.cos(i))*z,Math.sin(i)*z*.8),e.isLoose=!0,e.owner=null,this.showSaveEffect();const s=this.defendsRightGoal?"RIGHT":"LEFT";console.log(`[GK] ${this.team.toUpperCase()} SAVE at ${s} goal! Total saves: ${this.saveCount}`)}showSaveEffect(){this.setTint(65280),this.scene.tweens.add({targets:this,scaleX:_*1.2,scaleY:_*1.2,duration:100,yoyo:!0,ease:"Quad.easeOut",onComplete:()=>{this.setScale(_),this.clearTint()}}),this.scene.cameras.main.shake(120,.01);const e=(this.team==="player","ðŸ§¤"),t=this.scene.add.text(this.x+30,this.y-40,`${e} SAVE!`,{fontFamily:"Arial Black, Arial, sans-serif",fontSize:"24px",color:"#00ff00",stroke:"#003300",strokeThickness:4});t.setOrigin(.5),t.setDepth(200),this.scene.tweens.add({targets:t,y:t.y-40,alpha:0,duration:800,ease:"Quad.easeOut",onComplete:()=>t.destroy()})}reset(){const e=this.defendsRightGoal?this.goalLineX-25:this.goalLineX+25;this.setPosition(e,this.goalY),this.setVelocity(0,0),this.isLunging=!1,this.clearTint(),this.setScale(_)}getGKBox(){return{minX:this.gkBoxMinX,maxX:this.gkBoxMaxX,topY:this.goalTopY,bottomY:this.goalBottomY}}getStateString(){return this.isLunging?"LUNGE":"HOLD"}}class Cs{constructor(a){l(this,"scene");l(this,"cursors");l(this,"wasd");l(this,"actionKeys");l(this,"shootChargeStart",0);l(this,"lastMouseX",0);l(this,"lastMouseY",0);l(this,"hasMouseMoved",!1);l(this,"wasMouseDown",!1);l(this,"aimAssistStrength",.5);this.scene=a,this.setupKeyboard(),this.setupMouseTracking()}setupKeyboard(){this.scene.input.keyboard&&(this.cursors=this.scene.input.keyboard.createCursorKeys(),this.wasd={W:this.scene.input.keyboard.addKey(p.Input.Keyboard.KeyCodes.W),A:this.scene.input.keyboard.addKey(p.Input.Keyboard.KeyCodes.A),S:this.scene.input.keyboard.addKey(p.Input.Keyboard.KeyCodes.S),D:this.scene.input.keyboard.addKey(p.Input.Keyboard.KeyCodes.D)},this.actionKeys={space:this.scene.input.keyboard.addKey(p.Input.Keyboard.KeyCodes.SPACE),shift:this.scene.input.keyboard.addKey(p.Input.Keyboard.KeyCodes.SHIFT),e:this.scene.input.keyboard.addKey(p.Input.Keyboard.KeyCodes.E),q:this.scene.input.keyboard.addKey(p.Input.Keyboard.KeyCodes.Q),r:this.scene.input.keyboard.addKey(p.Input.Keyboard.KeyCodes.R),escape:this.scene.input.keyboard.addKey(p.Input.Keyboard.KeyCodes.ESC),enter:this.scene.input.keyboard.addKey(p.Input.Keyboard.KeyCodes.ENTER),p:this.scene.input.keyboard.addKey(p.Input.Keyboard.KeyCodes.P),h:this.scene.input.keyboard.addKey(p.Input.Keyboard.KeyCodes.H)})}setupMouseTracking(){this.scene.input.on("pointermove",a=>{(Math.abs(a.x-this.lastMouseX)>5||Math.abs(a.y-this.lastMouseY)>5)&&(this.hasMouseMoved=!0,this.lastMouseX=a.x,this.lastMouseY=a.y)})}getState(a=0,e=0){const t={moveX:0,moveY:0,isMoving:!1,shoot:!1,shootHeld:!1,shootReleased:!1,pass:!1,tackle:!1,dodge:!1,callForPass:!1,aimAngle:0,aimX:0,aimY:0,mouseDown:!1,mouseJustDown:!1,hasMouseMoved:this.hasMouseMoved,pause:!1,confirm:!1,cancel:!1,showHelp:!1};if(this.cursors&&(this.cursors.left.isDown&&(t.moveX-=1),this.cursors.right.isDown&&(t.moveX+=1),this.cursors.up.isDown&&(t.moveY-=1),this.cursors.down.isDown&&(t.moveY+=1)),this.wasd&&(this.wasd.A.isDown&&(t.moveX-=1),this.wasd.D.isDown&&(t.moveX+=1),this.wasd.W.isDown&&(t.moveY-=1),this.wasd.S.isDown&&(t.moveY+=1)),t.moveX!==0&&t.moveY!==0){const o=Math.sqrt(t.moveX*t.moveX+t.moveY*t.moveY);t.moveX/=o,t.moveY/=o}if(t.isMoving=t.moveX!==0||t.moveY!==0,this.actionKeys){const o=this.actionKeys.space.isDown;t.shoot=p.Input.Keyboard.JustDown(this.actionKeys.space),t.shootHeld=o,t.shootReleased=p.Input.Keyboard.JustUp(this.actionKeys.space),t.shoot&&(this.shootChargeStart=this.scene.time.now),t.dodge=p.Input.Keyboard.JustDown(this.actionKeys.shift),t.pass=p.Input.Keyboard.JustDown(this.actionKeys.e),t.tackle=p.Input.Keyboard.JustDown(this.actionKeys.q),t.callForPass=p.Input.Keyboard.JustDown(this.actionKeys.r),t.pause=p.Input.Keyboard.JustDown(this.actionKeys.escape)||p.Input.Keyboard.JustDown(this.actionKeys.p),t.confirm=p.Input.Keyboard.JustDown(this.actionKeys.enter),t.cancel=p.Input.Keyboard.JustDown(this.actionKeys.escape),t.showHelp=p.Input.Keyboard.JustDown(this.actionKeys.h)}const i=this.scene.input.activePointer,s=this.scene.cameras.main.getWorldPoint(i.x,i.y);return t.aimX=s.x,t.aimY=s.y,t.mouseDown=i.isDown,t.mouseJustDown=i.isDown&&!this.wasMouseDown,this.wasMouseDown=i.isDown,this.hasMouseMoved?t.aimAngle=p.Math.Angle.Between(a,e,s.x,s.y):t.isMoving?t.aimAngle=Math.atan2(t.moveY,t.moveX):t.aimAngle=0,t.mouseJustDown&&!this.isOverUI(i.x,i.y)&&(t.shoot=!0,this.shootChargeStart===0&&(this.shootChargeStart=this.scene.time.now)),t}isOverUI(a,e){return e<130||e>this.scene.cameras.main.height-100}getAimWithAssist(a,e,t,i){const s=this.scene.input.activePointer,o=this.scene.cameras.main.getWorldPoint(s.x,s.y),n=p.Math.Angle.Between(a,e,o.x,o.y),r=p.Math.Angle.Between(a,e,t,i);if(!this.hasMouseMoved||this.aimAssistStrength===0)return r;const c=p.Math.Angle.Wrap(r-n);return Math.abs(c)<Math.PI/3?n+c*this.aimAssistStrength*.3:n}getShootChargeTime(){var a;return(a=this.actionKeys)!=null&&a.space.isDown||this.scene.input.activePointer.isDown?this.scene.time.now-this.shootChargeStart:0}getShootChargePct(){return Math.min(this.getShootChargeTime()/1e3,1)}resetCharge(){this.shootChargeStart=0}setAimAssistStrength(a){this.aimAssistStrength=p.Math.Clamp(a,0,1)}getAimAssistStrength(){return this.aimAssistStrength}isKeyDown(a){var t;const e=(t=this.scene.input.keyboard)==null?void 0:t.addKey(a);return(e==null?void 0:e.isDown)||!1}disable(){this.scene.input.keyboard&&(this.scene.input.keyboard.enabled=!1)}enable(){this.scene.input.keyboard&&(this.scene.input.keyboard.enabled=!0)}destroy(){}}const N={common:10395294,uncommon:5025616,rare:2201331,epic:10233776,legendary:16750592},vs={common:50,uncommon:30,rare:15,epic:4,legendary:1},K={dragFlick:"Drag Flick",press:"Press",trianglePassing:"Triangle Passing",rebound:"Rebound",trickster:"Trickster",tank:"Tank",speedster:"Speedster",vampire:"Vampire",chaos:"Chaos",precision:"Precision",guardian:"Guardian",berserker:"Berserker",counterPress:"Counter-Press",possession:"Possession",sweeper:"Sweeper-Keeper",weather:"Weather Master",poacher:"Poacher",aerial:"Aerial Threat"},et={dragFlick:16739179,press:16697943,trianglePassing:4774907,rebound:16752627,trickster:53971,tank:5727604,speedster:5546239,vampire:9109504,chaos:10181046,precision:1092740,guardian:15965202,berserker:15158332,counterPress:16742005,possession:7649791,sweeper:6516338,weather:8514796,poacher:16632686,aerial:10656766},tt=[{id:"quickFeet",name:"Quick Feet",description:"+10% movement speed",rarity:"common",synergies:["speedster"],hooks:["passive"],modifiers:[{stat:"speed",value:10,isPercent:!0}],effectId:"speedBoost10",icon:"ðŸ‘Ÿ",maxStacks:3},{id:"strongStick",name:"Strong Stick",description:"+15% shot power",rarity:"common",synergies:["dragFlick"],hooks:["passive"],modifiers:[{stat:"shotPower",value:15,isPercent:!0}],effectId:"shotPowerBoost15",icon:"ðŸ‘",maxStacks:3},{id:"softHands",name:"Soft Hands",description:"+15% ball control",rarity:"common",synergies:["trickster"],hooks:["passive"],modifiers:[{stat:"control",value:15,isPercent:!0}],effectId:"controlBoost15",icon:"ðŸ¤²",maxStacks:3},{id:"tackleTraining",name:"Tackle Training",description:"+15% tackle success",rarity:"common",synergies:["press"],hooks:["passive"],modifiers:[{stat:"tackle",value:15,isPercent:!0}],effectId:"tackleBoost15",icon:"âš”ï¸",maxStacks:3},{id:"passingDrills",name:"Passing Drills",description:"+15% pass accuracy",rarity:"common",synergies:["trianglePassing"],hooks:["passive"],modifiers:[{stat:"passPower",value:15,isPercent:!0}],effectId:"passBoost15",icon:"ðŸ“",maxStacks:3},{id:"staminaPack",name:"Stamina Pack",description:"+20% max stamina",rarity:"common",synergies:["speedster"],hooks:["passive"],modifiers:[{stat:"stamina",value:20,isPercent:!0}],effectId:"staminaBoost20",icon:"ðŸ’ª",maxStacks:3},{id:"nimbleDodge",name:"Nimble Dodge",description:"+10% dodge distance",rarity:"common",synergies:["trickster"],hooks:["passive"],modifiers:[{stat:"dodge",value:10,isPercent:!0}],effectId:"dodgeBoost10",icon:"ðŸ’¨",maxStacks:3},{id:"turfGrip",name:"Turf Grip",description:"+8% speed on your half",rarity:"common",synergies:["guardian"],hooks:["onTick"],modifiers:[],effectId:"homeHalfSpeed",icon:"ðŸŒ±"},{id:"warmUp",name:"Warm Up",description:"+10% all stats for first 10s of moment",rarity:"common",synergies:["press"],hooks:["onMomentStart","onTick"],modifiers:[],effectId:"warmUpBuff",icon:"ðŸ”¥"},{id:"coolDown",name:"Cool Down",description:"+10% all stats in last 10s of moment",rarity:"common",synergies:["precision"],hooks:["onTick"],modifiers:[],effectId:"coolDownBuff",icon:"â„ï¸"},{id:"reboundReady",name:"Rebound Ready",description:"+20% shot power on rebound attempts",rarity:"common",synergies:["rebound"],hooks:["onShot"],modifiers:[],effectId:"reboundShotPower",icon:"ðŸ”„"},{id:"pressTrigger",name:"Press Trigger",description:"+5% speed when enemy has ball",rarity:"common",synergies:["press"],hooks:["onTick"],modifiers:[],effectId:"pressSpeed",icon:"ðŸŽ¯",maxStacks:3},{id:"thickSkin",name:"Thick Skin",description:"-10% stun duration from tackles",rarity:"common",synergies:["tank"],hooks:["onDamage"],modifiers:[],effectId:"reducedStun10",icon:"ðŸ›¡ï¸",maxStacks:3},{id:"quickRecovery",name:"Quick Recovery",description:"-15% skill cooldowns",rarity:"common",synergies:["speedster"],hooks:["passive"],modifiers:[{stat:"cooldowns",value:-15,isPercent:!0}],effectId:"reducedCooldowns",icon:"â±ï¸",maxStacks:2},{id:"firstTouch",name:"First Touch",description:"+20% control when receiving passes",rarity:"common",synergies:["trianglePassing"],hooks:["onReceive"],modifiers:[],effectId:"receiveControl",icon:"âœ‹"},{id:"hardHitter",name:"Hard Hitter",description:"Shots cause brief slowdown on goalie",rarity:"common",synergies:["dragFlick"],hooks:["onShot"],modifiers:[],effectId:"goalieSlowdown",icon:"ðŸ’¥"},{id:"spaceFinder",name:"Space Finder",description:"+10% speed when no enemies nearby",rarity:"common",synergies:["speedster"],hooks:["onTick"],modifiers:[],effectId:"openSpaceSpeed",icon:"ðŸŒŒ"},{id:"teamPlayer",name:"Team Player",description:"+5% all stats per nearby teammate",rarity:"common",synergies:["trianglePassing"],hooks:["onTick"],modifiers:[],effectId:"teammateBuff",icon:"ðŸ¤",maxStacks:2},{id:"adrenaline",name:"Adrenaline",description:"+15% speed for 2s after dodge",rarity:"common",synergies:["trickster"],hooks:["onDodge"],modifiers:[],effectId:"dodgeSpeedBurst",icon:"âš¡"},{id:"persistence",name:"Persistence",description:"+2% tackle success per failed tackle (resets on success)",rarity:"common",synergies:["press"],hooks:["onTackle"],modifiers:[],effectId:"persistentTackle",icon:"ðŸ”"},{id:"magnetBall",name:"Magnet Ball",description:"Ball slightly curves toward you when nearby",rarity:"uncommon",synergies:["chaos","trickster"],hooks:["onTick"],modifiers:[],effectId:"ballMagnet",icon:"ðŸ§²"},{id:"trailBlazer",name:"Trail Blazer",description:"Leave speed-boost trail for teammates",rarity:"uncommon",synergies:["speedster","trianglePassing"],hooks:["onTick"],modifiers:[],effectId:"speedTrail",icon:"ðŸŒŸ"},{id:"triangleFormation",name:"Triangle Formation",description:"+25% pass power in triangles with teammates",rarity:"uncommon",synergies:["trianglePassing"],hooks:["onPass"],modifiers:[],effectId:"trianglePassBoost",icon:"ðŸ”º"},{id:"circleSpecialist",name:"Circle Specialist",description:"+30% shot power inside the D",rarity:"uncommon",synergies:["dragFlick","precision"],hooks:["onShot"],modifiers:[],effectId:"circleShotBoost",icon:"â­•"},{id:"autoHitInD",name:"Auto Hit in D",description:"Automatically shoot when in the D with ball",rarity:"rare",synergies:["dragFlick","precision","poacher"],hooks:["onTick"],modifiers:[],effectId:"autoHitInD",icon:"ðŸŽ¯"},{id:"pressureCooker",name:"Pressure Cooker",description:"+20% tackle range when pressing",rarity:"uncommon",synergies:["press"],hooks:["onTackle"],modifiers:[],effectId:"pressTackleRange",icon:"ðŸ³"},{id:"secondWind",name:"Second Wind",description:"Full stamina restore at half-time of moment",rarity:"uncommon",synergies:["speedster"],hooks:["onTick"],modifiers:[],effectId:"halfTimeStamina",icon:"ðŸŒ¬ï¸"},{id:"reboundHunter",name:"Rebound Hunter",description:"+50% speed toward loose balls after shots",rarity:"uncommon",synergies:["rebound"],hooks:["onShot"],modifiers:[],effectId:"reboundSpeed",icon:"ðŸŽ¯"},{id:"ironWill",name:"Iron Will",description:"Cannot be stunned for longer than 0.5s",rarity:"uncommon",synergies:["tank","berserker"],hooks:["onDamage"],modifiers:[],effectId:"stunCap",icon:"ðŸ”ï¸"},{id:"quickPass",name:"Quick Pass",description:"Passes travel 30% faster",rarity:"uncommon",synergies:["trianglePassing","speedster"],hooks:["onPass"],modifiers:[],effectId:"fastPass",icon:"ðŸ’¨"},{id:"curveShot",name:"Curve Shot",description:"Shots curve slightly toward goal",rarity:"uncommon",synergies:["trickster","precision"],hooks:["onShot"],modifiers:[],effectId:"curvingShot",icon:"ðŸŒ€"},{id:"vampireTackle",name:"Vampire Tackle",description:"Successful tackles restore stamina",rarity:"uncommon",synergies:["vampire","press"],hooks:["onSteal"],modifiers:[],effectId:"tackleStaminaRestore",icon:"ðŸ§›"},{id:"lastStand",name:"Last Stand",description:"+30% all stats when conceding",rarity:"uncommon",synergies:["guardian","berserker"],hooks:["onTick"],modifiers:[],effectId:"losingBuff",icon:"ðŸ›¡ï¸"},{id:"momentumShift",name:"Momentum Shift",description:"+5% speed per goal scored (stacks to 3)",rarity:"uncommon",synergies:["speedster"],hooks:["onGoal"],modifiers:[],effectId:"goalSpeedStack",icon:"ðŸ“ˆ"},{id:"slickMoves",name:"Slick Moves",description:"Dodge resets on successful steal",rarity:"uncommon",synergies:["trickster","press"],hooks:["onSteal"],modifiers:[],effectId:"stealDodgeReset",icon:"ðŸŽ­"},{id:"powerShot",name:"Power Shot",description:"Hold shoot for up to 50% more power",rarity:"uncommon",synergies:["dragFlick","precision"],hooks:["onShot"],modifiers:[],effectId:"chargeShot",icon:"ðŸ”‹"},{id:"counterPress",name:"Counter Press",description:"+40% tackle success within 2s of losing ball",rarity:"uncommon",synergies:["press"],hooks:["onTackle"],modifiers:[],effectId:"counterPressTackle",icon:"â†©ï¸"},{id:"composure",name:"Composure",description:"+20% shot accuracy when unmarked",rarity:"uncommon",synergies:["precision"],hooks:["onShot"],modifiers:[],effectId:"unmarkedShotBoost",icon:"ðŸ˜Œ"},{id:"leadingPass",name:"Leading Pass",description:"Passes predict teammate movement",rarity:"uncommon",synergies:["trianglePassing","precision"],hooks:["onPass"],modifiers:[],effectId:"predictivePass",icon:"ðŸŽ¯"},{id:"deflector",name:"Deflector",description:"+20% chance to deflect enemy shots when nearby",rarity:"uncommon",synergies:["guardian","rebound"],hooks:["onTick"],modifiers:[],effectId:"shotDeflection",icon:"ðŸªƒ"},{id:"burstSpeed",name:"Burst Speed",description:"+50% acceleration after receiving ball",rarity:"uncommon",synergies:["speedster","trianglePassing"],hooks:["onReceive"],modifiers:[],effectId:"receiveAccel",icon:"ðŸš€"},{id:"boomerangPass",name:"Boomerang Pass",description:"Missed passes return to you",rarity:"rare",synergies:["chaos","trianglePassing"],hooks:["onPass"],modifiers:[],effectId:"boomerangPass",icon:"ðŸªƒ"},{id:"iceTurf",name:"Ice Turf",description:"Enemies slip occasionally; you slide faster",rarity:"rare",synergies:["chaos","speedster"],hooks:["onTick"],modifiers:[],effectId:"iceTurfEffect",icon:"ðŸ§Š"},{id:"luckyDeflection",name:"Lucky Deflection",description:"15% chance blocked shots redirect to goal",rarity:"rare",synergies:["chaos","rebound"],hooks:["onShot"],modifiers:[],effectId:"luckyDeflect",icon:"ðŸ€"},{id:"dragFlickMaster",name:"Drag Flick Master",description:"Shots from stationary are 50% faster",rarity:"rare",synergies:["dragFlick"],hooks:["onShot"],modifiers:[],effectId:"stationaryShotBoost",icon:"ðŸ‘"},{id:"pressGang",name:"Press Gang",description:"Teammates copy your press direction",rarity:"rare",synergies:["press","trianglePassing"],hooks:["onTick"],modifiers:[],effectId:"coordPress",icon:"ðŸ‘¥"},{id:"doubleDeflection",name:"Double Deflection",description:"Rebounds deal +100% damage and move faster",rarity:"rare",synergies:["rebound"],hooks:["onShot"],modifiers:[],effectId:"superRebound",icon:"ðŸ’«"},{id:"phantomDodge",name:"Phantom Dodge",description:"Leave decoy on dodge that distracts enemies",rarity:"rare",synergies:["trickster"],hooks:["onDodge"],modifiers:[],effectId:"dodgeDecoy",icon:"ðŸ‘»"},{id:"vampireGoal",name:"Vampire Goal",description:"Goals restore full stamina and reduce cooldowns",rarity:"rare",synergies:["vampire"],hooks:["onGoal"],modifiers:[],effectId:"goalFullRestore",icon:"ðŸ©¸"},{id:"berserkerMode",name:"Berserker Mode",description:"+5% damage per hit taken (max 50%)",rarity:"rare",synergies:["berserker","tank"],hooks:["onDamage"],modifiers:[],effectId:"damageStacking",icon:"ðŸ˜¤"},{id:"precisionStrike",name:"Precision Strike",description:"Perfect timing shots ignore goalie",rarity:"rare",synergies:["precision","dragFlick"],hooks:["onShot"],modifiers:[],effectId:"perfectShot",icon:"ðŸŽ¯"},{id:"guardianAngel",name:"Guardian Angel",description:"Once per moment, auto-block a certain goal",rarity:"rare",synergies:["guardian"],hooks:["onTick"],modifiers:[],effectId:"autoBlock",icon:"ðŸ‘¼"},{id:"chainTackle",name:"Chain Tackle",description:"Successful tackles reset tackle cooldown",rarity:"rare",synergies:["press","berserker"],hooks:["onSteal"],modifiers:[],effectId:"tackleReset",icon:"â›“ï¸"},{id:"oneTouch",name:"One Touch",description:"Instant pass after receive is 30% faster",rarity:"rare",synergies:["trianglePassing","speedster"],hooks:["onReceive","onPass"],modifiers:[],effectId:"oneTouchPass",icon:"â˜ï¸"},{id:"aerialThreat",name:"Aerial Threat",description:"Can lob passes over defenders",rarity:"rare",synergies:["trianglePassing","trickster"],hooks:["onPass"],modifiers:[],effectId:"lobPass",icon:"ðŸŽˆ"},{id:"reverseHit",name:"Reverse Hit",description:"Can shoot backward with 80% power",rarity:"rare",synergies:["trickster","dragFlick"],hooks:["onShot"],modifiers:[],effectId:"backShot",icon:"â†ªï¸"},{id:"staminaVampire",name:"Stamina Vampire",description:"Drain enemy stamina on tackles",rarity:"rare",synergies:["vampire","press"],hooks:["onSteal"],modifiers:[],effectId:"stealStamina",icon:"ðŸ¦‡"},{id:"momentumCarry",name:"Momentum Carry",description:"Keep 50% of speed bonuses between moments",rarity:"rare",synergies:["speedster"],hooks:["onMomentEnd"],modifiers:[],effectId:"carrySpeed",icon:"ðŸ“¦"},{id:"shieldDodge",name:"Shield Dodge",description:"Dodge creates brief damage immunity shield",rarity:"rare",synergies:["tank","trickster"],hooks:["onDodge"],modifiers:[],effectId:"dodgeShield",icon:"ðŸ›¡ï¸"},{id:"reboundMaster",name:"Rebound Master",description:"+40% control on loose balls",rarity:"rare",synergies:["rebound"],hooks:["onReceive"],modifiers:[],effectId:"looseBallControl",icon:"ðŸŽ±"},{id:"pressurePoint",name:"Pressure Point",description:"Tackles slow enemy for 2s",rarity:"rare",synergies:["press","tank"],hooks:["onSteal"],modifiers:[],effectId:"tackleSlow",icon:"ðŸ“"},{id:"multiball",name:"Multiball",description:"Shots split into 2 balls (second is weaker)",rarity:"epic",synergies:["chaos","rebound"],hooks:["onShot"],modifiers:[],effectId:"splitShot",icon:"ðŸŽ±"},{id:"timeDilation",name:"Time Dilation",description:"Slow time briefly after perfect dodge",rarity:"epic",synergies:["trickster","precision"],hooks:["onDodge"],modifiers:[],effectId:"slowMo",icon:"â°"},{id:"triangleMastery",name:"Triangle Mastery",description:"Passes in triangle formation auto-complete",rarity:"epic",synergies:["trianglePassing"],hooks:["onPass"],modifiers:[],effectId:"autoTriangle",icon:"ðŸ“"},{id:"pressMachine",name:"Press Machine",description:"Teammates auto-press when you press",rarity:"epic",synergies:["press"],hooks:["onTick"],modifiers:[],effectId:"teamPress",icon:"ðŸ¤–"},{id:"unstoppable",name:"Unstoppable",description:"Cannot be tackled while shooting",rarity:"epic",synergies:["tank","dragFlick"],hooks:["onShot"],modifiers:[],effectId:"shootImmunity",icon:"ðŸ¦"},{id:"vampireLord",name:"Vampire Lord",description:"All attacks heal you",rarity:"epic",synergies:["vampire"],hooks:["onHit"],modifiers:[],effectId:"attackLifesteal",icon:"ðŸ§›â€â™‚ï¸"},{id:"chaosField",name:"Chaos Field",description:"Random effects trigger every 5s",rarity:"epic",synergies:["chaos"],hooks:["onTick"],modifiers:[],effectId:"randomEffects",icon:"ðŸŽ°"},{id:"perfectRebound",name:"Perfect Rebound",description:"Rebounds always go toward goal",rarity:"epic",synergies:["rebound","precision"],hooks:["onShot"],modifiers:[],effectId:"guidedRebound",icon:"ðŸŽ¯"},{id:"berserkerRage",name:"Berserker Rage",description:"+100% attack speed at low stamina",rarity:"epic",synergies:["berserker"],hooks:["onTick"],modifiers:[],effectId:"lowStaminaSpeed",icon:"ðŸ”¥"},{id:"guardianWall",name:"Guardian Wall",description:"Create barrier behind you that blocks shots",rarity:"epic",synergies:["guardian"],hooks:["onTick"],modifiers:[],effectId:"shotBarrier",icon:"ðŸ§±"},{id:"dragFlickKing",name:"Drag Flick King",description:"PC shots are unblockable",rarity:"epic",synergies:["dragFlick"],hooks:["onShot"],modifiers:[],effectId:"unblockablePC",icon:"ðŸ‘‘"},{id:"speedDemon",name:"Speed Demon",description:"+50% speed but -30% control",rarity:"epic",synergies:["speedster"],hooks:["passive"],modifiers:[{stat:"speed",value:50,isPercent:!0},{stat:"control",value:-30,isPercent:!0}],effectId:"speedControl",icon:"ðŸ‘¹"},{id:"tricksterKing",name:"Trickster King",description:"Triple dodge charges",rarity:"epic",synergies:["trickster"],hooks:["passive"],modifiers:[],effectId:"tripleDodge",icon:"ðŸƒ"},{id:"tankMode",name:"Tank Mode",description:"Immune to knockback, +50% stun resist",rarity:"epic",synergies:["tank"],hooks:["passive"],modifiers:[],effectId:"knockbackImmune",icon:"ðŸ›¡ï¸"},{id:"passNetwork",name:"Pass Network",description:"Passes chain automatically between teammates",rarity:"epic",synergies:["trianglePassing","precision"],hooks:["onPass"],modifiers:[],effectId:"chainPass",icon:"ðŸ”—"},{id:"avatarState",name:"Avatar State",description:"+100% all stats when behind by 2+ goals",rarity:"legendary",synergies:["berserker","tank"],hooks:["onTick"],modifiers:[],effectId:"avatarMode",icon:"ðŸŒŸ"},{id:"perfectGame",name:"Perfect Game",description:"First shot each moment is guaranteed goal",rarity:"legendary",synergies:["precision","dragFlick"],hooks:["onMomentStart","onShot"],modifiers:[],effectId:"guaranteedGoal",icon:"âœ¨"},{id:"timeLoop",name:"Time Loop",description:"Once per run: rewind 10s after conceding",rarity:"legendary",synergies:["chaos","guardian"],hooks:["onTick"],modifiers:[],effectId:"timeRewind",icon:"âª"},{id:"infiniteStamina",name:"Infinite Stamina",description:"Stamina never depletes",rarity:"legendary",synergies:["speedster","vampire"],hooks:["passive"],modifiers:[],effectId:"unlimitedStamina",icon:"â™¾ï¸"},{id:"goldenStick",name:"Golden Stick",description:"All stats +25%, gain extra upgrade choice",rarity:"legendary",synergies:[],hooks:["passive"],modifiers:[{stat:"speed",value:25,isPercent:!0},{stat:"stamina",value:25,isPercent:!0},{stat:"control",value:25,isPercent:!0},{stat:"shotPower",value:25,isPercent:!0},{stat:"passPower",value:25,isPercent:!0},{stat:"tackle",value:25,isPercent:!0},{stat:"dodge",value:25,isPercent:!0}],effectId:"goldenBoost",icon:"ðŸ†"},{id:"instantReaction",name:"Instant Reaction",description:"+50% speed for 1.5s after losing ball",rarity:"uncommon",synergies:["counterPress","speedster"],hooks:["onTick"],modifiers:[],effectId:"lostBallSpeedBurst",icon:"âš¡"},{id:"packHunter",name:"Pack Hunter",description:"+15% tackle success per nearby teammate",rarity:"uncommon",synergies:["counterPress","press"],hooks:["onTackle"],modifiers:[],effectId:"packTackleBoost",icon:"ðŸº"},{id:"turnoverArtist",name:"Turnover Artist",description:"Steals restore 30% stamina",rarity:"rare",synergies:["counterPress","vampire"],hooks:["onSteal"],modifiers:[],effectId:"stealStaminaRestore",icon:"ðŸŽ­"},{id:"gegenpressing",name:"Gegenpressing",description:"Team auto-presses for 3s after turnover",rarity:"epic",synergies:["counterPress","press"],hooks:["onSteal"],modifiers:[],effectId:"teamCounterPress",icon:"ðŸ”„"},{id:"calmControl",name:"Calm Control",description:"+20% control when stationary",rarity:"common",synergies:["possession"],hooks:["onTick"],modifiers:[],effectId:"stationaryControl",icon:"ðŸ§˜",maxStacks:2},{id:"patientPlay",name:"Patient Play",description:"+5% all stats per 5s of possession",rarity:"uncommon",synergies:["possession","trianglePassing"],hooks:["onTick"],modifiers:[],effectId:"possessionStacking",icon:"â³"},{id:"keepBall",name:"Keep Ball",description:"Passes have 20% chance to reset cooldowns",rarity:"uncommon",synergies:["possession","trianglePassing"],hooks:["onPass"],modifiers:[],effectId:"passCooldownReset",icon:"ðŸ”"},{id:"tikaTaka",name:"Tika-Taka",description:"Back-to-back passes increase speed by 10% each",rarity:"rare",synergies:["possession","speedster"],hooks:["onPass","onReceive"],modifiers:[],effectId:"passingMomentum",icon:"âš½"},{id:"metronome",name:"Metronome",description:"Perfect pass timing gives +50% pass power",rarity:"rare",synergies:["possession","precision"],hooks:["onPass"],modifiers:[],effectId:"timedPassBonus",icon:"ðŸŽµ"},{id:"possessionMaster",name:"Possession Master",description:"Cannot be tackled while ball is bobbing",rarity:"epic",synergies:["possession","tank"],hooks:["passive"],modifiers:[],effectId:"bobbleImmunity",icon:"ðŸ‘‘"},{id:"lastLine",name:"Last Line",description:"+30% tackle range when furthest back",rarity:"uncommon",synergies:["sweeper","guardian"],hooks:["onTackle"],modifiers:[],effectId:"lastManTackleRange",icon:"ðŸ§±"},{id:"clearancePower",name:"Clearance Power",description:"+50% pass power in own half",rarity:"common",synergies:["sweeper"],hooks:["onPass"],modifiers:[],effectId:"ownHalfPassPower",icon:"ðŸ¦µ",maxStacks:2},{id:"interceptor",name:"Interceptor",description:"25% chance to auto-intercept nearby passes",rarity:"rare",synergies:["sweeper","guardian"],hooks:["onTick"],modifiers:[],effectId:"autoIntercept",icon:"ðŸ–ï¸"},{id:"rushOut",name:"Rush Out",description:"+80% speed when ball in your D-circle",rarity:"rare",synergies:["sweeper","speedster"],hooks:["onTick"],modifiers:[],effectId:"dCircleRush",icon:"ðŸƒ"},{id:"sweeperKeeper",name:"Sweeper Keeper",description:"Auto-block one shot per moment when near goal",rarity:"epic",synergies:["sweeper","guardian"],hooks:["onTick"],modifiers:[],effectId:"autoBlockShot",icon:"ðŸ§¤"},{id:"rainDancer",name:"Rain Dancer",description:"No control penalty on wet turf",rarity:"uncommon",synergies:["weather","trickster"],hooks:["passive"],modifiers:[],effectId:"wetTurfImmune",icon:"ðŸŒ§ï¸"},{id:"iceSkater",name:"Ice Skater",description:"+20% speed on slippery surfaces",rarity:"uncommon",synergies:["weather","speedster"],hooks:["onTick"],modifiers:[],effectId:"slipSpeedBoost",icon:"â›¸ï¸"},{id:"mudRunner",name:"Mud Runner",description:"Enemies slip 30% more often near you",rarity:"rare",synergies:["weather","chaos"],hooks:["onTick"],modifiers:[],effectId:"enemySlipAura",icon:"ðŸ¦¶"},{id:"stormChaser",name:"Storm Chaser",description:"+15% all stats during weather modifiers",rarity:"rare",synergies:["weather"],hooks:["onMomentStart","onTick"],modifiers:[],effectId:"weatherStatsBoost",icon:"â›ˆï¸"},{id:"weatherMaster",name:"Weather Master",description:"Create slippery zone around you that affects enemies",rarity:"epic",synergies:["weather","chaos"],hooks:["onTick"],modifiers:[],effectId:"slipZoneAura",icon:"ðŸŒ€"},{id:"boxPresence",name:"Box Presence",description:"+20% shot power inside enemy D",rarity:"common",synergies:["poacher","dragFlick"],hooks:["onShot"],modifiers:[],effectId:"enemyDShotPower",icon:"ðŸ“¦",maxStacks:2},{id:"goalPoacher",name:"Goal Poacher",description:"+40% speed toward loose balls in enemy D",rarity:"uncommon",synergies:["poacher","rebound"],hooks:["onTick"],modifiers:[],effectId:"poacherSpeed",icon:"ðŸ¦…"},{id:"tapIn",name:"Tap In Specialist",description:"Shots at close range are 30% faster",rarity:"uncommon",synergies:["poacher","precision"],hooks:["onShot"],modifiers:[],effectId:"closeRangeShotBoost",icon:"ðŸ‘†"},{id:"secondBall",name:"Second Ball",description:"+60% chance to reach rebounds first",rarity:"rare",synergies:["poacher","rebound"],hooks:["onShot"],modifiers:[],effectId:"reboundPriority",icon:"2ï¸âƒ£"},{id:"finisher",name:"Clinical Finisher",description:"Goals from inside D restore all cooldowns",rarity:"rare",synergies:["poacher","precision"],hooks:["onGoal"],modifiers:[],effectId:"dGoalCooldownReset",icon:"ðŸŽ¯"},{id:"poachingInstinct",name:"Poaching Instinct",description:"Teleport to rebound position after teammate shots",rarity:"epic",synergies:["poacher","chaos"],hooks:["onTick"],modifiers:[],effectId:"reboundTeleport",icon:"âœ¨"},{id:"chipPass",name:"Chip Pass",description:"Passes can go over one defender",rarity:"uncommon",synergies:["aerial","trianglePassing"],hooks:["onPass"],modifiers:[],effectId:"chipPassDefender",icon:"ðŸŽˆ"},{id:"loftedShot",name:"Lofted Shot",description:"Hold shoot for aerial shot that dips at goal",rarity:"rare",synergies:["aerial","dragFlick"],hooks:["onShot"],modifiers:[],effectId:"dippingShot",icon:"ðŸŒˆ"},{id:"volleyMaster",name:"Volley Master",description:"+40% power on first-touch shots from aerials",rarity:"rare",synergies:["aerial","precision"],hooks:["onReceive","onShot"],modifiers:[],effectId:"volleyPowerBoost",icon:"ðŸ¦¶"},{id:"aerialDominance",name:"Aerial Dominance",description:"Always win aerial balls",rarity:"epic",synergies:["aerial","tank"],hooks:["passive"],modifiers:[],effectId:"winAerials",icon:"ðŸ†"},{id:"pcSpecialist",name:"PC Specialist",description:"+30% shot power from penalty corners",rarity:"uncommon",synergies:["dragFlick"],hooks:["onShot"],modifiers:[],effectId:"pcShotPower",icon:"ðŸŽ¯"},{id:"lowFlick",name:"Low Flick",description:"Shots from stationary go under blockers",rarity:"rare",synergies:["dragFlick","precision"],hooks:["onShot"],modifiers:[],effectId:"lowShotPenetration",icon:"â¬‡ï¸"},{id:"windUp",name:"Wind Up",description:"Standing still charges shot power (max +50%)",rarity:"rare",synergies:["dragFlick","precision"],hooks:["onTick","onShot"],modifiers:[],effectId:"stationaryCharge",icon:"ðŸŒ€"},{id:"topCorner",name:"Top Corner",description:"20% of shots become unsaveable",rarity:"epic",synergies:["dragFlick","precision"],hooks:["onShot"],modifiers:[],effectId:"unsaveableShot",icon:"ðŸ“"},{id:"highLine",name:"High Line",description:"Team pushes higher, +10% team speed",rarity:"uncommon",synergies:["press"],hooks:["onTick"],modifiers:[],effectId:"highLineSpeed",icon:"â¬†ï¸"},{id:"trapSetter",name:"Trap Setter",description:"Enemies near sideline lose 15% speed",rarity:"rare",synergies:["press","guardian"],hooks:["onTick"],modifiers:[],effectId:"sidelineTrap",icon:"ðŸ•¸ï¸"},{id:"relentless",name:"Relentless",description:"No stamina cost when pressing",rarity:"rare",synergies:["press","speedster"],hooks:["onTick"],modifiers:[],effectId:"freePressing",icon:"â™¾ï¸"},{id:"suffocate",name:"Suffocate",description:"Enemies with ball lose 5% control per second",rarity:"epic",synergies:["press"],hooks:["onTick"],modifiers:[],effectId:"pressureControlDrain",icon:"ðŸ˜¤"},{id:"fakeShot",name:"Fake Shot",description:"Dodge creates fake shot animation",rarity:"uncommon",synergies:["trickster"],hooks:["onDodge"],modifiers:[],effectId:"dodgeFakeShot",icon:"ðŸŽ­"},{id:"nutmeg",name:"Nutmeg Master",description:"15% chance to phase through tackles",rarity:"rare",synergies:["trickster","tank"],hooks:["passive"],modifiers:[],effectId:"tacklePhase",icon:"ðŸ¥œ"},{id:"stepOver",name:"Step Over",description:"Dodge confuses nearby enemies for 1s",rarity:"rare",synergies:["trickster"],hooks:["onDodge"],modifiers:[],effectId:"dodgeConfuse",icon:"ðŸ’«"},{id:"elastico",name:"Elastico",description:"Double-tap dodge for quick direction change",rarity:"epic",synergies:["trickster","speedster"],hooks:["onDodge"],modifiers:[],effectId:"doubleDodge",icon:"ðŸ”€"},{id:"deflectionKing",name:"Deflection King",description:"Blocked shots gain +30% power",rarity:"uncommon",synergies:["rebound"],hooks:["onShot"],modifiers:[],effectId:"blockedShotPowerGain",icon:"ðŸ‘‘"},{id:"anticipation",name:"Anticipation",description:"See shot trajectory before it happens",rarity:"rare",synergies:["rebound","guardian"],hooks:["onTick"],modifiers:[],effectId:"shotPrediction",icon:"ðŸ‘ï¸"},{id:"ricochets",name:"Ricochets",description:"Shots bounce off players toward goal",rarity:"epic",synergies:["rebound","chaos"],hooks:["onShot"],modifiers:[],effectId:"playerBounceToGoal",icon:"ðŸ”„"},{id:"goalkeeper",name:"Goalkeeper",description:"+40% tackle success in own D",rarity:"uncommon",synergies:["guardian","sweeper"],hooks:["onTackle"],modifiers:[],effectId:"ownDTackleBoost",icon:"ðŸ§¤"},{id:"shotBlocker",name:"Shot Blocker",description:"+30% body size when blocking shots",rarity:"rare",synergies:["guardian","tank"],hooks:["onTick"],modifiers:[],effectId:"enlargeForBlock",icon:"ðŸš§"},{id:"clearanceBot",name:"Clearance Bot",description:"Auto-clear balls in your D toward enemy half",rarity:"rare",synergies:["guardian","sweeper"],hooks:["onReceive"],modifiers:[],effectId:"autoClearance",icon:"ðŸ¤–"},{id:"afterburner",name:"Afterburner",description:"+30% speed after 2s of sprinting",rarity:"uncommon",synergies:["speedster"],hooks:["onTick"],modifiers:[],effectId:"sprintRampUp",icon:"ðŸ”¥"},{id:"quickBreak",name:"Quick Break",description:"+50% speed for 3s after steals",rarity:"rare",synergies:["speedster","counterPress"],hooks:["onSteal"],modifiers:[],effectId:"stealSpeedBurst",icon:"ðŸ’¨"},{id:"breakaway",name:"Breakaway",description:"+25% speed when no enemies ahead",rarity:"rare",synergies:["speedster","poacher"],hooks:["onTick"],modifiers:[],effectId:"openFieldSpeed",icon:"ðŸƒâ€â™‚ï¸"},{id:"speedDemonMk2",name:"Speed Demon Mk2",description:"Max speed increases by 5% per moment",rarity:"epic",synergies:["speedster"],hooks:["onMomentEnd"],modifiers:[],effectId:"stackingSpeed",icon:"ðŸš€"},{id:"immovable",name:"Immovable",description:"-50% knockback from all sources",rarity:"uncommon",synergies:["tank"],hooks:["onDamage"],modifiers:[],effectId:"reducedKnockback",icon:"ðŸ—¿"},{id:"brickWall",name:"Brick Wall",description:"Enemies bounce off you when you have ball",rarity:"rare",synergies:["tank","possession"],hooks:["onDamage"],modifiers:[],effectId:"tacklerBounce",icon:"ðŸ§±"},{id:"bullRush",name:"Bull Rush",description:"Sprint through tackles with 30% chance",rarity:"rare",synergies:["tank","speedster"],hooks:["passive"],modifiers:[],effectId:"sprintThroughTackle",icon:"ðŸ‚"},{id:"juggernaut",name:"Juggernaut",description:"Immune to stuns while moving",rarity:"epic",synergies:["tank","berserker"],hooks:["passive"],modifiers:[],effectId:"movingStunImmune",icon:"ðŸ¦"},{id:"lifeSteal",name:"Life Steal",description:"Tackles restore 10% stamina",rarity:"common",synergies:["vampire","press"],hooks:["onTackle"],modifiers:[],effectId:"tackleStaminaGain",icon:"ðŸ©¸",maxStacks:2},{id:"drainTouch",name:"Drain Touch",description:"Contact with enemies drains their stamina",rarity:"rare",synergies:["vampire","tank"],hooks:["onTick"],modifiers:[],effectId:"contactStaminaDrain",icon:"âœ‹"},{id:"soulSiphon",name:"Soul Siphon",description:"Goals heal 50% of missing stamina",rarity:"rare",synergies:["vampire"],hooks:["onGoal"],modifiers:[],effectId:"goalStaminaHeal",icon:"ðŸ‘»"},{id:"bloodlust",name:"Bloodlust",description:"Each steal increases speed by 10% (stacks 5x)",rarity:"epic",synergies:["vampire","berserker"],hooks:["onSteal"],modifiers:[],effectId:"stealSpeedStacking",icon:"ðŸ©¸"},{id:"rageBuildup",name:"Rage Buildup",description:"+3% power per tackle taken (max 30%)",rarity:"uncommon",synergies:["berserker"],hooks:["onDamage"],modifiers:[],effectId:"damagePowerStack",icon:"ðŸ˜ "},{id:"frenzy",name:"Frenzy",description:"+20% attack speed when below 30% stamina",rarity:"rare",synergies:["berserker","speedster"],hooks:["onTick"],modifiers:[],effectId:"lowStaminaAttackSpeed",icon:"ðŸ”´"},{id:"desperateShot",name:"Desperate Shot",description:"+50% shot power when losing",rarity:"rare",synergies:["berserker","dragFlick"],hooks:["onShot"],modifiers:[],effectId:"losingShotPower",icon:"ðŸ˜¤"},{id:"unhinged",name:"Unhinged",description:"Random stat boosts every 5s",rarity:"epic",synergies:["berserker","chaos"],hooks:["onTick"],modifiers:[],effectId:"randomStatBoosts",icon:"ðŸƒ"},{id:"ballMagnetPlus",name:"Ball Magnet+",description:"Stronger ball attraction effect",rarity:"rare",synergies:["chaos","trickster"],hooks:["onTick"],modifiers:[],effectId:"strongBallMagnet",icon:"ðŸ§²"},{id:"teleportBall",name:"Teleport Ball",description:"10% chance passes teleport to target",rarity:"rare",synergies:["chaos","trianglePassing"],hooks:["onPass"],modifiers:[],effectId:"instantPass",icon:"âœ¨"},{id:"mirrorImage",name:"Mirror Image",description:"Create decoy that confuses AI",rarity:"epic",synergies:["chaos","trickster"],hooks:["onDodge"],modifiers:[],effectId:"createDecoy",icon:"ðŸ‘¥"},{id:"perfectPass",name:"Perfect Pass",description:"Passes that hit targets exactly give +10% speed",rarity:"uncommon",synergies:["precision","trianglePassing"],hooks:["onPass"],modifiers:[],effectId:"accuratePassBonus",icon:"ðŸŽ¯"},{id:"sniper",name:"Sniper",description:"+25% shot accuracy from distance",rarity:"rare",synergies:["precision","dragFlick"],hooks:["onShot"],modifiers:[],effectId:"longRangeShotAccuracy",icon:"ðŸ”­"},{id:"clutchPlayer",name:"Clutch Player",description:"+30% all stats in final 15s",rarity:"rare",synergies:["precision"],hooks:["onTick"],modifiers:[],effectId:"finalSecondsBoost",icon:"â°"},{id:"sureShot",name:"Sure Shot",description:"First shot after receiving is guaranteed on target",rarity:"epic",synergies:["precision","poacher"],hooks:["onReceive","onShot"],modifiers:[],effectId:"firstTouchOnTarget",icon:"ðŸ’¯"},{id:"slap_shot_boost",name:"Slap Shot Boost",description:"+18% shot speed - feel the power!",rarity:"uncommon",synergies:["dragFlick","precision"],hooks:["passive"],modifiers:[{stat:"shotPower",value:18,isPercent:!0}],effectId:"slapShotBoost",icon:"ðŸ’",maxStacks:2},{id:"quick_release",name:"Quick Release",description:"Shooting reduces next shoot cooldown by 25% for 2s",rarity:"rare",synergies:["dragFlick","speedster"],hooks:["onShot"],modifiers:[],effectId:"quickReleaseBuff",icon:"âš¡"},{id:"curve_drive",name:"Curve Drive",description:"Shots curve toward goal + visible spin effect",rarity:"uncommon",synergies:["trickster","precision"],hooks:["onShot"],modifiers:[],effectId:"curveDriveShot",icon:"ðŸŒ€"},{id:"one_touch_finish",name:"One Touch Finish",description:"Receive ball inside D â†’ next shot within 1.2s gets +20% speed",rarity:"rare",synergies:["poacher","precision"],hooks:["onReceive","onShot"],modifiers:[],effectId:"oneTouchFinishBuff",icon:"â˜ï¸"},{id:"d_poacher",name:"D Poacher",description:"+10% speed when in attacking D with ball",rarity:"uncommon",synergies:["poacher","speedster"],hooks:["onTick"],modifiers:[],effectId:"dPoacherSpeed",icon:"ðŸŽ¯"},{id:"laser_passes",name:"Laser Passes",description:"+20% pass speed - crisp and accurate",rarity:"uncommon",synergies:["trianglePassing","speedster"],hooks:["passive"],modifiers:[{stat:"passPower",value:20,isPercent:!0}],effectId:"laserPasses",icon:"ðŸ’«",maxStacks:2},{id:"give_go_master",name:"Give & Go Master",description:"Give-and-go window extended + stronger speed buff",rarity:"rare",synergies:["trianglePassing","speedster"],hooks:["onPass","onReceive"],modifiers:[],effectId:"giveGoMasterBuff",icon:"ðŸ”„"},{id:"magnetic_first_touch",name:"Magnetic First Touch",description:"+30% control for 2s after receiving + ball magnetism",rarity:"uncommon",synergies:["possession","trickster"],hooks:["onReceive"],modifiers:[],effectId:"magneticFirstTouch",icon:"ðŸ§²"},{id:"interception_gloves",name:"Interception Gloves",description:"+15% intercept/pickup radius",rarity:"uncommon",synergies:["guardian","sweeper"],hooks:["passive"],modifiers:[{stat:"interceptRadius",value:15,isPercent:!0}],effectId:"interceptionGloves",icon:"ðŸ§¤"},{id:"crunch_tackle",name:"Crunch Tackle",description:"+25% tackle knockback - send them flying!",rarity:"uncommon",synergies:["press","berserker"],hooks:["passive"],modifiers:[{stat:"tackleKnockback",value:25,isPercent:!0}],effectId:"crunchTackle",icon:"ðŸ’ª",maxStacks:2},{id:"stun_stick",name:"Stun Stick",description:"Successful tackles add +120ms stun duration",rarity:"rare",synergies:["press","tank"],hooks:["onSteal"],modifiers:[],effectId:"stunStickExtra",icon:"âš¡"},{id:"second_wind_moment",name:"Second Wind",description:"Restore full stamina at moment start (once per moment)",rarity:"uncommon",synergies:["speedster"],hooks:["onMomentStart"],modifiers:[],effectId:"secondWindMoment",icon:"ðŸŒ¬ï¸"},{id:"efficient_dash",name:"Efficient Dash",description:"Dash stamina cost reduced by 30%",rarity:"uncommon",synergies:["speedster","trickster"],hooks:["passive"],modifiers:[{stat:"dashCost",value:-30,isPercent:!0}],effectId:"efficientDash",icon:"ðŸ’¨",maxStacks:2},{id:"adrenaline_advantage",name:"Adrenaline Advantage",description:"Steal triggers 3s SUPER advantage (+20% speed/pass/shot)",rarity:"rare",synergies:["counterPress","speedster"],hooks:["onSteal"],modifiers:[],effectId:"adrenalineAdvantageBuff",icon:"ðŸ”¥"},{id:"pc_drag_flick",name:"PC Drag Flick",description:"Penalty corner shots have +35% power",rarity:"rare",synergies:["dragFlick"],hooks:["onShot"],modifiers:[],effectId:"pcDragFlickPower",icon:"ðŸ‘"},{id:"pc_injector",name:"PC Injector",description:"PC injection pass +25% speed, stopper control +15%",rarity:"uncommon",synergies:["dragFlick","trianglePassing"],hooks:["onPass","onReceive"],modifiers:[{stat:"pcPassSpeed",value:25,isPercent:!0},{stat:"pcControl",value:15,isPercent:!0}],effectId:"pcInjectorBuff",icon:"ðŸ’‰"},{id:"keeper_nerves",name:"Keeper Nerves",description:"Shots from inside D get +8% speed burst (beats GK reaction)",rarity:"rare",synergies:["poacher","precision"],hooks:["onShot"],modifiers:[],effectId:"keeperNervesBurst",icon:"ðŸ˜°"},{id:"rebound_hunter_pro",name:"Rebound Hunter Pro",description:"On ball deflection/rebound: +50% speed for 1.5s",rarity:"rare",synergies:["rebound","speedster"],hooks:["onTick"],modifiers:[],effectId:"reboundHunterProBurst",icon:"ðŸ¦…"},{id:"iron_body",name:"Iron Body",description:"Take 25% less damage from tackles",rarity:"uncommon",synergies:["tank"],hooks:["passive"],modifiers:[{stat:"tackleDamageReduction",value:25,isPercent:!0}],effectId:"ironBody",icon:"ðŸ›¡ï¸",maxStacks:2},{id:"fragile_genius",name:"Fragile Genius",description:"+25% shot speed BUT +20% tackle damage taken",rarity:"rare",synergies:["dragFlick","berserker"],hooks:["passive"],modifiers:[{stat:"shotPower",value:25,isPercent:!0},{stat:"tackleDamageTaken",value:20,isPercent:!0}],effectId:"fragileGenius",icon:"ðŸ§ "}];function Ps(k){return tt.find(a=>a.id===k)}function Ds(k,a,e){const t={...vs};a>=3&&(t.rare+=5,t.epic+=2),a>=6&&(t.rare+=10,t.epic+=5,t.legendary+=1),a>=9&&(t.epic+=5,t.legendary+=2);const i=tt.filter(r=>{const c=e.filter(d=>d===r.id).length,h=r.maxStacks||1;return c<h});if(i.length===0)return[];const s=Object.values(t).reduce((r,c)=>r+c,0),o=[],n=new Set;for(;o.length<k&&n.size<i.length;){const r=Math.random()*s;let c=0,h="common";for(const[m,f]of Object.entries(t))if(c+=f,r<=c){h=m;break}const d=i.filter(m=>m.rarity===h&&!n.has(m.id));if(d.length>0){const m=d[Math.floor(Math.random()*d.length)];o.push(m),n.add(m.id)}else{const m=i.filter(f=>!n.has(f.id));if(m.length>0){const f=m[Math.floor(Math.random()*m.length)];o.push(f),n.add(f.id)}}}return o}class As extends p.Events.EventEmitter{constructor(e){super();l(this,"scene");l(this,"ownedUpgrades",[]);l(this,"hooks",new Map);l(this,"statModifiers",new Map);l(this,"activeBuffs",[]);l(this,"synergyCounts",new Map);l(this,"activeSynergyTiers",new Map);l(this,"procCounts",new Map);l(this,"recentProcs",[]);l(this,"MAX_RECENT_PROCS",10);l(this,"eventStats",{tick:0,shot:0,pass:0,tackle:0,steal:0,receive:0,goal:0,dodge:0,momentStart:0,momentEnd:0});l(this,"lastEventStatsReset",0);l(this,"eventStatsPerSecond",{tick:0,shot:0,pass:0,tackle:0,steal:0,receive:0,goal:0,dodge:0,momentStart:0,momentEnd:0});l(this,"upgradeCooldowns",new Map);l(this,"stacks",new Map);l(this,"oneTimeUsed",new Set);l(this,"lastPassTime",0);l(this,"lastPassTarget",null);l(this,"activePlay",null);l(this,"playExpiresAt",0);l(this,"playCooldownUntil",0);this.scene=e,this.initializeHooks(),console.log("[UPGRADE_SYSTEM] Initialized")}initializeHooks(){["tick","shot","pass","tackle","steal","receive","goal","dodge","momentStart","momentEnd"].forEach(t=>this.hooks.set(t,[]))}pickUpgrade(e){const t=Ps(e);return t?(console.log(`[UPGRADE_PICK] Picking: ${t.id} - ${t.name}`),this.ownedUpgrades.push(t),t.modifiers.forEach(i=>{const s=this.statModifiers.get(i.stat)||0;this.statModifiers.set(i.stat,s+i.value),console.log(`[UPGRADE_PICK] Modifier: ${i.stat} += ${i.value}%`)}),this.registerUpgradeHooks(t),t.synergies.forEach(i=>{const s=(this.synergyCounts.get(i)||0)+1;this.synergyCounts.set(i,s),this.checkSynergyActivation(i,s)}),this.emit("upgradeAdded",t),console.log(`[UPGRADE_PICK] Total upgrades: ${this.ownedUpgrades.length}`),!0):(console.error(`[UPGRADE_SYSTEM] Upgrade not found: ${e}`),!1)}addUpgrade(e){this.pickUpgrade(e.id)}registerUpgradeHooks(e){const t={onShot:"shot",onPass:"pass",onTackle:"tackle",onSteal:"steal",onReceive:"receive",onGoal:"goal",onDodge:"dodge",onTick:"tick",onMomentStart:"momentStart",onMomentEnd:"momentEnd",passive:"tick"};e.hooks.forEach(i=>{const s=t[i];if(!s)return;const o=this.createCallback(e),n=this.hooks.get(s);n&&(n.push({upgradeId:e.id,upgradeName:e.name,callback:o}),console.log(`[UPGRADE_PICK] Registered hook: ${e.id} -> ${s}`))})}emitEvent(e,t){e in this.eventStats&&this.eventStats[e]++;const i=t.time||this.scene.time.now;i-this.lastEventStatsReset>=1e3&&(this.eventStatsPerSecond={...this.eventStats},this.eventStats={tick:0,shot:0,pass:0,tackle:0,steal:0,receive:0,goal:0,dodge:0,momentStart:0,momentEnd:0},this.lastEventStatsReset=i);const s=this.hooks.get(e);!s||s.length===0||(s.forEach(o=>{try{o.callback(t)}catch(n){console.error(`[UPGRADE_SYSTEM] Error in ${o.upgradeId}:`,n)}}),e==="pass"?this.trackPassForGiveAndGo(t):e==="receive"&&this.checkGiveAndGo(t))}trigger(e,t){const s={onShot:"shot",onPass:"pass",onTackle:"tackle",onSteal:"steal",onReceive:"receive",onGoal:"goal",onDodge:"dodge",onTick:"tick",onMomentStart:"momentStart",onMomentEnd:"momentEnd"}[e]||e;this.emitEvent(s,t)}createCallback(e){const t=e.effectId,i=e.id;switch(t){case"speedBoost10":case"shotPowerBoost15":case"controlBoost15":case"tackleBoost15":case"passBoost15":case"staminaBoost20":case"dodgeBoost10":case"reducedCooldowns":case"goldenBoost":return()=>{};case"autoHitInD":return s=>{if(!s.playerHasBall||!s.playerInAttackingD||!s.playerCanShoot)return;const o="autoHitInD_cooldown",n=this.upgradeCooldowns.get(o)||0,r=s.time||this.scene.time.now;r-n<700||(this.upgradeCooldowns.set(o,r),console.log("[AUTO_HIT_IN_D] Triggering auto-shot!"),this.emit("autoShot",{source:"autoHitInD"}),this.procUpgrade(i,"Auto Hit in D",1))};case"circleShotBoost":return s=>{s.playerInAttackingD&&(this.addTempBuff("circleShotBoost","shotPower",30,500,"upgrade"),this.procUpgrade(i,e.name,.8))};case"homeHalfSpeed":return s=>{s.player&&s.player.x<600&&this.addTempBuff("homeHalfSpeed","speed",8,200,"upgrade")};case"openSpaceSpeed":return s=>{this.isInOpenSpace(s)&&(this.addTempBuff("openSpaceSpeed","speed",10,200,"upgrade"),this.procUpgrade(i,e.name,.3))};case"pressSpeed":return s=>{s.player&&!s.playerHasBall&&this.addTempBuff("pressSpeed","speed",5,200,"upgrade")};case"dodgeSpeedBurst":return s=>{this.addTempBuff("dodgeSpeedBurst","speed",15,2e3,"upgrade"),this.procUpgrade(i,e.name,1)};case"ballMagnet":case"strongBallMagnet":return s=>{var c,h;if(!s.ball||s.playerHasBall)return;const o=p.Math.Distance.Between(s.player.x,s.player.y,s.ball.x,s.ball.y),n=t==="strongBallMagnet"?150:100,r=t==="strongBallMagnet"?.05:.02;o<n&&o>20&&s.ball.isLoose&&((h=(c=s.ball).applyMagnet)==null||h.call(c,s.player.x,s.player.y,r),this.procUpgrade(i,e.name,.1))};case"reboundShotPower":return s=>{this.addTempBuff("reboundShotPower","shotPower",20,500,"upgrade"),this.procUpgrade(i,e.name,.8)};case"stationaryShotBoost":return s=>{s.playerIsStationary&&(this.addTempBuff("stationaryShotBoost","shotPower",50,500,"upgrade"),this.procUpgrade(i,e.name,1))};case"enemyDShotPower":return s=>{s.playerInAttackingD&&(this.addTempBuff("enemyDShotPower","shotPower",20,500,"upgrade"),this.procUpgrade(i,e.name,.8))};case"closeRangeShotBoost":return s=>{const o=s.player.x>600?1200:0;Math.abs(s.player.x-o)<200&&(this.addTempBuff("closeRangeShotBoost","shotSpeed",30,500,"upgrade"),this.procUpgrade(i,e.name,1))};case"curvingShot":return s=>{var o,n;(n=(o=s.ball)==null?void 0:o.addCurve)==null||n.call(o,.3),this.procUpgrade(i,e.name,.8)};case"fastPass":return s=>{this.addTempBuff("fastPass","passSpeed",30,500,"upgrade"),this.procUpgrade(i,e.name,.6)};case"trianglePassBoost":return s=>{this.addTempBuff("trianglePassBoost","passPower",25,500,"upgrade"),this.procUpgrade(i,e.name,.8)};case"tackleStaminaRestore":return s=>{var o,n;(n=(o=s.player)==null?void 0:o.restoreStamina)==null||n.call(o,20),this.procUpgrade(i,e.name,1)};case"tackleReset":return s=>{this.emit("cooldownReset","tackle"),this.procUpgrade(i,e.name,1)};case"stealDodgeReset":return s=>{this.emit("cooldownReset","dodge"),this.procUpgrade(i,e.name,1)};case"tackleSpeed":return s=>{this.addTempBuff("tackleSpeed","speed",20,2e3,"upgrade"),this.procUpgrade(i,e.name,1)};case"receiveControl":return s=>{this.addTempBuff("receiveControl","control",20,1e3,"upgrade"),this.procUpgrade(i,e.name,.8)};case"receiveAccel":return s=>{this.addTempBuff("receiveAccel","speed",50,1e3,"upgrade"),this.procUpgrade(i,e.name,1)};case"goalSpeedStack":return s=>{const o=Math.min((this.stacks.get("goalSpeed")||0)+1,3);this.stacks.set("goalSpeed",o),this.addTempBuff("goalSpeedStack","speed",5*o,6e4,"upgrade"),this.procUpgrade(i,e.name,1)};case"goalFullRestore":return s=>{var o,n;(n=(o=s.player)==null?void 0:o.restoreStamina)==null||n.call(o,100),this.emit("allCooldownsReset"),this.procUpgrade(i,e.name,1)};case"slowMo":return s=>{this.scene.time.timeScale=.5,this.scene.time.delayedCall(500,()=>{this.scene.time.timeScale=1}),this.procUpgrade(i,e.name,1)};case"dodgeShield":return s=>{var o,n;(n=(o=s.player)==null?void 0:o.addShield)==null||n.call(o,500),this.procUpgrade(i,e.name,1)};case"warmUpBuff":return s=>{s.momentTimeRemaining&&s.momentTimeRemaining>50&&this.addTempBuff("warmUpBuff","all",10,200,"upgrade")};case"coolDownBuff":return s=>{s.momentTimeRemaining&&s.momentTimeRemaining<10&&this.addTempBuff("coolDownBuff","all",10,200,"upgrade")};case"finalSecondsBoost":return s=>{s.momentTimeRemaining&&s.momentTimeRemaining<15&&this.addTempBuff("finalSecondsBoost","all",30,200,"upgrade")};case"losingBuff":return s=>{s.isLosing&&this.addTempBuff("losingBuff","all",30,200,"upgrade")};case"avatarMode":return s=>{s.isLosing&&(this.addTempBuff("avatarMode","all",100,200,"upgrade"),this.procUpgrade(i,e.name,.5))};case"dCircleRush":return s=>{s.playerInDefendingD&&this.addTempBuff("dCircleRush","speed",80,200,"upgrade")};case"poacherSpeed":return s=>{s.ball&&s.ball.isLoose&&s.playerInAttackingD&&this.addTempBuff("poacherSpeed","speed",40,200,"upgrade")};case"autoBlock":return s=>{this.oneTimeUsed.has("autoBlock")};case"autoBlockShot":return s=>{};case"teammateBuff":return s=>{const o=this.countNearbyTeammates(s);o>0&&this.addTempBuff("teammateBuff","all",5*o,200,"upgrade")};case"teamPress":return s=>{s.playerHasBall||this.emit("teammatesPress")};case"slapShotBoost":return()=>{};case"quickReleaseBuff":return s=>{this.addTempBuff("quickRelease","shootCooldown",-25,2e3,"upgrade"),this.procUpgrade(i,e.name,1)};case"curveDriveShot":return s=>{var o,n;(n=(o=s.ball)==null?void 0:o.setSpin)==null||n.call(o,.15),this.procUpgrade(i,e.name,.9)};case"oneTouchFinishBuff":return s=>{s.playerInAttackingD&&(this.addTempBuff("oneTouchFinish","shotPower",20,1200,"upgrade"),this.procUpgrade(i,e.name,1))};case"dPoacherSpeed":return s=>{s.playerHasBall&&s.playerInAttackingD&&(this.addTempBuff("dPoacherSpeed","speed",10,200,"upgrade"),this.procUpgrade(i,e.name,.2))};case"laserPasses":return()=>{};case"giveGoMasterBuff":return s=>{this.addTempBuff("giveGoWindow","giveGoWindow",50,3e3,"upgrade"),this.procUpgrade(i,e.name,.6)};case"magneticFirstTouch":return s=>{this.addTempBuff("magneticFirstTouch","control",30,2e3,"upgrade"),this.procUpgrade(i,e.name,1)};case"interceptionGloves":return()=>{};case"crunchTackle":return()=>{};case"stunStickExtra":return s=>{var o,n;(n=(o=s.target)==null?void 0:o.applyStun)==null||n.call(o,120),this.procUpgrade(i,e.name,1)};case"secondWindMoment":return s=>{var o,n;(n=(o=s.player)==null?void 0:o.restoreStamina)==null||n.call(o,100),this.procUpgrade(i,e.name,1)};case"efficientDash":return()=>{};case"adrenalineAdvantageBuff":return s=>{this.addTempBuff("adrenalineSpeed","speed",20,3e3,"upgrade"),this.addTempBuff("adrenalinePass","passPower",20,3e3,"upgrade"),this.addTempBuff("adrenalineShot","shotPower",20,3e3,"upgrade"),this.procUpgrade(i,e.name,1)};case"pcDragFlickPower":return s=>{this.addTempBuff("pcDragFlick","shotPower",35,500,"upgrade"),this.procUpgrade(i,e.name,1)};case"pcInjectorBuff":return()=>{};case"keeperNervesBurst":return s=>{s.playerInAttackingD&&(this.addTempBuff("keeperNerves","shotSpeed",8,300,"upgrade"),this.procUpgrade(i,e.name,1))};case"reboundHunterProBurst":return s=>{var o;(o=s.ball)!=null&&o.isRebound&&(this.addTempBuff("reboundHunterPro","speed",50,1500,"upgrade"),this.procUpgrade(i,e.name,1))};case"ironBody":return()=>{};case"fragileGenius":return()=>{};default:return()=>{}}}procUpgrade(e,t,i=1){const s=(this.procCounts.get(e)||0)+1;this.procCounts.set(e,s),this.recentProcs.push({upgradeId:e,upgradeName:t,time:this.scene.time.now}),this.recentProcs.length>this.MAX_RECENT_PROCS&&this.recentProcs.shift(),this.emit("upgradeProc",{upgradeId:e,upgradeName:t,intensity:i,count:s}),console.log(`[PROC] ${t} (${e}) x${s}`)}addTempBuff(e,t,i,s,o){const n=this.activeBuffs.find(r=>r.id===e);if(n){n.expiresAt=this.scene.time.now+s,n.value=Math.max(n.value,i);return}this.activeBuffs.push({id:e,name:e,icon:"â¬†ï¸",stat:t,value:i,expiresAt:this.scene.time.now+s,source:o})}getActiveBuffs(){const e=this.scene.time.now;return this.activeBuffs=this.activeBuffs.filter(t=>t.expiresAt>e),this.activeBuffs}getModifiedStat(e,t){let i=this.statModifiers.get(t)||0;i+=this.statModifiers.get("all")||0;const s=this.scene.time.now;for(const o of this.activeBuffs)o.expiresAt>s&&(o.stat===t||o.stat==="all")&&(i+=o.value);return e*(1+i/100)}getAllModifiers(){const e={};return this.statModifiers.forEach((t,i)=>{e[i]=t}),e}getFinalStats(e){return{speed:this.getModifiedStat(e.speed,"speed"),stamina:this.getModifiedStat(e.stamina,"stamina"),control:this.getModifiedStat(e.control,"control"),shotPower:this.getModifiedStat(e.shotPower,"shotPower"),passPower:this.getModifiedStat(e.passPower,"passPower"),tackle:this.getModifiedStat(e.tackle,"tackle"),dodge:this.getModifiedStat(e.dodge,"dodge")}}checkSynergyActivation(e,t){const i=this.activeSynergyTiers.get(e)||0;let s=0;t>=5?s=2:t>=3&&(s=1),s>i&&(this.activeSynergyTiers.set(e,s),this.applySynergyBonus(e,s),this.emit("synergyActivated",{synergy:e,tier:s,name:K[e]}),console.log(`[SYNERGY] ${K[e]} Tier ${s} activated!`))}applySynergyBonus(e,t){const s={press:{tier1:{tackle:20,speed:10},tier2:{tackle:40,speed:20}},trianglePassing:{tier1:{passPower:25,control:15},tier2:{passPower:50,control:30}},dragFlick:{tier1:{shotPower:25},tier2:{shotPower:50}},rebound:{tier1:{speed:20},tier2:{speed:40,shotPower:20}},trickster:{tier1:{dodge:20,control:15},tier2:{dodge:40,control:30}},sweeper:{tier1:{tackle:20},tier2:{tackle:40,speed:20}},speedster:{tier1:{speed:15},tier2:{speed:30}},poacher:{tier1:{shotPower:15},tier2:{shotPower:30,speed:15}}}[e];if(!s)return;const o=t===2?s.tier2:s.tier1;Object.entries(o).forEach(([n,r])=>{const c=this.statModifiers.get(n)||0;this.statModifiers.set(n,c+r)})}getSynergyCount(e){return this.synergyCounts.get(e)||0}isSynergyActive(e){return(this.activeSynergyTiers.get(e)||0)>0}getSynergyStatuses(){const e=[];return this.synergyCounts.forEach((t,i)=>{if(t>0){const s=this.activeSynergyTiers.get(i)||0;e.push({synergy:i,name:K[i],count:t,tier:s,active:s>0})}}),e.sort((t,i)=>i.count-t.count)}trackPassForGiveAndGo(e){this.lastPassTime=this.scene.time.now,this.lastPassTarget=e.target}checkGiveAndGo(e){if(this.scene.time.now-this.lastPassTime<3500&&this.lastPassTarget){let s=1;(this.activeSynergyTiers.get("trianglePassing")||0)>=2&&(s=2),this.addTempBuff("giveAndGo","speed",15*s,2e3,"giveAndGo"),this.addTempBuff("giveAndGoControl","control",20*s,2e3,"giveAndGo"),this.addTempBuff("giveAndGoShot","shotPower",15*s,2e3,"giveAndGo"),this.emit("giveAndGoActivated",{multiplier:s}),console.log("[GIVE_AND_GO] Activated!")}this.lastPassTarget=null}callPlay(e){const t=this.scene.time.now;return t<this.playCooldownUntil?!1:(this.activePlay=e,this.playExpiresAt=t+8e3,this.playCooldownUntil=t+2e4,this.emit("playCalled",{play:e,duration:8e3}),console.log(`[PLAY] Called: ${e.toUpperCase()}`),!0)}getActivePlay(){const e=this.scene.time.now;return{play:this.playExpiresAt>e?this.activePlay:null,timeRemaining:Math.max(0,this.playExpiresAt-e),cooldownRemaining:Math.max(0,this.playCooldownUntil-e)}}isInOpenSpace(e){const t=e.scene.registry.get("enemies")||[];for(const i of t)if(p.Math.Distance.Between(e.player.x,e.player.y,i.x,i.y)<150)return!1;return!0}countNearbyTeammates(e){const t=e.scene.registry.get("teammates")||[];let i=0;for(const s of t)p.Math.Distance.Between(e.player.x,e.player.y,s.x,s.y)<150&&i++;return i}addModifier(e){const t=this.statModifiers.get(e.stat)||0;this.statModifiers.set(e.stat,t+e.value),console.log(`[UPGRADE] Added modifier: ${e.stat} += ${e.value}`)}addHook(e){const t=this.hooks.get(e.event);t&&t.push({upgradeId:"external",upgradeName:"External Effect",callback:e.effect})}getDebugInfo(){const e={};return this.hooks.forEach((t,i)=>{e[i]=t.length}),{upgradeCount:this.ownedUpgrades.length,upgrades:this.ownedUpgrades.map(t=>({id:t.id,name:t.name})),recentProcs:[...this.recentProcs].reverse(),eventStats:{...this.eventStatsPerSecond},modifiers:this.getAllModifiers(),hookCounts:e}}getTopProcs(e=5){const t=[];return this.procCounts.forEach((i,s)=>{const o=this.ownedUpgrades.find(n=>n.id===s);o&&i>0&&t.push({upgradeId:s,upgradeName:o.name,upgradeIcon:o.icon||"âš¡",count:i})}),t.sort((i,s)=>s.count-i.count).slice(0,e)}getProcCount(e){return this.procCounts.get(e)||0}getOwnedUpgradeIds(){return this.ownedUpgrades.map(e=>e.id)}getOwnedUpgrades(){return[...this.ownedUpgrades]}hasUpgrade(e){return this.ownedUpgrades.some(t=>t.id===e)}reset(){this.ownedUpgrades=[],this.hooks.forEach(e=>e.length=0),this.statModifiers.clear(),this.activeBuffs=[],this.synergyCounts.clear(),this.activeSynergyTiers.clear(),this.procCounts.clear(),this.recentProcs=[],this.upgradeCooldowns.clear(),this.stacks.clear(),this.oneTimeUsed.clear(),this.lastPassTime=0,this.lastPassTarget=null,this.activePlay=null,this.playExpiresAt=0,this.playCooldownUntil=0,this.initializeHooks()}resetMoment(){this.oneTimeUsed.delete("autoBlock"),this.oneTimeUsed.delete("guaranteedGoal"),this.procCounts.clear(),this.recentProcs=[]}}const G={wetTurf:{id:"wetTurf",name:"Wet Turf",description:"Slippery surface, reduced control",effect:"reducedControl"},pressIntense:{id:"pressIntense",name:"Intense Press",description:"Enemies press aggressively",effect:"aggressiveAI"},pcExpert:{id:"pcExpert",name:"PC Experts",description:"Enemy has deadly penalty corners",effect:"strongPC"},starPlayer:{id:"starPlayer",name:"Star Player",description:"One elite enemy with enhanced abilities",effect:"eliteEnemy"},shortTime:{id:"shortTime",name:"Short Time",description:"Less time to complete objective",effect:"reducedTime"},extraGoals:{id:"extraGoals",name:"High Score",description:"Need more goals to win",effect:"extraGoals"},outnumbered:{id:"outnumbered",name:"Outnumbered",description:"Face more enemies",effect:"moreEnemies"},noSaves:{id:"noSaves",name:"No Goalie",description:"Play without a goalkeeper",effect:"noGoalie"}},st=[{id:"scoreOne",name:"Quick Goal",description:"Score 1 goal to win",objective:"score",duration:45,targetScore:1,isBoss:!1,difficulty:1,teamSize:{player:4,enemy:3},modifiers:[]},{id:"scoreTwo",name:"Double Trouble",description:"Score 2 goals to win",objective:"multiGoal",duration:60,targetScore:2,isBoss:!1,difficulty:2,teamSize:{player:4,enemy:4},modifiers:[]},{id:"defendLead",name:"Hold the Line",description:"Defend your 1-goal lead for 40s",objective:"defend",duration:40,defendScore:1,isBoss:!1,difficulty:2,teamSize:{player:4,enemy:4},modifiers:[]},{id:"survival2v3",name:"Survival Mode",description:"Don't concede in a 2v3 for 30s",objective:"survive",duration:30,isBoss:!1,difficulty:3,teamSize:{player:2,enemy:3},modifiers:[G.outnumbered]},{id:"penaltyCornerBasic",name:"Penalty Corner",description:"Score from 3 penalty corner attempts",objective:"penaltyCorner",duration:45,targetScore:1,isBoss:!1,difficulty:2,teamSize:{player:5,enemy:5},modifiers:[]},{id:"turnoverChallenge",name:"Win It Back",description:"Steal the ball within 20s",objective:"turnover",duration:20,isBoss:!1,difficulty:2,teamSize:{player:3,enemy:3},modifiers:[]},{id:"reboundGoal",name:"Rebound Hunter",description:"Score a rebound goal",objective:"reboundGoal",duration:50,targetScore:1,isBoss:!1,difficulty:3,teamSize:{player:4,enemy:4},modifiers:[]},{id:"assistGoal",name:"Team Play",description:"Score a goal from an assist",objective:"assist",duration:45,targetScore:1,isBoss:!1,difficulty:2,teamSize:{player:4,enemy:3},modifiers:[]},{id:"quickScore",name:"Speed Run",description:"Score 1 goal in 30s",objective:"score",duration:30,targetScore:1,isBoss:!1,difficulty:3,teamSize:{player:4,enemy:4},modifiers:[G.shortTime]},{id:"wetDefend",name:"Rainy Defense",description:"Defend a lead on wet turf",objective:"defend",duration:35,defendScore:1,isBoss:!1,difficulty:3,teamSize:{player:4,enemy:4},modifiers:[G.wetTurf]},{id:"threeGoals",name:"Hat Trick",description:"Score 3 goals to win",objective:"multiGoal",duration:75,targetScore:3,isBoss:!1,difficulty:4,teamSize:{player:4,enemy:5},modifiers:[G.extraGoals]},{id:"noGoalieSurvive",name:"Open Goal",description:"Survive 25s without a goalie",objective:"survive",duration:25,isBoss:!1,difficulty:4,teamSize:{player:3,enemy:4},modifiers:[G.noSaves]},{id:"giveAndGo",name:"Give and Go",description:"Pass, receive, then score in one play",objective:"giveAndGo",duration:50,targetScore:1,isBoss:!1,difficulty:3,teamSize:{player:4,enemy:3},modifiers:[]},{id:"holdPossession",name:"Keep Ball",description:"Hold possession for 25 seconds total",objective:"possession",duration:50,isBoss:!1,difficulty:3,teamSize:{player:4,enemy:4},modifiers:[]},{id:"pressWin",name:"Press Win",description:"Force 2 turnovers in 40 seconds",objective:"pressWin",duration:40,isBoss:!1,difficulty:3,teamSize:{player:4,enemy:3},modifiers:[G.pressIntense]},{id:"protectInjector",name:"Protect the Injector",description:"Survive intense pressure for 35s",objective:"survive",duration:35,isBoss:!1,difficulty:4,teamSize:{player:3,enemy:5},modifiers:[G.pressIntense,G.outnumbered]},{id:"pcBattle",name:"PC Battle",description:"Win the penalty corner duel (score first in 3 PCs)",objective:"pcBattle",duration:60,targetScore:1,isBoss:!1,difficulty:3,teamSize:{player:5,enemy:5},modifiers:[]},{id:"pcScore",name:"Penalty Corner",description:"Score from a penalty corner in 3 attempts",objective:"pc_score",duration:45,targetScore:1,pcAttempts:3,isBoss:!1,difficulty:2,teamSize:{player:5,enemy:5},modifiers:[]},{id:"pcDefend",name:"Defend the PC",description:"Defend against 3 penalty corners",objective:"pc_defend",duration:45,defendScore:1,pcAttempts:3,isBoss:!1,difficulty:3,teamSize:{player:5,enemy:5},modifiers:[]},{id:"bossPressMachine",name:"The Press Machine",description:"Face a team that never stops pressing",objective:"score",duration:60,targetScore:2,isBoss:!0,bossType:"pressMachine",difficulty:4,teamSize:{player:4,enemy:5},modifiers:[G.pressIntense]},{id:"bossPCMonster",name:"PC Monster Team",description:"Survive vs elite penalty corner specialists",objective:"defend",duration:50,defendScore:2,isBoss:!0,bossType:"pcMonster",difficulty:4,teamSize:{player:5,enemy:5},modifiers:[G.pcExpert]},{id:"bossStarForward",name:"Star Forward",description:"Stop the elite striker with dodge and killer shot",objective:"survive",duration:45,isBoss:!0,bossType:"starForward",difficulty:5,teamSize:{player:4,enemy:4},modifiers:[G.starPlayer]},{id:"bossRainGame",name:"Rain Game",description:"Score 2 goals on wet, slippery turf",objective:"multiGoal",duration:70,targetScore:2,isBoss:!0,bossType:"rainGame",difficulty:4,teamSize:{player:4,enemy:4},modifiers:[G.wetTurf]}];function Ms(){return st.filter(k=>!k.isBoss)}function Rs(){return st.filter(k=>k.isBoss)}function Es(k=10){const a=Ms(),e=Rs(),t=[];for(let i=0;i<k;i++)if((i+1)%3===0&&e.length>0){const s=Math.floor(Math.random()*e.length);t.push(e[s])}else{const s=Math.min(1+Math.floor(i/2),4),o=a.filter(n=>n.difficulty<=s+1&&n.difficulty>=s-1);if(o.length>0){const n=Math.floor(Math.random()*o.length);t.push(o[n])}else t.push(a[Math.floor(Math.random()*a.length)])}return t}const We=5;class Bs extends p.Events.EventEmitter{constructor(e){super();l(this,"scene");l(this,"moments",[]);l(this,"currentMomentIndex",0);l(this,"currentState");l(this,"timer");l(this,"tickTimer");l(this,"cupState",{playerPoints:0,enemyPoints:0,pointsToWin:We,isEnded:!1,winner:null,comebackCursesTriggered:!1,activeCurseId:null});l(this,"runStats",{momentsWon:0,momentsLost:0,goalsScored:0,goalsConceded:0,reboundGoals:0,cleanSheets:0,bossesBeaten:0});this.scene=e}getCupState(){return{...this.cupState}}setActiveCurse(e){this.cupState.activeCurseId=e,this.cupState.comebackCursesTriggered=!0}startRun(e=10){this.moments=Es(e),this.currentMomentIndex=0,this.cupState={playerPoints:0,enemyPoints:0,pointsToWin:We,isEnded:!1,winner:null,comebackCursesTriggered:!1,activeCurseId:null},this.runStats={momentsWon:0,momentsLost:0,goalsScored:0,goalsConceded:0,reboundGoals:0,cleanSheets:0,bossesBeaten:0},this.emit("runStarted",{totalMoments:this.moments.length,cupState:this.cupState})}getCurrentMoment(){return this.moments[this.currentMomentIndex]}getCurrentState(){return this.currentState}getObjectiveDescriptor(){if(!this.currentState)return{type:"generic",timeRemaining:60,targetTeam:"player",urgency:0};const e=this.currentState,t=e.definition.objective;let i="generic";switch(t){case"score":case"multiGoal":case"reboundGoal":case"assist":i="score";break;case"defend":case"survive":i="defend";break;case"penaltyCorner":case"pcBattle":i="pc_score";break;case"turnover":case"pressWin":i="force_turnovers";break;case"possession":i="hold_possession";break;default:i="score"}const s=1-e.timeRemaining/e.definition.duration,o=e.objectiveTarget>0?e.objectiveProgress/e.objectiveTarget:0,n=Math.min(1,s*.6+(1-o)*.4),r=["defend","survive","protectInjector"].includes(t);return{type:i,timeRemaining:e.timeRemaining,targetTeam:r?"enemy":"player",urgency:n}}startMoment(){const e=this.getCurrentMoment();if(!e)return;let t=0,i=0,s=1;switch(e.objective){case"score":s=e.targetScore||1;break;case"multiGoal":s=e.targetScore||2;break;case"defend":t=e.defendScore||1,s=0;break;case"survive":s=0;break;case"penaltyCorner":s=e.targetScore||1;break;case"turnover":s=1;break;case"pressWin":s=2;break;case"reboundGoal":s=1;break;case"assist":s=1;break}this.currentState={definition:e,timeRemaining:e.duration,playerScore:t,enemyScore:i,isComplete:!1,isWon:!1,objectiveProgress:0,objectiveTarget:s},this.startTimer(),this.emit("momentStarted",{moment:e,momentNumber:this.currentMomentIndex+1,totalMoments:this.moments.length,state:this.currentState}),e.modifiers.forEach(o=>{this.emit("modifierApplied",o)})}startTimer(){this.timer=this.scene.time.addEvent({delay:1e3,callback:()=>this.tick(),loop:!0}),this.tickTimer=this.scene.time.addEvent({delay:100,callback:()=>this.emit("gameTick"),loop:!0})}tick(){!this.currentState||this.currentState.isComplete||(this.currentState.timeRemaining--,this.emit("timerTick",{remaining:this.currentState.timeRemaining,total:this.currentState.definition.duration}),this.currentState.timeRemaining<=0&&this.checkCompletion(),this.currentState.timeRemaining<=10&&this.currentState.timeRemaining>0&&this.emit("timerWarning",this.currentState.timeRemaining))}playerScored(e=!1,t=!1){if(!(!this.currentState||this.currentState.isComplete)){switch(this.currentState.playerScore++,this.runStats.goalsScored++,e&&this.runStats.reboundGoals++,this.currentState.definition.objective){case"score":case"multiGoal":this.currentState.objectiveProgress++;break;case"reboundGoal":e&&this.currentState.objectiveProgress++;break;case"assist":t&&this.currentState.objectiveProgress++;break;case"penaltyCorner":this.currentState.objectiveProgress++;break}this.emit("playerScored",{score:this.currentState.playerScore,isRebound:e,isFromAssist:t}),this.checkCompletion()}}enemyScored(){!this.currentState||this.currentState.isComplete||(this.currentState.enemyScore++,this.runStats.goalsConceded++,this.emit("enemyScored",{score:this.currentState.enemyScore}),this.checkCompletion())}playerStole(){if(!this.currentState||this.currentState.isComplete)return;const e=this.currentState.definition.objective;console.log(`[MOMENT] playerStole() called - objective: ${e}, progress: ${this.currentState.objectiveProgress}/${this.currentState.objectiveTarget}`),e==="turnover"?(this.currentState.objectiveProgress++,console.log(`[MOMENT] Turnover progress: ${this.currentState.objectiveProgress}/${this.currentState.objectiveTarget}`),this.emit("objectiveProgress",{objective:"turnover",progress:this.currentState.objectiveProgress,target:this.currentState.objectiveTarget}),this.checkCompletion()):e==="pressWin"&&(this.currentState.objectiveProgress++,console.log(`[MOMENT] Press win progress: ${this.currentState.objectiveProgress}/${this.currentState.objectiveTarget}`),this.emit("objectiveProgress",{objective:"pressWin",progress:this.currentState.objectiveProgress,target:this.currentState.objectiveTarget}),this.checkCompletion()),this.emit("playerStole")}checkCompletion(){if(!this.currentState||this.currentState.isComplete)return;const e=this.currentState,t=e.definition;let i=!1,s=!1;switch(t.objective){case"score":case"multiGoal":case"penaltyCorner":case"reboundGoal":case"assist":e.objectiveProgress>=e.objectiveTarget&&(i=!0,s=!0),e.timeRemaining<=0&&(i=!0,s=e.objectiveProgress>=e.objectiveTarget);break;case"defend":e.enemyScore>=e.playerScore&&(i=!0,s=!1),e.timeRemaining<=0&&(i=!0,s=e.playerScore>e.enemyScore);break;case"survive":e.enemyScore>0&&(i=!0,s=!1),e.timeRemaining<=0&&(i=!0,s=e.enemyScore===0);break;case"turnover":e.objectiveProgress>=e.objectiveTarget&&(i=!0,s=!0,console.log("[MOMENT] Turnover objective COMPLETED - WIN!")),e.timeRemaining<=0&&(i=!0,s=!1,console.log("[MOMENT] Turnover objective FAILED - time ran out"));break;case"pressWin":e.objectiveProgress>=e.objectiveTarget&&(i=!0,s=!0,console.log("[MOMENT] Press Win objective COMPLETED - WIN!")),e.timeRemaining<=0&&(i=!0,s=!1,console.log("[MOMENT] Press Win objective FAILED - time ran out"));break}i&&this.completeMoment(s)}failMoment(e="Unknown"){console.log(`[MOMENT] Force-failing: ${e}`),this.currentState&&(this.currentState.failReason=e),this.completeMoment(!1)}completeMoment(e){var s,o;if(!this.currentState)return;this.currentState.isComplete=!0,this.currentState.isWon=e,(s=this.timer)==null||s.destroy(),(o=this.tickTimer)==null||o.destroy(),e?(this.runStats.momentsWon++,this.currentState.enemyScore===0&&this.runStats.cleanSheets++,this.currentState.definition.isBoss&&(this.runStats.bossesBeaten++,C.getInstance().addUniqueToStat("uniqueBossesDefeated",this.currentState.definition.bossType||"unknown"))):this.runStats.momentsLost++,e?this.cupState.playerPoints++:this.cupState.enemyPoints++,console.log(`[CUP RUN] Score: Player ${this.cupState.playerPoints} - ${this.cupState.enemyPoints} Enemy`),this.cupState.playerPoints>=this.cupState.pointsToWin?(this.cupState.isEnded=!0,this.cupState.winner="player",console.log("[CUP RUN] Player wins the Cup!")):this.cupState.enemyPoints>=this.cupState.pointsToWin&&(this.cupState.isEnded=!0,this.cupState.winner="enemy",console.log("[CUP RUN] Enemy wins the Cup!"));const i=this.cupState.enemyPoints-this.cupState.playerPoints>=2&&!this.cupState.comebackCursesTriggered&&!this.cupState.isEnded;this.emit("momentComplete",{isWon:e,state:this.currentState,momentNumber:this.currentMomentIndex+1,isBoss:this.currentState.definition.isBoss,cupState:this.cupState,shouldTriggerComebackCurses:i}),this.cupState.isEnded&&this.endRun()}nextMoment(){return this.currentMomentIndex++,this.currentMomentIndex>=this.moments.length?(this.endRun(),!1):!0}endRun(){const t=this.runStats.momentsWon*15,i=this.runStats.bossesBeaten*50,s=this.runStats.cleanSheets*10,o=this.runStats.goalsScored*5,n=50+t+i+s+o,c=C.getInstance().getMetaUpgradeLevel("bonusGems")*5,h=Math.floor(n*(1+c/100)),d=C.getInstance();d.incrementStat("totalRuns"),d.incrementStat("totalMomentsWon",this.runStats.momentsWon),d.incrementStat("totalMomentsLost",this.runStats.momentsLost),d.incrementStat("totalGoals",this.runStats.goalsScored),d.incrementStat("totalBossWins",this.runStats.bossesBeaten),d.incrementStat("cleanSheets",this.runStats.cleanSheets),d.incrementStat("totalReboundGoals",this.runStats.reboundGoals),d.addGems(h),this.emit("runComplete",{stats:this.runStats,reward:h,breakdown:{base:50,momentWins:t,bosses:i,cleanSheets:s,goals:o,bonus:h-n}})}getProgress(){return{current:this.currentMomentIndex+1,total:this.moments.length,percentComplete:(this.currentMomentIndex+1)/this.moments.length*100}}getRunStats(){return{...this.runStats}}isBossMoment(){var e;return((e=this.getCurrentMoment())==null?void 0:e.isBoss)||!1}getActiveModifiers(){var e;return((e=this.getCurrentMoment())==null?void 0:e.modifiers)||[]}destroy(){var e,t;(e=this.timer)==null||e.destroy(),(t=this.tickTimer)==null||t.destroy()}}class Is{constructor(a){l(this,"scene");l(this,"container");l(this,"timerText");l(this,"timerBg");l(this,"scoreText");l(this,"objectiveText");l(this,"momentText");l(this,"possessionIndicator");l(this,"possessionText");l(this,"cooldownContainer");l(this,"cooldownIcons",new Map);l(this,"upgradeContainer");l(this,"upgradeIcons",[]);l(this,"maxUpgradeIcons",6);l(this,"radarContainer");l(this,"radarBg");l(this,"radarDots",new Map);l(this,"radarScale",.12);l(this,"radarWidth",140);l(this,"radarHeight",80);l(this,"helpButton");l(this,"controlsOverlay");l(this,"controlsVisible",!1);l(this,"pauseOverlay");l(this,"cupRunCard");l(this,"cupRunBg");l(this,"cupRunPlayerScore");l(this,"cupRunEnemyScore");l(this,"cupRunSubtitle");l(this,"cupRunTrophy");l(this,"cupRunDivider");l(this,"curseActiveText");l(this,"activeCurseName",null);l(this,"debugOverlay");l(this,"debugVisible",!1);l(this,"healthStaminaContainer");l(this,"healthBarBg");l(this,"healthBarFill");l(this,"healthText");l(this,"staminaBarBg");l(this,"staminaBarFill");l(this,"staminaText");l(this,"dashIcon");l(this,"currentHealth",100);l(this,"targetHealth",100);l(this,"currentStamina",100);l(this,"targetStamina",100);l(this,"procIconContainer");l(this,"activeProcIcons",[]);l(this,"playActiveContainer");l(this,"playActiveText");l(this,"playActiveTimer");l(this,"playActiveEndTime",0);l(this,"buffsContainer");l(this,"buffIcons",new Map);this.scene=a,this.container=a.add.container(0,0),this.container.setScrollFactor(0),this.container.setDepth(100)}createGameHUD(){const a=this.scene.cameras.main.width,e=this.scene.cameras.main.height;this.timerBg=this.scene.add.graphics(),this.timerBg.fillStyle(1710638,.8),this.timerBg.fillRoundedRect(a/2-60,10,120,50,10),this.timerBg.lineStyle(2,3447003,.8),this.timerBg.strokeRoundedRect(a/2-60,10,120,50,10),this.container.add(this.timerBg),this.timerText=this.scene.add.text(a/2,35,"0:00",{fontFamily:"Arial, sans-serif",fontSize:"28px",color:"#ffffff",fontStyle:"bold"}),this.timerText.setOrigin(.5),this.container.add(this.timerText),this.scoreText=this.scene.add.text(a/2,70,"0 - 0",{fontFamily:"Arial, sans-serif",fontSize:"20px",color:"#ecf0f1"}),this.scoreText.setOrigin(.5),this.container.add(this.scoreText),this.objectiveText=this.scene.add.text(a/2,100,"",{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#f1c40f",align:"center"}),this.objectiveText.setOrigin(.5),this.container.add(this.objectiveText),this.momentText=this.scene.add.text(20,20,"Moment 1/10",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#bdc3c7"}),this.container.add(this.momentText),this.createCupRunCard(),this.createHealthStaminaBars(),this.curseActiveText=this.scene.add.text(20,160,"",{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#ff6600",fontStyle:"bold"}),this.curseActiveText.setVisible(!1),this.container.add(this.curseActiveText),this.possessionIndicator=this.scene.add.graphics(),this.container.add(this.possessionIndicator),this.possessionText=this.scene.add.text(a-20,20,"POSSESSION",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#bdc3c7"}),this.possessionText.setOrigin(1,0),this.container.add(this.possessionText),this.cooldownContainer=this.scene.add.container(a/2,e-60),this.cooldownContainer.setScrollFactor(0),this.container.add(this.cooldownContainer),this.createCooldownIcons(),this.upgradeContainer=this.scene.add.container(20,150),this.upgradeContainer.setScrollFactor(0),this.container.add(this.upgradeContainer),this.createMiniRadar(),this.createHelpButton(),this.createControlsOverlay()}createCooldownIcons(){if(!this.cooldownContainer)return;const a=[{key:"shoot",label:"SPACE/Click",icon:"ðŸ‘"},{key:"pass",label:"E",icon:"ðŸ“"},{key:"tackle",label:"Q",icon:"âš”ï¸"},{key:"dodge",label:"SHIFT",icon:"ðŸ’¨"}],e=70,t=-((a.length-1)*e)/2;a.forEach((i,s)=>{const o=t+s*e,n=this.scene.add.circle(o,0,25,2899536);n.setStrokeStyle(2,3447003),this.cooldownContainer.add(n);const r=this.scene.add.graphics();this.cooldownContainer.add(r);const c=this.scene.add.text(o,-5,i.icon,{fontSize:"20px"});c.setOrigin(.5),this.cooldownContainer.add(c);const h=this.scene.add.text(o,20,i.label,{fontFamily:"Arial, sans-serif",fontSize:"9px",color:"#bdc3c7"});h.setOrigin(.5),this.cooldownContainer.add(h),this.cooldownIcons.set(i.key,{bg:n,overlay:r,label:h})})}createMiniRadar(){const a=this.scene.cameras.main.width,e=this.scene.cameras.main.height;this.radarContainer=this.scene.add.container(a-this.radarWidth-15,e-this.radarHeight-100),this.radarContainer.setScrollFactor(0),this.container.add(this.radarContainer),this.radarBg=this.scene.add.graphics(),this.radarBg.fillStyle(1710638,.7),this.radarBg.fillRoundedRect(0,0,this.radarWidth,this.radarHeight,5),this.radarBg.lineStyle(1,3447003,.6),this.radarBg.strokeRoundedRect(0,0,this.radarWidth,this.radarHeight,5),this.radarBg.lineStyle(1,6710886,.4),this.radarBg.beginPath(),this.radarBg.moveTo(this.radarWidth/2,0),this.radarBg.lineTo(this.radarWidth/2,this.radarHeight),this.radarBg.strokePath(),this.radarBg.strokeCircle(this.radarWidth/2,this.radarHeight/2,8),this.radarContainer.add(this.radarBg);const t=this.scene.add.text(this.radarWidth/2,-8,"RADAR",{fontFamily:"Arial, sans-serif",fontSize:"9px",color:"#666666"});t.setOrigin(.5),this.radarContainer.add(t)}updateRadar(a,e,t,i){if(!this.radarContainer)return;this.radarDots.forEach(r=>r.destroy()),this.radarDots.clear();const s=1200,o=700,n=(r,c)=>({x:r/s*this.radarWidth,y:c/o*this.radarHeight});if(i){const r=n(i.x,i.y),c=this.scene.add.circle(r.x,r.y,3,16777215);this.radarContainer.add(c),this.radarDots.set("ball",c)}if(a){const r=n(a.x,a.y),c=this.scene.add.circle(r.x,r.y,4,2600544);this.radarContainer.add(c),this.radarDots.set("player",c)}e.forEach((r,c)=>{const h=n(r.x,r.y),d=this.scene.add.circle(h.x,h.y,3,3066993);this.radarContainer.add(d),this.radarDots.set(`teammate_${c}`,d)}),t.forEach((r,c)=>{const h=n(r.x,r.y),d=this.scene.add.circle(h.x,h.y,3,15158332);this.radarContainer.add(d),this.radarDots.set(`enemy_${c}`,d)})}createHelpButton(){const a=this.scene.cameras.main.width;this.helpButton=this.scene.add.container(a-30,60),this.helpButton.setScrollFactor(0),this.container.add(this.helpButton);const e=this.scene.add.circle(0,0,15,2899536);e.setStrokeStyle(2,3447003),e.setInteractive({useHandCursor:!0}),this.helpButton.add(e);const t=this.scene.add.text(0,0,"?",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#ffffff",fontStyle:"bold"});t.setOrigin(.5),this.helpButton.add(t),e.on("pointerdown",()=>{this.toggleControlsOverlay()}),e.on("pointerover",()=>{e.setFillStyle(3447003),this.scene.tweens.add({targets:this.helpButton,scaleX:1.1,scaleY:1.1,duration:100})}),e.on("pointerout",()=>{e.setFillStyle(2899536),this.scene.tweens.add({targets:this.helpButton,scaleX:1,scaleY:1,duration:100})})}createControlsOverlay(){const a=this.scene.cameras.main.width,e=this.scene.cameras.main.height;this.controlsOverlay=this.scene.add.container(0,0),this.controlsOverlay.setScrollFactor(0),this.controlsOverlay.setDepth(200),this.controlsOverlay.setVisible(!1);const t=this.scene.add.rectangle(a/2,e/2,a,e,0,.7);t.setInteractive(),t.on("pointerdown",()=>this.hideControlsOverlay()),this.controlsOverlay.add(t);const i=450,s=380,o=this.scene.add.graphics();o.fillStyle(1710638,.95),o.fillRoundedRect(a/2-i/2,e/2-s/2,i,s,15),o.lineStyle(3,3447003,1),o.strokeRoundedRect(a/2-i/2,e/2-s/2,i,s,15),this.controlsOverlay.add(o);const n=this.scene.add.text(a/2,e/2-s/2+30,"ðŸŽ® CONTROLS",{fontFamily:"Arial, sans-serif",fontSize:"24px",color:"#ffffff",fontStyle:"bold"});n.setOrigin(.5),this.controlsOverlay.add(n);const r=[{key:"WASD / Arrows",action:"Move"},{key:"SPACE / Left Click",action:"Shoot (with ball) / Tackle intent"},{key:"E",action:"Pass to teammate"},{key:"Q",action:"Tackle (lunge to steal ball)"},{key:"SHIFT",action:"Dodge / Sidestep"},{key:"Mouse",action:"Aim direction"},{key:"ESC / P",action:"Pause game"},{key:"H",action:"Toggle this help"}],c=e/2-s/2+80;r.forEach((f,u)=>{const g=c+u*32,y=this.scene.add.graphics();y.fillStyle(2899536,1),y.fillRoundedRect(a/2-200,g-10,140,26,5),this.controlsOverlay.add(y);const b=this.scene.add.text(a/2-130,g,f.key,{fontFamily:"monospace",fontSize:"12px",color:"#3498db",fontStyle:"bold"});b.setOrigin(.5),this.controlsOverlay.add(b);const T=this.scene.add.text(a/2+30,g,f.action,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#ecf0f1"});T.setOrigin(0,.5),this.controlsOverlay.add(T)});const h=e/2+s/2-60,d=this.scene.add.text(a/2,h,"ðŸ’¡ TIP: Aim toward goal for auto-aim assist when using keyboard only",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#f39c12",wordWrap:{width:i-40},align:"center"});d.setOrigin(.5),this.controlsOverlay.add(d);const m=this.scene.add.text(a/2,e/2+s/2-25,"[ Click anywhere to close ]",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7f8c8d"});m.setOrigin(.5),this.controlsOverlay.add(m)}toggleControlsOverlay(){this.controlsVisible?this.hideControlsOverlay():this.showControlsOverlay()}showControlsOverlay(){this.controlsOverlay&&(this.controlsOverlay.setVisible(!0),this.controlsVisible=!0,this.controlsOverlay.setAlpha(0),this.scene.tweens.add({targets:this.controlsOverlay,alpha:1,duration:200}))}hideControlsOverlay(){this.controlsOverlay&&this.scene.tweens.add({targets:this.controlsOverlay,alpha:0,duration:150,onComplete:()=>{this.controlsOverlay.setVisible(!1),this.controlsVisible=!1}})}isControlsVisible(){return this.controlsVisible}showFirstRunTutorial(a){const e=this.scene.cameras.main.width,t=this.scene.cameras.main.height,i=this.scene.add.container(0,0);i.setScrollFactor(0),i.setDepth(250);const s=this.scene.add.rectangle(e/2,t/2,e,t,0,.8);i.add(s);const o=500,n=350,r=this.scene.add.graphics();r.fillStyle(1710638,.95),r.fillRoundedRect(e/2-o/2,t/2-n/2,o,n,15),r.lineStyle(3,15965202,1),r.strokeRoundedRect(e/2-o/2,t/2-n/2,o,n,15),i.add(r);const c=this.scene.add.text(e/2,t/2-140,"ðŸ‘ WELCOME TO STICK & SHIFT!",{fontFamily:"Arial, sans-serif",fontSize:"22px",color:"#f39c12",fontStyle:"bold"});c.setOrigin(.5),i.add(c);const h=this.scene.add.text(e/2,t/2-50,`QUICK CONTROLS:

â¬†ï¸â¬‡ï¸â¬…ï¸âž¡ï¸  WASD / Arrows = Move
ðŸ‘  SPACE / Click = Shoot
ðŸ“  E = Pass
âš”ï¸  Q = Tackle
ðŸ’¨  SHIFT = Dodge`,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#ecf0f1",align:"center",lineSpacing:6});h.setOrigin(.5),i.add(h);const d=this.scene.add.graphics();d.fillStyle(2600544,1),d.fillRoundedRect(e/2-80,t/2+100,160,45,10),i.add(d);const m=this.scene.add.text(e/2,t/2+122,"LET'S GO!",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#ffffff",fontStyle:"bold"});m.setOrigin(.5),i.add(m);const f=this.scene.add.rectangle(e/2,t/2+122,160,45,0,0);f.setInteractive({useHandCursor:!0}),i.add(f),f.on("pointerdown",()=>{this.scene.tweens.add({targets:i,alpha:0,duration:200,onComplete:()=>{i.destroy(),a()}})}),f.on("pointerover",()=>{d.clear(),d.fillStyle(3066993,1),d.fillRoundedRect(e/2-80,t/2+100,160,45,10)}),f.on("pointerout",()=>{d.clear(),d.fillStyle(2600544,1),d.fillRoundedRect(e/2-80,t/2+100,160,45,10)}),this.scene.time.delayedCall(6e3,()=>{i.active&&this.scene.tweens.add({targets:i,alpha:0,duration:300,onComplete:()=>{i.active&&(i.destroy(),a())}})})}showMomentRecap(a,e){const t=this.scene.cameras.main.width,i=this.scene.cameras.main.height,s=this.scene.add.container(0,0);s.setScrollFactor(0),s.setDepth(180);const o=this.scene.add.rectangle(t/2,i/2,t,i,0,.6);s.add(o);const n=350,r=280,c=this.scene.add.graphics();c.fillStyle(1710638,.95),c.fillRoundedRect(t/2-n/2,i/2-r/2,n,r,12),c.lineStyle(2,3447003,1),c.strokeRoundedRect(t/2-n/2,i/2-r/2,n,r,12),s.add(c);const h=this.scene.add.text(t/2,i/2-r/2+25,"ðŸ“Š MOMENT RECAP",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#3498db",fontStyle:"bold"});h.setOrigin(.5),s.add(h);const d=[{label:"Goals",value:`${a.goalsScored} - ${a.goalsConceded}`},{label:"Shots",value:`${a.shotsOnTarget}/${a.shotsTaken}`},{label:"Passes",value:`${a.passesCompleted}/${a.passesAttempted}`},{label:"Tackles",value:`${a.tacklesWon} won`},{label:"Possession",value:`${Math.round(a.possessionTime/a.totalTime*100)}%`}],m=i/2-r/2+65;d.forEach((y,b)=>{const T=m+b*32,x=this.scene.add.text(t/2-100,T,y.label,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#bdc3c7"});s.add(x);const w=this.scene.add.text(t/2+100,T,y.value,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#ffffff",fontStyle:"bold"});w.setOrigin(1,0),s.add(w)});const f=this.scene.add.graphics();f.fillStyle(3447003,1),f.fillRoundedRect(t/2-70,i/2+r/2-55,140,40,8),s.add(f);const u=this.scene.add.text(t/2,i/2+r/2-35,"CONTINUE",{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#ffffff",fontStyle:"bold"});u.setOrigin(.5),s.add(u);const g=this.scene.add.rectangle(t/2,i/2+r/2-35,140,40,0,0);g.setInteractive({useHandCursor:!0}),s.add(g),g.on("pointerdown",()=>{s.destroy(),e()}),g.on("pointerover",()=>{f.clear(),f.fillStyle(2719929,1),f.fillRoundedRect(t/2-70,i/2+r/2-55,140,40,8)}),g.on("pointerout",()=>{f.clear(),f.fillStyle(3447003,1),f.fillRoundedRect(t/2-70,i/2+r/2-55,140,40,8)}),s.setAlpha(0),this.scene.tweens.add({targets:s,alpha:1,duration:300})}updateTimer(a,e){if(!this.timerText||!this.timerBg)return;const t=Math.floor(a/60),i=a%60;this.timerText.setText(`${t}:${i.toString().padStart(2,"0")}`),a<=10?(this.timerText.setColor("#e74c3c"),a>0&&this.scene.tweens.add({targets:this.timerText,scaleX:1.2,scaleY:1.2,duration:100,yoyo:!0})):a<=30?this.timerText.setColor("#f39c12"):this.timerText.setColor("#ffffff")}updateScore(a,e){this.scoreText&&(this.scoreText.setText(`${a} - ${e}`),this.scene.tweens.add({targets:this.scoreText,scaleX:1.3,scaleY:1.3,duration:150,yoyo:!0}))}updateObjective(a){this.objectiveText&&this.objectiveText.setText(a)}updateMomentCounter(a,e,t=!1){if(!this.momentText)return;const i=t?"âš ï¸ BOSS - ":"";this.momentText.setText(`${i}Moment ${a}/${e}`),t?this.momentText.setColor("#e74c3c"):this.momentText.setColor("#bdc3c7")}createCupRunCard(){this.cupRunCard=this.scene.add.container(15,42),this.cupRunCard.setScrollFactor(0),this.cupRunBg=this.scene.add.graphics(),this.drawCupRunCardBg(170,62,1710638,.92),this.cupRunCard.add(this.cupRunBg),this.cupRunTrophy=this.scene.add.text(12,10,"ðŸ†",{fontFamily:"Arial, sans-serif",fontSize:"22px"}),this.cupRunCard.add(this.cupRunTrophy),this.cupRunPlayerScore=this.scene.add.text(50,8,"0",{fontFamily:"Arial Black, Arial, sans-serif",fontSize:"28px",color:"#2ecc71",fontStyle:"bold"}),this.cupRunCard.add(this.cupRunPlayerScore),this.cupRunDivider=this.scene.add.text(78,12,"â€”",{fontFamily:"Arial, sans-serif",fontSize:"22px",color:"#7f8c8d"}),this.cupRunCard.add(this.cupRunDivider),this.cupRunEnemyScore=this.scene.add.text(102,8,"0",{fontFamily:"Arial Black, Arial, sans-serif",fontSize:"28px",color:"#e74c3c",fontStyle:"bold"}),this.cupRunCard.add(this.cupRunEnemyScore);const s=this.scene.add.text(50,36,"YOU",{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#95a5a6",fontStyle:"bold"});this.cupRunCard.add(s);const o=this.scene.add.text(102,36,"ENEMY",{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#95a5a6",fontStyle:"bold"});this.cupRunCard.add(o),this.cupRunSubtitle=this.scene.add.text(170/2,50,"CUP RUN â€¢ First to 5",{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#f39c12"}),this.cupRunSubtitle.setOrigin(.5,.5),this.cupRunCard.add(this.cupRunSubtitle),this.container.add(this.cupRunCard)}drawCupRunCardBg(a,e,t,i){this.cupRunBg&&(this.cupRunBg.clear(),this.cupRunBg.fillStyle(0,.3),this.cupRunBg.fillRoundedRect(3,3,a,e,8),this.cupRunBg.fillStyle(t,i),this.cupRunBg.fillRoundedRect(0,0,a,e,8),this.cupRunBg.lineStyle(2,15965202,.8),this.cupRunBg.strokeRoundedRect(0,0,a,e,8),this.cupRunBg.fillStyle(16777215,.05),this.cupRunBg.fillRoundedRect(2,2,a-4,e/3,6))}createHealthStaminaBars(){this.healthStaminaContainer=this.scene.add.container(15,110),this.healthStaminaContainer.setScrollFactor(0),this.healthStaminaContainer.setDepth(101),this.healthBarBg=this.scene.add.graphics(),this.healthBarBg.fillStyle(1710638,.9),this.healthBarBg.fillRoundedRect(0,0,160,16,4),this.healthBarBg.lineStyle(1,15158332,.5),this.healthBarBg.strokeRoundedRect(0,0,160,16,4),this.healthStaminaContainer.add(this.healthBarBg),this.healthBarFill=this.scene.add.graphics(),this.drawHealthBar(100),this.healthStaminaContainer.add(this.healthBarFill);const o=this.scene.add.text(-2,-2,"â¤ï¸",{fontFamily:"Arial",fontSize:"14px"});o.setOrigin(0,0),this.healthStaminaContainer.add(o),this.healthText=this.scene.add.text(155,16/2,"100",{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#ffffff",fontStyle:"bold"}),this.healthText.setOrigin(1,.5),this.healthStaminaContainer.add(this.healthText);const n=22;this.staminaBarBg=this.scene.add.graphics(),this.staminaBarBg.fillStyle(1710638,.9),this.staminaBarBg.fillRoundedRect(0,n,160,16,4),this.staminaBarBg.lineStyle(1,15965202,.5),this.staminaBarBg.strokeRoundedRect(0,n,160,16,4),this.healthStaminaContainer.add(this.staminaBarBg),this.staminaBarFill=this.scene.add.graphics(),this.drawStaminaBar(100,n),this.healthStaminaContainer.add(this.staminaBarFill);const r=this.scene.add.text(-2,n-2,"âš¡",{fontFamily:"Arial",fontSize:"14px"});this.healthStaminaContainer.add(r),this.staminaText=this.scene.add.text(155,n+16/2,"100",{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#ffffff",fontStyle:"bold"}),this.staminaText.setOrigin(1,.5),this.healthStaminaContainer.add(this.staminaText),this.dashIcon=this.scene.add.text(165,n+16/2,"ðŸ’¨",{fontFamily:"Arial",fontSize:"16px"}),this.dashIcon.setOrigin(0,.5),this.healthStaminaContainer.add(this.dashIcon)}drawHealthBar(a){if(!this.healthBarFill)return;const e=160,t=16,i=Math.max(0,(e-4)*(a/100));this.healthBarFill.clear();let s;a>60?s=3066993:a>30?s=15965202:s=15158332,this.healthBarFill.fillStyle(s,.9),this.healthBarFill.fillRoundedRect(2,2,i,t-4,3),this.healthBarFill.fillStyle(16777215,.2),this.healthBarFill.fillRect(2,2,i,(t-4)/3)}drawStaminaBar(a,e){if(!this.staminaBarFill)return;const t=160,i=16,s=Math.max(0,(t-4)*(a/100));this.staminaBarFill.clear();let o,n;a>30?(o=3447003,n=.9):a>0?(o=9807270,n=.7):(o=8359053,n=.5),this.staminaBarFill.fillStyle(o,n),this.staminaBarFill.fillRoundedRect(2,e+2,s,i-4,3),this.staminaBarFill.fillStyle(16777215,.2),this.staminaBarFill.fillRect(2,e+2,s,(i-4)/3)}updateHealth(a,e){this.targetHealth=a/e*100,this.currentHealth=p.Math.Linear(this.currentHealth,this.targetHealth,.15),this.drawHealthBar(this.currentHealth),this.healthText&&(this.healthText.setText(Math.ceil(a).toString()),a<e&&this.targetHealth<this.currentHealth-1&&this.scene.tweens.add({targets:this.healthText,tint:16711680,duration:100,yoyo:!0}))}updateStamina(a,e,t){this.targetStamina=a/e*100,this.currentStamina=p.Math.Linear(this.currentStamina,this.targetStamina,.2),this.drawStaminaBar(this.currentStamina,22),this.staminaText&&this.staminaText.setText(Math.ceil(a).toString()),this.dashIcon&&this.dashIcon.setAlpha(t?1:.3)}showProcIcon(a,e,t){const i=this.scene.add.container(t.x,t.y-50);i.setDepth(150);const s=this.scene.add.graphics();s.fillStyle(0,.7),s.fillCircle(0,0,18),s.lineStyle(2,15965202,.8),s.strokeCircle(0,0,18),i.add(s);const o=this.scene.add.text(0,0,a,{fontFamily:"Arial",fontSize:"20px"});o.setOrigin(.5),i.add(o),i.setScale(0),this.scene.tweens.add({targets:i,scaleX:1.2,scaleY:1.2,duration:100,ease:"Back.easeOut",yoyo:!0,repeat:0,onComplete:()=>{i.setScale(1)}}),this.scene.tweens.add({targets:i,y:i.y-40,alpha:0,duration:1e3,ease:"Quad.easeOut",delay:200,onComplete:()=>{i.destroy()}}),this.activeProcIcons.push({container:i,expiresAt:this.scene.time.now+1200}),this.activeProcIcons=this.activeProcIcons.filter(n=>this.scene.time.now>n.expiresAt?(n.container&&n.container.scene&&n.container.destroy(),!1):!0)}updateCupRun(a,e,t=5){if(!this.cupRunCard||!this.cupRunPlayerScore||!this.cupRunEnemyScore)return;const i=parseInt(this.cupRunPlayerScore.text)||0,s=parseInt(this.cupRunEnemyScore.text)||0;this.cupRunPlayerScore.setText(a.toString()),this.cupRunEnemyScore.setText(e.toString()),this.cupRunSubtitle&&this.cupRunSubtitle.setText(`CUP RUN â€¢ First to ${t}`),a>e?(this.cupRunPlayerScore.setColor("#2ecc71"),this.cupRunEnemyScore.setColor("#95a5a6")):e>a?(this.cupRunPlayerScore.setColor("#95a5a6"),this.cupRunEnemyScore.setColor("#e74c3c")):(this.cupRunPlayerScore.setColor("#f1c40f"),this.cupRunEnemyScore.setColor("#f1c40f")),(a!==i||e!==s)&&this.animateCupRunScoreChange(a>i,e>s)}animateCupRunScoreChange(a,e){this.cupRunCard&&(this.scene.tweens.add({targets:this.cupRunCard,scaleX:1.08,scaleY:1.08,duration:100,yoyo:!0,ease:"Quad.easeOut"}),a&&this.cupRunPlayerScore&&(this.scene.tweens.add({targets:this.cupRunPlayerScore,scale:1.3,duration:150,yoyo:!0,ease:"Bounce.easeOut"}),this.flashCupRunSide("player")),e&&this.cupRunEnemyScore&&(this.scene.tweens.add({targets:this.cupRunEnemyScore,scale:1.3,duration:150,yoyo:!0,ease:"Bounce.easeOut"}),this.flashCupRunSide("enemy")))}flashCupRunSide(a){if(!this.cupRunBg)return;const e=this.scene.add.graphics(),t=a==="player"?0:85,i=a==="player"?3066993:15158332;e.fillStyle(i,.4),e.fillRoundedRect(t,0,85,62,a==="player"?{tl:8,bl:8,tr:0,br:0}:{tl:0,bl:0,tr:8,br:8}),this.cupRunCard&&(this.cupRunCard.add(e),this.cupRunCard.sendToBack(e),this.cupRunCard.sendToBack(this.cupRunBg)),this.scene.tweens.add({targets:e,alpha:0,duration:400,ease:"Quad.easeOut",onComplete:()=>e.destroy()})}setActiveCurse(a){this.activeCurseName=a,this.curseActiveText&&(a?(this.curseActiveText.setText(`âš¡ CURSE ACTIVE: ${a}`),this.curseActiveText.setVisible(!0)):this.curseActiveText.setVisible(!1))}getActiveCurseName(){return this.activeCurseName}showPlayActive(a,e){var s;const t=this.scene.cameras.main.width;if(!this.playActiveContainer){this.playActiveContainer=this.scene.add.container(t/2,130),this.playActiveContainer.setScrollFactor(0),this.playActiveContainer.setDepth(100);const o=this.scene.add.graphics();o.fillStyle(1710638,.9),o.fillRoundedRect(-80,-18,160,36,8),this.playActiveContainer.add(o),this.playActiveTimer=this.scene.add.graphics(),this.playActiveContainer.add(this.playActiveTimer),this.playActiveText=this.scene.add.text(0,0,"",{fontFamily:"Arial Black, Arial, sans-serif",fontSize:"16px",color:"#ffffff"}),this.playActiveText.setOrigin(.5,.5),this.playActiveContainer.add(this.playActiveText),this.container.add(this.playActiveContainer)}const i={press:"ðŸƒ PRESS",hold:"ðŸ›¡ï¸ HOLD",counter:"âš¡ COUNTER"};(s=this.playActiveText)==null||s.setText(i[a]||a.toUpperCase()),this.playActiveContainer.setVisible(!0),this.playActiveEndTime=this.scene.time.now+e,this.updatePlayTimer()}updatePlayTimer(){if(!this.playActiveTimer||!this.playActiveContainer)return;const a=this.scene.time.now,e=Math.max(0,this.playActiveEndTime-a);if(e<=0){this.playActiveContainer.setVisible(!1);return}const i=e/8e3;this.playActiveTimer.clear(),this.playActiveTimer.lineStyle(3,15965202,1),this.playActiveTimer.arc(60,0,12,p.Math.DegToRad(-90),p.Math.DegToRad(-90+360*i),!1),this.playActiveTimer.strokePath()}updateActiveBuffs(a){const e=this.scene.cameras.main.width;this.buffsContainer||(this.buffsContainer=this.scene.add.container(e-200,120),this.buffsContainer.setScrollFactor(0),this.buffsContainer.setDepth(100),this.container.add(this.buffsContainer));const t=new Set(a.map(s=>s.id));this.buffIcons.forEach((s,o)=>{t.has(o)||(s.destroy(),this.buffIcons.delete(o))});let i=0;for(const s of a.slice(0,6)){let o=this.buffIcons.get(s.id);if(!o){o=this.scene.add.container(i,0);const r=this.scene.add.circle(0,0,18,this.getBuffColor(s.source),.8);o.add(r);const c=this.scene.add.text(0,0,s.icon||"â¬†ï¸",{fontFamily:"Arial, sans-serif",fontSize:"14px"});c.setOrigin(.5,.5),o.add(c);const h=this.scene.add.graphics();h.setName("timer"),o.add(h),this.buffsContainer.add(o),this.buffIcons.set(s.id,o)}const n=o.getByName("timer");if(n&&s.timeRemaining>0){const r=Math.min(1,s.timeRemaining/5e3);n.clear(),n.lineStyle(2,16777215,.8),n.arc(0,0,18,p.Math.DegToRad(-90),p.Math.DegToRad(-90+360*r),!1),n.strokePath()}o.setPosition(i,0),i+=42}}getBuffColor(a){switch(a){case"upgrade":return 10181046;case"synergy":return 15965202;case"play":return 3447003;case"giveAndGo":return 3066993;case"curse":return 15158332;default:return 8359053}}showGiveAndGo(){const a=this.scene.add.text(this.scene.cameras.main.centerX,this.scene.cameras.main.centerY-80,"ðŸ”„ GIVE & GO!",{fontFamily:"Arial Black, Arial, sans-serif",fontSize:"32px",color:"#2ecc71",stroke:"#000000",strokeThickness:4});a.setOrigin(.5,.5),a.setScrollFactor(0),a.setDepth(500),a.setScale(0),this.scene.tweens.add({targets:a,scale:1,duration:150,ease:"Back.easeOut",onComplete:()=>{this.scene.time.delayedCall(600,()=>{this.scene.tweens.add({targets:a,alpha:0,y:a.y-40,duration:300,onComplete:()=>a.destroy()})})}})}showSynergyActivated(a,e){const t=this.scene.add.text(this.scene.cameras.main.centerX,this.scene.cameras.main.centerY-60,`âš¡ ${a.toUpperCase()} T${e}!`,{fontFamily:"Arial Black, Arial, sans-serif",fontSize:"28px",color:"#f39c12",stroke:"#000000",strokeThickness:4});t.setOrigin(.5,.5),t.setScrollFactor(0),t.setDepth(500),t.setScale(0),this.scene.tweens.add({targets:t,scale:1,duration:200,ease:"Back.easeOut",onComplete:()=>{this.scene.time.delayedCall(1e3,()=>{this.scene.tweens.add({targets:t,alpha:0,y:t.y-40,duration:400,onComplete:()=>t.destroy()})})}})}updatePossession(a){if(!this.possessionIndicator||!this.possessionText)return;const e=this.scene.cameras.main.width;this.possessionIndicator.clear(),this.possessionIndicator.fillStyle(a?2600544:15158332,1),this.possessionIndicator.fillCircle(e-40,45,10),this.possessionText.setText(a?"YOUR BALL":"ENEMY BALL"),this.possessionText.setColor(a?"#27ae60":"#e74c3c")}updateCooldown(a,e){const t=this.cooldownIcons.get(a);if(!t)return;const{bg:i,overlay:s}=t;s.clear(),e>0&&e<1&&(s.fillStyle(0,.7),s.slice(i.x,i.y,25,p.Math.DegToRad(-90),p.Math.DegToRad(-90+360*(1-e)),!0),s.fillPath()),e===0?(i.setFillStyle(2899536),i.setStrokeStyle(2,3447003)):(i.setFillStyle(1710618),i.setStrokeStyle(2,8359053))}updateFromMomentState(a,e,t){this.updateTimer(a.timeRemaining,a.definition.duration),this.updateScore(a.playerScore,a.enemyScore),this.updateMomentCounter(e,t,a.definition.isBoss);let i="";switch(a.definition.objective){case"score":i=`Score ${a.objectiveTarget} goal${a.objectiveTarget>1?"s":""} (${a.objectiveProgress}/${a.objectiveTarget})`;break;case"multiGoal":i=`Score ${a.objectiveTarget} goals (${a.objectiveProgress}/${a.objectiveTarget})`;break;case"defend":i="Defend your lead!";break;case"survive":i="Don't concede!";break;case"penaltyCorner":i=`Score from penalty corner (${a.objectiveProgress}/${a.objectiveTarget})`;break;case"turnover":i="Win the ball back!";break;case"reboundGoal":i=`Score a rebound goal (${a.objectiveProgress}/${a.objectiveTarget})`;break;case"assist":i=`Score from an assist (${a.objectiveProgress}/${a.objectiveTarget})`;break;case"giveAndGo":i=`Give-and-go goal (${a.objectiveProgress}/${a.objectiveTarget})`;break;case"possession":i=`Hold possession: ${Math.round(a.objectiveProgress)}s / ${a.objectiveTarget}s`;break;case"pressWin":i=`Force turnovers (${a.objectiveProgress}/${a.objectiveTarget})`;break}this.updateObjective(i)}addUpgradeIcon(a,e,t="common"){if(!this.upgradeContainer)return;if(this.upgradeIcons.length>=this.maxUpgradeIcons){const h=this.upgradeIcons.shift();h==null||h.container.destroy(),this.repositionUpgradeIcons()}const s=this.upgradeIcons.length*38,o=this.scene.add.container(0,s);this.upgradeContainer.add(o);const n=N[t]||3447003,r=this.scene.add.circle(15,0,17,1710638,.9);r.setStrokeStyle(2,n),o.add(r);const c=this.scene.add.text(15,0,a,{fontSize:"18px"});c.setOrigin(.5),o.add(c),this.upgradeIcons.push({container:o,bg:r,icon:c,rarity:t,upgradeId:e}),o.setAlpha(0),o.setScale(.5),this.scene.tweens.add({targets:o,alpha:1,scaleX:1,scaleY:1,duration:200,ease:"Back.easeOut"}),r.setInteractive(),r.on("pointerover",()=>{})}repositionUpgradeIcons(){this.upgradeIcons.forEach((a,e)=>{this.scene.tweens.add({targets:a.container,y:e*38,duration:150,ease:"Power2"})})}showUpgradeProc(a,e=1){const t=this.upgradeIcons.find(i=>i.upgradeId===a.name);t&&this.pulseUpgradeIcon(t,e),e>=.7&&this.showProcToast(a.name,a.icon,e)}pulseUpgradeIcon(a,e){const{container:t,bg:i}=a,s=N[a.rarity]||3447003;this.scene.tweens.add({targets:t,scaleX:1.25,scaleY:1.25,duration:100,yoyo:!0,ease:"Power2"}),i.lineWidth,i.setStrokeStyle(4,s),this.scene.time.delayedCall(200,()=>{i.setStrokeStyle(2,s)})}showProcToast(a,e,t){const i=this.scene.cameras.main.width,s=this.scene.add.text(i-20,140+this.upgradeIcons.length*38,`${e} ${a}!`,{fontFamily:"Arial, sans-serif",fontSize:t>=1?"14px":"12px",color:t>=1?"#f1c40f":"#ecf0f1",fontStyle:t>=1?"bold":"normal"});s.setOrigin(1,.5),s.setScrollFactor(0),s.setDepth(110),s.setAlpha(0),s.x+=30,this.scene.tweens.add({targets:s,alpha:1,x:s.x-30,duration:150,ease:"Power2",onComplete:()=>{this.scene.tweens.add({targets:s,alpha:0,x:s.x-20,duration:300,delay:800,onComplete:()=>s.destroy()})}})}showGoalNotification(a){const e=a?"âš½ GOAL!":"ðŸ˜ž CONCEDED",t=a?"#27ae60":"#e74c3c",i=this.scene.add.text(this.scene.cameras.main.centerX,this.scene.cameras.main.centerY,e,{fontFamily:"Arial, sans-serif",fontSize:"64px",color:t,fontStyle:"bold",stroke:"#000000",strokeThickness:6});i.setOrigin(.5),i.setScrollFactor(0),i.setDepth(150),i.setScale(0),this.scene.tweens.add({targets:i,scaleX:1,scaleY:1,duration:300,ease:"Back.easeOut",onComplete:()=>{this.scene.tweens.add({targets:i,alpha:0,y:i.y-50,duration:500,delay:500,onComplete:()=>i.destroy()})}})}showNoPossessionFeedback(){const a=this.scene.add.text(this.scene.cameras.main.centerX,this.scene.cameras.main.centerY+100,"No ball!",{fontFamily:"Arial, sans-serif",fontSize:"20px",color:"#e74c3c",stroke:"#000000",strokeThickness:3});a.setOrigin(.5),a.setScrollFactor(0),a.setDepth(120),this.scene.tweens.add({targets:a,alpha:0,y:a.y-30,duration:600,onComplete:()=>a.destroy()})}showMomentComplete(a){const e=this.scene.add.rectangle(this.scene.cameras.main.centerX,this.scene.cameras.main.centerY,this.scene.cameras.main.width,this.scene.cameras.main.height,a?2600544:15158332,.3);e.setScrollFactor(0),e.setDepth(140);const t=this.scene.add.text(this.scene.cameras.main.centerX,this.scene.cameras.main.centerY,a?"âœ“ MOMENT WON!":"âœ— MOMENT LOST",{fontFamily:"Arial, sans-serif",fontSize:"48px",color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:4});t.setOrigin(.5),t.setScrollFactor(0),t.setDepth(141),t.setScale(0),this.scene.tweens.add({targets:t,scaleX:1,scaleY:1,duration:400,ease:"Back.easeOut"}),this.scene.time.delayedCall(1500,()=>{this.scene.tweens.add({targets:[e,t],alpha:0,duration:300,onComplete:()=>{e.destroy(),t.destroy()}})})}destroy(){var a;this.container.destroy(),this.cooldownIcons.clear(),this.radarDots.clear(),(a=this.controlsOverlay)==null||a.destroy()}}class Os{constructor(a){l(this,"scene");l(this,"emitters",new Map);this.scene=a}init(){this.createSprintEmitter(),this.createDustEmitter(),this.createConfettiEmitter(),this.createStarEmitter(),this.createBurstEmitter()}createSprintEmitter(){const a=this.scene.add.particles(0,0,"particle_sprint",{speed:{min:20,max:50},scale:{start:.5,end:0},alpha:{start:.6,end:0},lifespan:300,blendMode:"ADD",frequency:-1});a.setDepth(5),this.emitters.set("sprint",a)}createDustEmitter(){const a=this.scene.add.particles(0,0,"particle_dust",{speed:{min:30,max:80},angle:{min:-150,max:-30},scale:{start:.8,end:.2},alpha:{start:.7,end:0},lifespan:400,gravityY:100,frequency:-1});a.setDepth(4),this.emitters.set("dust",a)}createConfettiEmitter(){for(let a=0;a<6;a++){const e=this.scene.add.particles(0,0,`confetti_${a}`,{speed:{min:100,max:300},angle:{min:-120,max:-60},scale:{start:1.5,end:.5},alpha:{start:1,end:.5},rotate:{min:0,max:360},lifespan:2e3,gravityY:200,frequency:-1});e.setDepth(100),this.emitters.set(`confetti_${a}`,e)}}createStarEmitter(){const a=this.scene.add.particles(0,0,"particle_star",{speed:{min:50,max:150},scale:{start:.8,end:0},alpha:{start:1,end:0},rotate:{min:0,max:360},lifespan:600,frequency:-1});a.setDepth(50),this.emitters.set("star",a)}createBurstEmitter(){const a=this.scene.add.particles(0,0,"particle_burst",{speed:{min:100,max:200},scale:{start:.5,end:0},alpha:{start:1,end:0},lifespan:300,blendMode:"ADD",frequency:-1});a.setDepth(50),this.emitters.set("burst",a)}emitSprint(a,e,t,i){const s=this.emitters.get("sprint");s&&(s.setPosition(a,e),s.setParticleSpeed(-t*.3,-i*.3),s.emitParticle(1))}emitDust(a,e,t=5){const i=this.emitters.get("dust");i&&(i.setPosition(a,e),i.emitParticle(t))}emitConfetti(a,e,t=50){const i=Math.ceil(t/6);for(let s=0;s<6;s++){const o=this.emitters.get(`confetti_${s}`);o&&(o.setPosition(a,e),o.emitParticle(i))}}emitStars(a,e,t=8){const i=this.emitters.get("star");i&&(i.setPosition(a,e),i.emitParticle(t))}emitBurst(a,e,t=6){const i=this.emitters.get("burst");i&&(i.setPosition(a,e),i.emitParticle(t))}goalCelebration(a,e){[0,100,200].forEach((s,o)=>{this.scene.time.delayedCall(s,()=>{this.emitConfetti(a+(o-1)*50,e,30),this.emitStars(a,e,5)})}),this.emitBurst(a,e,10),this.scene.cameras.main.shake(200,.01);const i=this.scene.add.image(a,e,"effect_goal");i.setAlpha(.8),i.setScale(.5),i.setDepth(90),i.setBlendMode(p.BlendModes.ADD),this.scene.tweens.add({targets:i,scale:3,alpha:0,duration:500,ease:"Power2",onComplete:()=>i.destroy()})}tackleImpact(a,e){this.emitDust(a,e,8),this.emitBurst(a,e,4);const t=this.scene.add.image(a,e,"effect_tackle");t.setAlpha(.8),t.setScale(.5),t.setDepth(45),this.scene.tweens.add({targets:t,scale:1.5,alpha:0,rotation:Math.PI/4,duration:300,ease:"Power2",onComplete:()=>t.destroy()}),this.scene.cameras.main.shake(100,.005)}dodgeEffect(a,e,t){const i=this.scene.add.image(a,e,"effect_dodge");i.setAlpha(.7),i.setRotation(t),i.setDepth(44),this.scene.tweens.add({targets:i,alpha:0,scale:1.5,duration:250,ease:"Power2",onComplete:()=>i.destroy()})}powerUpEffect(a,e){this.emitStars(a,e,12);const t=this.scene.add.graphics();t.lineStyle(4,15844367,1),t.strokeCircle(0,0,10),t.setPosition(a,e),t.setDepth(50),this.scene.tweens.add({targets:t,scaleX:3,scaleY:3,alpha:0,duration:400,ease:"Power2",onComplete:()=>t.destroy()})}sparkBurst(a,e,t=16766720,i=8){for(let s=0;s<i;s++){const o=Math.PI*2*s/i+(Math.random()-.5)*.3,n=60+Math.random()*100,r=3+Math.random()*3,c=this.scene.add.graphics();c.fillStyle(t,1),c.fillCircle(0,0,r),c.setPosition(a,e),c.setDepth(55);const h=a+Math.cos(o)*n,d=e+Math.sin(o)*n;this.scene.tweens.add({targets:c,x:h,y:d,alpha:0,scaleX:.2,scaleY:.2,duration:200+Math.random()*150,ease:"Power2",onComplete:()=>c.destroy()})}}destroy(){this.emitters.forEach(a=>a.destroy()),this.emitters.clear()}}class Gs extends p.GameObjects.Ellipse{constructor(e,t,i,s="speed"){let o=16777215,n=16,r=8;switch(s){case"speed":o=3447003,n=20,r=10;break;case"dodge":o=4774907,n=24,r=12;break;case"power":o=15844367,n=18,r=8;break}super(e,t,i,n,r,o,.6);l(this,"age",0);l(this,"maxAge");l(this,"fadeSpeed");this.maxAge=300,this.fadeSpeed=1/this.maxAge,e.add.existing(this),this.setDepth(5)}update(e){this.age+=e;const t=1-this.age/this.maxAge;return this.setAlpha(t*.6),this.setScale(t),this.age>=this.maxAge?(this.destroy(),!1):!0}}class Ls{constructor(a){l(this,"scene");l(this,"trails",[]);l(this,"lastSpawnTime",0);l(this,"spawnInterval",30);this.scene=a}spawn(a,e,t="speed"){const i=this.scene.time.now;if(i-this.lastSpawnTime<this.spawnInterval)return;this.lastSpawnTime=i;const s=new Gs(this.scene,a,e,t);this.trails.push(s)}update(a){this.trails=this.trails.filter(e=>e.update(a))}clear(){this.trails.forEach(a=>a.destroy()),this.trails=[]}setSpawnInterval(a){this.spawnInterval=a}}class Ks extends p.GameObjects.Zone{constructor(e,t,i){super(e,t,i,60,40);l(this,"visual");l(this,"lifespan",3e3);l(this,"age",0);e.add.existing(this),e.physics.add.existing(this,!0),this.visual=e.add.ellipse(t,i,60,40,3447003,.3),this.visual.setStrokeStyle(2,6139362,.5),this.visual.setDepth(3)}update(e){this.age+=e;const t=1+Math.sin(this.age*.01)*.1;if(this.visual.setScale(t),this.age>this.lifespan*.7){const i=(this.lifespan-this.age)/(this.lifespan*.3);this.visual.setAlpha(i*.3)}return this.age>=this.lifespan?(this.visual.destroy(),this.destroy(),!1):!0}applyBoost(e){}}class Fs extends p.GameObjects.Container{constructor(e,t){super(e,0,0);l(this,"overlay");l(this,"cards",[]);l(this,"currentUpgrades",[]);l(this,"config");l(this,"rerollsRemaining");l(this,"rerollButton");l(this,"skipButton");this.config=t,this.rerollsRemaining=t.rerolls,this.overlay=e.add.rectangle(e.cameras.main.centerX,e.cameras.main.centerY,e.cameras.main.width,e.cameras.main.height,0,.85),this.overlay.setDepth(200),this.add(this.overlay);const i=e.add.text(e.cameras.main.centerX,80,"âš¡ CHOOSE YOUR UPGRADE âš¡",{fontFamily:"Arial, sans-serif",fontSize:"36px",color:"#f1c40f",fontStyle:"bold"});i.setOrigin(.5),i.setDepth(201),this.add(i);const s=e.add.text(e.cameras.main.centerX,120,`Moment ${t.momentNumber} Complete!`,{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#bdc3c7"});s.setOrigin(.5),s.setDepth(201),this.add(s),this.generateUpgrades(),this.rerollsRemaining>0&&(this.rerollButton=new E(e,{x:e.cameras.main.centerX-100,y:e.cameras.main.height-80,width:150,height:40,text:`ðŸ”„ Reroll (${this.rerollsRemaining})`,fontSize:16,style:"secondary",onClick:()=>this.reroll()}),this.rerollButton.setDepth(201),this.add(this.rerollButton)),t.onSkip&&(this.skipButton=new E(e,{x:e.cameras.main.centerX+100,y:e.cameras.main.height-80,width:150,height:40,text:"Skip",fontSize:16,style:"danger",onClick:()=>{this.hide(),t.onSkip()}}),this.skipButton.setDepth(201),this.add(this.skipButton)),this.setDepth(200),e.add.existing(this),this.show()}generateUpgrades(){const e=3+this.config.extraChoices;this.currentUpgrades=Ds(e,this.config.momentNumber,this.config.ownedUpgradeIds),this.displayCards()}displayCards(){this.cards.forEach(n=>n.destroy()),this.cards=[];const e=180,t=30,i=this.currentUpgrades.length*e+(this.currentUpgrades.length-1)*t,s=this.scene.cameras.main.centerX-i/2+e/2,o=this.config.seenUpgradeIds||[];this.currentUpgrades.forEach((n,r)=>{const c=!o.includes(n.id),h=new _s(this.scene,s+r*(e+t),this.scene.cameras.main.centerY,n,c,()=>this.selectUpgrade(n));h.setDepth(202),this.cards.push(h),this.add(h),h.setAlpha(0),h.setScale(.3),h.y=this.scene.cameras.main.centerY+100,this.scene.tweens.add({targets:h,alpha:1,scaleX:1,scaleY:1,y:this.scene.cameras.main.centerY,duration:400,delay:r*120,ease:"Back.easeOut"})})}reroll(){this.rerollsRemaining<=0||(this.rerollsRemaining--,this.cards.forEach((e,t)=>{this.scene.tweens.add({targets:e,alpha:0,y:e.y-50,duration:200,delay:t*50,onComplete:()=>{t===this.cards.length-1&&this.generateUpgrades()}})}),this.rerollButton&&(this.rerollsRemaining>0?this.rerollButton.setText(`ðŸ”„ Reroll (${this.rerollsRemaining})`):(this.rerollButton.setDisabled(!0),this.rerollButton.setText("No Rerolls"))))}selectUpgrade(e){this.cards.forEach(i=>{i.upgrade.id===e.id?(this.scene.tweens.add({targets:i,scaleX:1.3,scaleY:1.3,y:i.y-30,duration:300,ease:"Back.easeOut"}),i.flashSelected(),this.scene.cameras.main.shake(100,.005)):this.scene.tweens.add({targets:i,alpha:.2,y:i.y+30,scaleX:.9,scaleY:.9,duration:250})});const t=this.scene.add.text(this.scene.cameras.main.centerX,this.scene.cameras.main.height-150,`âœ¨ ${e.name} ADDED! âœ¨`,{fontFamily:"Arial Black, Arial, sans-serif",fontSize:"24px",color:"#00ff00",stroke:"#003300",strokeThickness:4});t.setOrigin(.5),t.setDepth(300),t.setAlpha(0),t.setScale(.5),this.scene.tweens.add({targets:t,alpha:1,scaleX:1.1,scaleY:1.1,duration:200,ease:"Back.easeOut",onComplete:()=>{this.scene.tweens.add({targets:t,scaleX:1,scaleY:1,duration:100})}}),this.scene.time.delayedCall(700,()=>{t.destroy(),this.hide(),this.config.onSelect(e)})}show(){this.overlay.setAlpha(0),this.scene.tweens.add({targets:this.overlay,alpha:.85,duration:300})}hide(){this.scene.tweens.add({targets:this,alpha:0,duration:200,onComplete:()=>this.destroy()})}}class _s extends p.GameObjects.Container{constructor(e,t,i,s,o,n){super(e,t,i);l(this,"upgrade");l(this,"bg");l(this,"glowTween");l(this,"flashOverlay");this.upgrade=s;const r=170,c=260,h=N[s.rarity],d=e.add.graphics();d.fillStyle(h,.3),d.fillRoundedRect(-r/2-8,-c/2-8,r+16,c+16,16),this.add(d),this.glowTween=e.tweens.add({targets:d,alpha:.5,duration:800,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.bg=e.add.graphics(),this.bg.fillStyle(1973806,1),this.bg.fillRoundedRect(-r/2,-c/2,r,c,12),this.bg.lineStyle(3,h,1),this.bg.strokeRoundedRect(-r/2,-c/2,r,c,12),this.add(this.bg);const m=e.add.graphics();if(m.fillStyle(h,1),m.fillRoundedRect(-r/2,-c/2,r,6,{tl:12,tr:12,bl:0,br:0}),this.add(m),o){const b=e.add.text(r/2-10,-c/2+10,"âœ¨NEW!",{fontFamily:"Arial Black, Arial, sans-serif",fontSize:"12px",color:"#ffff00",stroke:"#000000",strokeThickness:2});b.setOrigin(1,0),this.add(b),e.tweens.add({targets:b,scaleX:1.15,scaleY:1.15,duration:500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}this.flashOverlay=e.add.graphics(),this.flashOverlay.fillStyle(16777215,1),this.flashOverlay.fillRoundedRect(-r/2,-c/2,r,c,12),this.flashOverlay.setAlpha(0),this.add(this.flashOverlay);const f=e.add.text(0,-c/2+50,s.icon,{fontSize:"48px"});f.setOrigin(.5),this.add(f);const u=e.add.text(0,-c/2+100,s.name,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#ffffff",fontStyle:"bold",align:"center",wordWrap:{width:r-20}});u.setOrigin(.5),this.add(u);const g=e.add.text(0,-c/2+125,s.rarity.toUpperCase(),{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#"+h.toString(16).padStart(6,"0"),fontStyle:"bold"});g.setOrigin(.5),this.add(g);const y=e.add.text(0,-c/2+165,s.description,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#bdc3c7",align:"center",wordWrap:{width:r-24}});if(y.setOrigin(.5,0),this.add(y),s.synergies.length>0){const b=c/2-30,T=s.synergies.slice(0,2).map(w=>K[w]).join(" â€¢ "),x=e.add.text(0,b,T,{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#"+et[s.synergies[0]].toString(16).padStart(6,"0"),align:"center"});x.setOrigin(.5),this.add(x)}this.setSize(r,c),this.setInteractive({useHandCursor:!0}),this.on("pointerover",()=>{e.tweens.add({targets:this,y:i-10,scaleX:1.05,scaleY:1.05,duration:150,ease:"Power2"})}),this.on("pointerout",()=>{e.tweens.add({targets:this,y:i,scaleX:1,scaleY:1,duration:150,ease:"Power2"})}),this.on("pointerdown",n),e.add.existing(this)}flashSelected(){this.flashOverlay&&this.scene.tweens.add({targets:this.flashOverlay,alpha:.8,duration:100,yoyo:!0,repeat:1,ease:"Quad.easeOut"})}destroy(e){this.glowTween&&this.glowTween.stop(),super.destroy(e)}}class Hs{constructor(a,e){l(this,"scene");l(this,"container");l(this,"config");l(this,"scrollY",0);l(this,"maxScrollY",0);l(this,"isDragging",!1);this.scene=a,this.config=e,this.container=a.add.container(0,0),this.container.setScrollFactor(0),this.container.setDepth(2e3),this.createOverlay(),this.setupInput()}createOverlay(){const a=this.scene.cameras.main.width,e=this.scene.cameras.main.height,t=this.scene.add.rectangle(a/2,e/2,a,e,657935,.95);this.container.add(t),this.createHeader(),this.createCharacterPanel(),this.createUpgradesPanel(),this.createSynergyPanel(),this.config.activeCurse&&this.createCursePanel();const i=this.scene.add.text(a-20,e-20,"Press TAB or ESC to close",{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#7f8c8d"});i.setOrigin(1,1),this.container.add(i)}createHeader(){const a=this.scene.cameras.main.width,e=this.scene.add.text(a/2,30,"ðŸ“‹ BUILD SCREEN",{fontFamily:"Arial Black, Arial, sans-serif",fontSize:"28px",color:"#ffffff"});e.setOrigin(.5,.5),this.container.add(e);const t=this.scene.add.text(a/2,60,`ðŸ† CUP: You ${this.config.cupPlayerPoints} â€” ${this.config.cupEnemyPoints} Enemy`,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#f39c12"});t.setOrigin(.5,.5),this.container.add(t);const i=this.scene.add.text(a/2,85,`Moment ${this.config.currentMoment} â€¢ ${this.config.objectiveText}`,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#95a5a6"});i.setOrigin(.5,.5),this.container.add(i);const s=this.scene.add.graphics();s.lineStyle(1,3426654,.5),s.lineBetween(50,105,a-50,105),this.container.add(s)}createCharacterPanel(){const i=this.scene.add.graphics();i.fillStyle(1710638,.8),i.fillRoundedRect(30,130,280,320,10),i.lineStyle(2,3447003,.5),i.strokeRoundedRect(30,130,280,320,10),this.container.add(i);const s=this.scene.add.text(30+280/2,150,this.config.character.name,{fontFamily:"Arial Black, Arial, sans-serif",fontSize:"20px",color:"#ffffff"});s.setOrigin(.5,.5),this.container.add(s);const o=this.scene.add.text(30+280/2,175,this.config.character.role.toUpperCase(),{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#95a5a6"});o.setOrigin(.5,.5),this.container.add(o);const n=this.scene.add.text(45,200,`âœ¨ ${this.config.character.trait.name}:`,{fontFamily:"Arial, sans-serif",fontSize:"13px",color:"#2ecc71"});this.container.add(n);const r=this.scene.add.text(45,218,this.config.character.trait.description,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#bdc3c7",wordWrap:{width:250}});this.container.add(r);const c=this.scene.add.text(45,250,`âš ï¸ ${this.config.character.downside.name}:`,{fontFamily:"Arial, sans-serif",fontSize:"13px",color:"#e74c3c"});this.container.add(c);const h=this.scene.add.text(45,268,this.config.character.downside.description,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#bdc3c7",wordWrap:{width:250}});this.container.add(h);const d=this.scene.add.text(30+280/2,305,"ðŸ“Š STATS",{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#f39c12"});d.setOrigin(.5,.5),this.container.add(d);const m=this.config.upgradeSystem.getFinalStats(this.config.baseStats),f=this.config.upgradeSystem.getAllModifiers(),u=["speed","stamina","control","shotPower","passPower","tackle","dodge"],g=["Speed","Stamina","Control","Shot Power","Pass Power","Tackle","Dodge"];let y=325;u.forEach((b,T)=>{this.config.baseStats[b];const x=Math.round(m[b]),w=f[b]||0,D=w>0?"#2ecc71":w<0?"#e74c3c":"#95a5a6",S=w!==0?` (${w>0?"+":""}${w}%)`:"",v=this.scene.add.text(45,y,`${g[T]}: ${x}`,{fontFamily:"Arial, sans-serif",fontSize:"13px",color:"#ecf0f1"});if(this.container.add(v),S){const R=this.scene.add.text(170,y,S,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:D});this.container.add(R)}const A=this.scene.add.graphics();A.fillStyle(2899536,1),A.fillRoundedRect(230,y+2,60,10,3),this.container.add(A);const M=this.scene.add.graphics(),P=Math.min(60,x/15*60);M.fillStyle(w>0?3066993:3447003,1),M.fillRoundedRect(230,y+2,P,10,3),this.container.add(M),y+=18})}createUpgradesPanel(){const s=this.scene.add.graphics();s.fillStyle(1710638,.8),s.fillRoundedRect(330,130,350,420,10),s.lineStyle(2,10181046,.5),s.strokeRoundedRect(330,130,350,420,10),this.container.add(s);const o=this.config.upgradeSystem.getOwnedUpgrades(),n=this.scene.add.text(330+350/2,150,`ðŸŽ´ UPGRADES (${o.length})`,{fontFamily:"Arial Black, Arial, sans-serif",fontSize:"16px",color:"#ffffff"});n.setOrigin(.5,.5),this.container.add(n);let r=180;const c=50;if(o.length===0){const h=this.scene.add.text(505,230,"No upgrades yet",{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#7f8c8d"});h.setOrigin(.5,.5),this.container.add(h)}else{const h=Math.min(o.length,7);for(let d=0;d<h;d++){const m=o[d];this.createUpgradeCard(340,r,330,c-5,m),r+=c}if(o.length>7){const d=this.scene.add.text(505,r+10,`+ ${o.length-7} more...`,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7f8c8d"});d.setOrigin(.5,.5),this.container.add(d)}}}createUpgradeCard(a,e,t,i,s){const o=N[s.rarity],n=this.config.upgradeSystem.getProcCount(s.id),r=this.scene.add.graphics();r.fillStyle(2899536,.8),r.fillRoundedRect(a,e,t,i,6),r.lineStyle(2,o,.8),r.strokeRoundedRect(a,e,t,i,6),this.container.add(r);const c=this.scene.add.text(a+25,e+i/2,s.icon,{fontFamily:"Arial, sans-serif",fontSize:"22px"});c.setOrigin(.5,.5),this.container.add(c);const h=this.scene.add.text(a+50,e+10,s.name,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#ffffff"});this.container.add(h);const d=this.scene.add.text(a+50,e+28,s.description,{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#95a5a6",wordWrap:{width:t-100}});if(this.container.add(d),n>0){const f=this.scene.add.text(a+t-15,e+i/2,`Ã—${n}`,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#f39c12"});f.setOrigin(1,.5),this.container.add(f)}const m=this.scene.add.circle(a+t-35,e+10,5,o);this.container.add(m)}createSynergyPanel(){const i=this.scene.add.graphics();i.fillStyle(1710638,.8),i.fillRoundedRect(700,130,280,200,10),i.lineStyle(2,15965202,.5),i.strokeRoundedRect(700,130,280,200,10),this.container.add(i);const s=this.scene.add.text(700+280/2,150,"âš¡ SYNERGIES",{fontFamily:"Arial Black, Arial, sans-serif",fontSize:"16px",color:"#ffffff"});s.setOrigin(.5,.5),this.container.add(s);const o=this.config.upgradeSystem.getSynergyStatuses();let n=180;if(o.length===0){const r=this.scene.add.text(840,210,"No synergies yet",{fontFamily:"Arial, sans-serif",fontSize:"13px",color:"#7f8c8d"});r.setOrigin(.5,.5),this.container.add(r)}else{const r=Math.min(o.length,5);for(let c=0;c<r;c++){const h=o[c],d=et[h.synergy]||16777215,m=h.tier>0?` T${h.tier}`:"",f=this.scene.add.graphics();for(let y=0;y<5;y++){const b=y<h.count?d:3426654;f.fillStyle(b,1),f.fillCircle(715+y*14,n+10,5)}this.container.add(f);const u=this.scene.add.text(790,n,`${h.name}${m}`,{fontFamily:"Arial, sans-serif",fontSize:"13px",color:h.active?"#ffffff":"#7f8c8d"});this.container.add(u);const g=this.scene.add.text(965,n,`${h.count}/5`,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#95a5a6"});g.setOrigin(1,0),this.container.add(g),n+=28}}this.createProcsPanel(700,350)}createProcsPanel(a,e){const i=this.scene.add.graphics();i.fillStyle(1710638,.8),i.fillRoundedRect(a,e,280,150,10),i.lineStyle(2,15158332,.5),i.strokeRoundedRect(a,e,280,150,10),this.container.add(i);const s=this.scene.add.text(a+280/2,e+20,"ðŸ”¥ TOP PROCS",{fontFamily:"Arial Black, Arial, sans-serif",fontSize:"14px",color:"#ffffff"});s.setOrigin(.5,.5),this.container.add(s);const o=this.config.upgradeSystem.getTopProcs(5);let n=e+45;if(o.length===0){const r=this.scene.add.text(a+140,e+75,"No procs yet",{fontFamily:"Arial, sans-serif",fontSize:"13px",color:"#7f8c8d"});r.setOrigin(.5,.5),this.container.add(r)}else o.forEach((r,c)=>{const h=this.scene.add.text(a+15,n,`${c+1}.`,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7f8c8d"});this.container.add(h);const d=this.scene.add.text(a+35,n,r.upgradeIcon,{fontFamily:"Arial, sans-serif",fontSize:"14px"});this.container.add(d);const m=this.scene.add.text(a+55,n,r.upgradeName,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#ecf0f1"});this.container.add(m);const f=this.scene.add.text(a+280-15,n,`Ã—${r.count}`,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#f39c12"});f.setOrigin(1,0),this.container.add(f),n+=22})}createCursePanel(){this.scene.cameras.main.width;const a=30,e=470,t=280;if(!this.config.activeCurse)return;const i=this.scene.add.graphics();i.fillStyle(2889744,.9),i.fillRoundedRect(a,e,t,100,10),i.lineStyle(2,16737792,.8),i.strokeRoundedRect(a,e,t,100,10),this.container.add(i);const s=this.scene.add.text(a+t/2,e+20,`âš¡ CURSE: ${this.config.activeCurse.name}`,{fontFamily:"Arial Black, Arial, sans-serif",fontSize:"14px",color:"#ff6600"});s.setOrigin(.5,.5),this.container.add(s);const o=this.scene.add.text(a+10,e+40,`âœ… ${this.config.activeCurse.boonDescription}`,{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#2ecc71",wordWrap:{width:t-20}});this.container.add(o);const n=this.scene.add.text(a+10,e+70,`âŒ ${this.config.activeCurse.curseDescription}`,{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#e74c3c",wordWrap:{width:t-20}});this.container.add(n)}setupInput(){var a,e;(a=this.scene.input.keyboard)==null||a.on("keydown-TAB",()=>{this.close()}),(e=this.scene.input.keyboard)==null||e.on("keydown-ESC",()=>{this.close()}),this.scene.input.on("pointerdown",t=>{})}close(){this.container.destroy(),this.config.onClose()}destroy(){this.container.destroy()}}class Us extends p.Scene{constructor(){super({key:"RunScene"});l(this,"character");l(this,"player");l(this,"ball");l(this,"teammates",[]);l(this,"enemies",[]);l(this,"enemyGoalkeeper");l(this,"playerGoalkeeper");l(this,"inputSystem");l(this,"upgradeSystem");l(this,"momentSystem");l(this,"uiSystem");l(this,"audioSystem");l(this,"aiSystem");l(this,"particleManager");l(this,"trailManager");l(this,"toastManager");l(this,"fieldWidth",1200);l(this,"fieldHeight",700);l(this,"goalWidth",40);l(this,"goalHeight",j);l(this,"leftGoalSensor");l(this,"rightGoalSensor");l(this,"leftNetZone");l(this,"rightNetZone");l(this,"leftGoalGraphics");l(this,"rightGoalGraphics");l(this,"goalCooldownUntil",0);l(this,"debugGoalSensors",!1);l(this,"goalSensorDebugGraphics");l(this,"isPaused",!1);l(this,"isTransitioning",!1);l(this,"isGoalScored",!1);l(this,"isCountingDown",!1);l(this,"momentStats",{goalsScored:0,goalsConceded:0,tacklesWon:0,tacklesLost:0,passesCompleted:0,passesAttempted:0,shotsOnTarget:0,shotsTaken:0,possessionTime:0,totalTime:0});l(this,"lastPossessionCheck",0);l(this,"gkStatusMarker");l(this,"debugDisplayEnabled",!1);l(this,"debugGraphics");l(this,"debugText");l(this,"debugDCircle",!1);l(this,"dCircleDebugGraphics");l(this,"dCircleDebugText");l(this,"tackleStats",{attempts:0,successes:0,blockedByCooldown:0,blockedByAngle:0,blockedByRange:0});l(this,"sandboxTestActive",!1);l(this,"debugAI",!1);l(this,"aiDebugLabels",[]);l(this,"aiDebugText");l(this,"aiDebugGraphics");l(this,"debugStealMoment",!1);l(this,"debugUpgrades",!1);l(this,"upgradeDebugText");l(this,"buildScreenOpen",!1);l(this,"buildScreenOverlay");l(this,"lastGoalCheckDebug",{side:"",crossed:!1,betweenPosts:!1,awarded:""});l(this,"isInitializingMoment",!1);l(this,"advantageActive",!1);l(this,"advantageExpiresAt",0)}init(e){this.character=e.character,this.resetMomentStats()}create(){this.physics.world.setBounds(0,0,this.fieldWidth,this.fieldHeight),this.initializeSystems(),this.createField(),this.createGoals(),this.createEntities(),this.setupCollisions(),this.setupEventListeners(),this.setupDebugKeys(),this.uiSystem.createGameHUD(),this.createAIDefenseMarker(),this.particleManager.init(),this.momentSystem.startRun(10);const e=this.momentSystem.getCupState();this.uiSystem.updateCupRun(e.playerPoints,e.enemyPoints,e.pointsToWin),console.log("[CUP_RUN_START] Initialized: First to 5");const t=C.getInstance();t.getStat("hasSeenTutorial")?this.time.delayedCall(500,()=>{this.startMoment()}):this.uiSystem.showFirstRunTutorial(()=>{t.incrementStat("hasSeenTutorial"),this.startMoment()}),this.cameras.main.setBounds(0,0,this.fieldWidth,this.fieldHeight),this.cameras.main.startFollow(this.player,!0,.1,.1),this.cameras.main.setZoom(1),this.cameras.main.fadeIn(300),this.input.setTopOnly(!0)}initializeSystems(){this.inputSystem=new Cs(this),this.upgradeSystem=new As(this),this.momentSystem=new Bs(this),this.uiSystem=new Is(this),this.audioSystem=new V(this),this.aiSystem=new L(this),this.particleManager=new Os(this),this.trailManager=new Ls(this),this.toastManager=new Ke(this),this.upgradeSystem.on("upgradeProc",e=>{e.intensity>=.5&&this.player&&this.showUpgradeProc(e.upgradeName)}),this.audioSystem=this.audioSystem,this.inputSystem=this.inputSystem}createAIDefenseMarker(){const e=this.add.text(this.cameras.main.width-10,10,"AI-DEFENSE v3 (tackle-enforced)",{fontFamily:"monospace",fontSize:"11px",color:"#00ff00",backgroundColor:"#000000aa",padding:{x:6,y:3}});e.setOrigin(1,0),e.setScrollFactor(0),e.setDepth(500),this.gkStatusMarker=this.add.text(this.cameras.main.width-10,28,"ENEMY GK: ...",{fontFamily:"monospace",fontSize:"11px",color:"#ffff00",backgroundColor:"#000000aa",padding:{x:6,y:3}}),this.gkStatusMarker.setOrigin(1,0),this.gkStatusMarker.setScrollFactor(0),this.gkStatusMarker.setDepth(500)}updateGKStatusMarker(){var e,t,i,s;if(this.gkStatusMarker){const o=((e=this.enemyGoalkeeper)==null?void 0:e.getDebugInfo())||{saves:0},n=((t=this.enemyGoalkeeper)==null?void 0:t.getStateString())||"N/A",r=((i=this.playerGoalkeeper)==null?void 0:i.getStateString())||"N/A",c=((s=this.playerGoalkeeper)==null?void 0:s.saveCount)||0;this.gkStatusMarker.setText(`ðŸ§¤ PLAYER GK: ON (${r}) Saves:${c}
ðŸ§¤ ENEMY GK: ON (${n}) Saves:${o.saves}`),this.gkStatusMarker.setColor("#00ff00")}}createField(){for(let t=0;t<this.fieldHeight;t+=40){const i=Math.floor(t/40)%2===0?2263842:1997598;this.add.rectangle(this.fieldWidth/2,t+20,this.fieldWidth,40,i).setDepth(0)}const e=this.add.graphics();e.lineStyle(4,16777215,.8),e.setDepth(1),e.strokeRect(20,20,this.fieldWidth-40,this.fieldHeight-40),e.beginPath(),e.moveTo(this.fieldWidth/2,20),e.lineTo(this.fieldWidth/2,this.fieldHeight-20),e.strokePath(),e.strokeCircle(this.fieldWidth/2,this.fieldHeight/2,60),e.beginPath(),e.moveTo(250,20),e.lineTo(250,this.fieldHeight-20),e.strokePath(),e.beginPath(),e.moveTo(this.fieldWidth-250,20),e.lineTo(this.fieldWidth-250,this.fieldHeight-20),e.strokePath(),e.strokeCircle(0,this.fieldHeight/2,120),e.strokeCircle(this.fieldWidth,this.fieldHeight/2,120),e.fillStyle(1727002,.5),e.fillRect(0,this.fieldHeight/2-60,20,120),e.fillRect(this.fieldWidth-20,this.fieldHeight/2-60,20,120)}createGoals(){const e=this.fieldHeight/2,t=q;this.leftGoalSensor=this.add.zone(t/2,e,t,this.goalHeight),this.physics.add.existing(this.leftGoalSensor,!0),this.leftNetZone=this.add.zone(-15,e,30,this.goalHeight+40),this.physics.add.existing(this.leftNetZone,!0),this.leftGoalGraphics=this.add.graphics(),this.drawGoal(this.leftGoalGraphics,0,e-60,!0),this.rightGoalSensor=this.add.zone(this.fieldWidth-t/2,e,t,this.goalHeight),this.physics.add.existing(this.rightGoalSensor,!0),this.rightNetZone=this.add.zone(this.fieldWidth+15,e,30,this.goalHeight+40),this.physics.add.existing(this.rightNetZone,!0),this.rightGoalGraphics=this.add.graphics(),this.drawGoal(this.rightGoalGraphics,this.fieldWidth-15,e-60,!1),this.goalSensorDebugGraphics=this.add.graphics(),this.goalSensorDebugGraphics.setDepth(100)}drawGoal(e,t,i,s){e.setDepth(2),e.fillStyle(16777215,1),e.fillRect(t,i,4,120),e.fillRect(t+11,i,4,120),e.fillRect(t,i-4,15,4),e.fillStyle(3355443,.9),e.fillRect(t,i,15,120),e.lineStyle(1,13421772,.5);for(let o=0;o<12;o++)e.beginPath(),e.moveTo(t,i+o*10),e.lineTo(t+15,i+o*10),e.strokePath();for(let o=0;o<3;o++)e.beginPath(),e.moveTo(t+o*5,i),e.lineTo(t+o*5,i+120),e.strokePath()}shakeGoalNet(e){const t=e?this.leftGoalGraphics:this.rightGoalGraphics;this.tweens.add({targets:t,x:t.x+(e?-8:8),duration:40,yoyo:!0,repeat:4,ease:"Sine.easeInOut"})}showTurnoverWonBanner(){const e=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,"ðŸ† TURNOVER WON! ðŸ†",{fontFamily:"Arial, sans-serif",fontSize:"52px",color:"#00ff00",fontStyle:"bold",stroke:"#003300",strokeThickness:8,shadow:{offsetX:3,offsetY:3,color:"#000000",blur:8,fill:!0}});e.setOrigin(.5),e.setScrollFactor(0),e.setDepth(500),e.setAlpha(0),e.setScale(.5),this.tweens.add({targets:e,alpha:1,scaleX:1.1,scaleY:1.1,duration:200,ease:"Back.easeOut",onComplete:()=>{this.tweens.add({targets:e,scaleX:1,scaleY:1,duration:100,onComplete:()=>{this.time.delayedCall(800,()=>{this.tweens.add({targets:e,alpha:0,y:e.y-50,duration:400,onComplete:()=>e.destroy()})})}})}}),this.particleManager.goalCelebration(this.cameras.main.centerX,this.cameras.main.centerY)}setupDebugKeys(){var e,t,i,s,o,n,r,c,h,d,m;(e=this.input.keyboard)==null||e.on("keydown-G",()=>{this.debugGoalSensors=!this.debugGoalSensors,this.updateGoalSensorDebug(),this.toastManager.info(this.debugGoalSensors?"Goal sensors: ON":"Goal sensors: OFF","Debug")}),(t=this.input.keyboard)==null||t.on("keydown-F1",()=>{this.debugDisplayEnabled=!this.debugDisplayEnabled,this.updateDebugDisplay(),this.toastManager.info(this.debugDisplayEnabled?"Debug display: ON":"Debug display: OFF","Debug")}),(i=this.input.keyboard)==null||i.on("keydown-F3",()=>{var f,u;if(this.debugStealMoment=!this.debugStealMoment,this.toastManager.info(this.debugStealMoment?"Steal debug: ON":"Steal debug: OFF","Debug"),this.debugStealMoment){const g=this.momentSystem.getCupState(),y=this.momentSystem.getCurrentMoment(),b=this.momentSystem.getCurrentState();console.log("=== STEAL MOMENT DEBUG ==="),console.log(`Moment: ${(y==null?void 0:y.name)||"none"} (${(y==null?void 0:y.objective)||"none"})`),console.log(`Ball owner: ${((u=(f=this.ball.owner)==null?void 0:f.constructor)==null?void 0:u.name)||"LOOSE"}`),console.log(`Ball lastPossessingTeam: ${this.ball.lastPossessingTeam}`),console.log(`Objective progress: ${(b==null?void 0:b.objectiveProgress)||0}/${(b==null?void 0:b.objectiveTarget)||1}`),console.log(`Cup: ${g.playerPoints} - ${g.enemyPoints}`),console.log(`Init moment lock: ${this.isInitializingMoment}`),console.log("========================")}}),(s=this.input.keyboard)==null||s.on("keydown-F4",()=>{this.debugDCircle=!this.debugDCircle,this.toastManager.info(this.debugDCircle?"D-circle debug: ON":"D-circle debug: OFF","Debug"),this.updateDCircleDebug()}),(o=this.input.keyboard)==null||o.on("keydown-F7",()=>{this.toggleSandboxTest()}),(n=this.input.keyboard)==null||n.on("keydown-F8",()=>{this.debugUpgrades=!this.debugUpgrades,this.toastManager.info(this.debugUpgrades?"Upgrade debug: ON":"Upgrade debug: OFF","Debug"),this.updateUpgradeDebugOverlay()}),(r=this.input.keyboard)==null||r.on("keydown-F9",()=>{this.debugAI=!this.debugAI,this.toastManager.info(this.debugAI?"AI debug: ON":"AI debug: OFF","Debug"),this.updateAIDebugOverlay()}),(c=this.input.keyboard)==null||c.on("keydown-TAB",f=>{f.preventDefault(),this.toggleBuildScreen()}),(h=this.input.keyboard)==null||h.on("keydown-ONE",()=>this.callPlay("press")),(d=this.input.keyboard)==null||d.on("keydown-TWO",()=>this.callPlay("hold")),(m=this.input.keyboard)==null||m.on("keydown-THREE",()=>this.callPlay("counter"))}toggleSandboxTest(){if(this.sandboxTestActive=!this.sandboxTestActive,this.sandboxTestActive){console.log("[SANDBOX] Activating test - placing player in D with ball");const e=this.fieldWidth-150,t=this.fieldHeight/2;this.player.setPosition(e,t),this.player.hasBall=!0,this.player.receiveBall(),this.ball.setPosition(e+20,t),this.ball.owner=this.player,this.enemies.forEach((s,o)=>{s.setPosition(300+o*50,200+o*100)}),this.toastManager.info("Sandbox: Player in D with ball","ðŸ§ª");const i=this.isPointInAttackingD("player",this.player.x,this.player.y);console.log(`[SANDBOX] Player at (${this.player.x}, ${this.player.y})`),console.log(`[SANDBOX] In attacking D: ${i}`),console.log(`[SANDBOX] Has ball: ${this.player.hasBall}`),console.log(`[SANDBOX] Can shoot: ${this.player.canShoot()}`)}else this.toastManager.info("Sandbox: Deactivated","ðŸ§ª")}updateAIDebugOverlay(){var f,u,g,y,b,T,x,w,D;if(this.aiDebugLabels.forEach(S=>S.destroy()),this.aiDebugLabels=[],this.aiDebugGraphics||(this.aiDebugGraphics=this.add.graphics(),this.aiDebugGraphics.setDepth(299)),this.aiDebugGraphics.clear(),!this.debugAI){(f=this.aiDebugText)==null||f.setVisible(!1);return}this.aiSystem.getAllDefenseAssignments(),[...this.teammates,...this.enemies].forEach((S,v)=>{const A=this.enemies.includes(S),M=this.aiSystem.getDefenseAssignment(S);let P=S.currentState||"unknown",R=A?"#ff6666":"#66ff66";if(M){switch(P=M.role,M.role){case"PRIMARY_PRESSER":R="#ff0000";break;case"SECOND_PRESSER":R="#ff8800";break;case"SHOT_BLOCKER":R="#ffff00";break;case"LAST_MAN":R="#00ffff";break;case"MARKER":R="#ff00ff";break}this.aiDebugGraphics.lineStyle(2,parseInt(R.replace("#","0x")),.5),this.aiDebugGraphics.beginPath(),this.aiDebugGraphics.moveTo(S.x,S.y),this.aiDebugGraphics.lineTo(M.target.x,M.target.y),this.aiDebugGraphics.strokePath(),this.aiDebugGraphics.fillStyle(parseInt(R.replace("#","0x")),.3),this.aiDebugGraphics.fillCircle(M.target.x,M.target.y,10),M.inCommitMode&&(P+=" [COMMIT]")}const B=this.add.text(S.x,S.y-45,P,{fontFamily:"monospace",fontSize:"10px",color:R,backgroundColor:"#000000cc",padding:{x:3,y:2},align:"center",fontStyle:"bold"});B.setOrigin(.5),B.setDepth(300),this.aiDebugLabels.push(B)}),[...this.teammates,...this.enemies].forEach(S=>{const v=this.aiSystem.getDefenseAssignment(S);if((v==null?void 0:v.role)==="LAST_MAN"){this.aiDebugGraphics.lineStyle(3,65535,.8),this.aiDebugGraphics.strokeCircle(S.x,S.y,30);const A=this.enemies.includes(S),M=A?30:this.fieldWidth-30;this.aiDebugGraphics.lineStyle(2,65535,.3),this.aiDebugGraphics.beginPath(),this.aiDebugGraphics.arc(M,this.fieldHeight/2,100,-Math.PI/2,Math.PI/2,!A),this.aiDebugGraphics.strokePath()}}),this.aiDebugText||(this.aiDebugText=this.add.text(10,200,"",{fontFamily:"monospace",fontSize:"10px",color:"#ffff00",backgroundColor:"#000000cc",padding:{x:6,y:4}}),this.aiDebugText.setScrollFactor(0),this.aiDebugText.setDepth(500));const e=this.ball.owner,t=e?this.enemies.includes(e)?"ENEMY":e===this.player?"PLAYER":"TEAMMATE":"LOOSE",i=this.momentSystem.getObjectiveDescriptor(),s=this.aiSystem.getActivePlay();let o=null,n=1/0;this.enemies.forEach(S=>{const v=this.aiSystem.getDefenseAssignment(S);(v==null?void 0:v.role)==="PRIMARY_PRESSER"&&(o=S,n=p.Math.Distance.Between(S.x,S.y,this.player.x,this.player.y))}),o&&(this.aiDebugGraphics.lineStyle(2,16711680,.6),this.aiDebugGraphics.strokeCircle(o.x,o.y,Y),this.aiDebugGraphics.lineStyle(1,16737792,.4),this.aiDebugGraphics.strokeCircle(o.x,o.y,Y*je));const r=((u=this.enemyGoalkeeper)==null?void 0:u.getDebugInfo())||{saves:0,lunges:0},c=((g=this.enemyGoalkeeper)==null?void 0:g.getStateString())||"N/A",h=((y=this.playerGoalkeeper)==null?void 0:y.getStateString())||"N/A",d=((b=this.playerGoalkeeper)==null?void 0:b.saveCount)||0;if(this.enemyGoalkeeper){const S=this.enemyGoalkeeper.getGKBox();this.aiDebugGraphics.lineStyle(2,65535,.6),this.aiDebugGraphics.strokeRect(S.minX,S.minY,S.maxX-S.minX,S.maxY-S.minY),this.aiDebugGraphics.fillStyle(65535,.1),this.aiDebugGraphics.fillRect(S.minX,S.minY,S.maxX-S.minX,S.maxY-S.minY),this.aiDebugGraphics.lineStyle(2,16750848,.8),this.aiDebugGraphics.strokeCircle(this.enemyGoalkeeper.x,this.enemyGoalkeeper.y,32);const v=this.add.text(S.minX+5,S.minY-15,"ENEMY GK_BOX",{fontFamily:"monospace",fontSize:"10px",color:"#00ffff"});v.setDepth(300),this.aiDebugLabels.push(v)}if(this.playerGoalkeeper){const S=this.playerGoalkeeper.getGKBox();this.aiDebugGraphics.lineStyle(2,3447003,.6),this.aiDebugGraphics.strokeRect(S.minX,S.topY,S.maxX-S.minX,S.bottomY-S.topY),this.aiDebugGraphics.fillStyle(3447003,.1),this.aiDebugGraphics.fillRect(S.minX,S.topY,S.maxX-S.minX,S.bottomY-S.topY),this.aiDebugGraphics.lineStyle(2,3447003,.8),this.aiDebugGraphics.strokeCircle(this.playerGoalkeeper.x,this.playerGoalkeeper.y,32);const v=this.add.text(S.maxX-80,S.topY-15,"PLAYER GK_BOX",{fontFamily:"monospace",fontSize:"10px",color:"#3498db"});v.setDepth(300),this.aiDebugLabels.push(v)}const m=["=== AI-DEFENSE v3 (tackle-enforced) ===",`Ball: ${t}`,`Objective: ${i.type}`,`Active Play: ${s||"none"}`,"","--- TACKLE STATS ---",`Attempts: ${this.aiSystem.getTackleStats().attempts}`,`Successes: ${this.aiSystem.getTackleStats().successes}`,`Blocked (CD): ${this.aiSystem.getTackleStats().blockedByCooldown}`,`Blocked (Angle): ${this.aiSystem.getTackleStats().blockedByAngle}`,`Blocked (Range): ${this.aiSystem.getTackleStats().blockedByRange}`,"","--- PRIMARY PRESSER ---",o?`Dist: ${Math.round(n)}px`:"None assigned",o?`Range: ${Y}px`:"",o?`CD: ${Wt}ms`:"","","--- PLAYER GOALKEEPER (Left) ---",`State: ${h}`,`Saves: ${d}`,`Position: (${Math.round(((T=this.playerGoalkeeper)==null?void 0:T.x)||0)}, ${Math.round(((x=this.playerGoalkeeper)==null?void 0:x.y)||0)})`,"","--- ENEMY GOALKEEPER (Right) ---",`State: ${c}`,`Saves: ${r.saves}`,`Lunges: ${r.lunges}`,`Position: (${Math.round(((w=this.enemyGoalkeeper)==null?void 0:w.x)||0)}, ${Math.round(((D=this.enemyGoalkeeper)==null?void 0:D.y)||0)})`,"","--- ENEMIES ---",...this.enemies.slice(0,3).map((S,v)=>{const A=S.currentState||"unknown",M=p.Math.Distance.Between(S.x,S.y,this.player.x,this.player.y);return`  ${v}: ${A} (${Math.round(M)}px)`})];this.aiDebugText.setText(m.join(`
`)),this.aiDebugText.setVisible(!0)}updateDCircleDebug(){var r;if(this.dCircleDebugGraphics||(this.dCircleDebugGraphics=this.add.graphics(),this.dCircleDebugGraphics.setDepth(98)),this.dCircleDebugGraphics.clear(),!this.debugDCircle){(r=this.dCircleDebugText)==null||r.setVisible(!1);return}const e=H,t=this.fieldHeight/2;this.dCircleDebugGraphics.lineStyle(3,65280,.6),this.dCircleDebugGraphics.beginPath(),this.dCircleDebugGraphics.arc(30,t,e,-Math.PI/2,Math.PI/2,!1),this.dCircleDebugGraphics.strokePath(),this.dCircleDebugGraphics.lineStyle(3,16711680,.6),this.dCircleDebugGraphics.beginPath(),this.dCircleDebugGraphics.arc(this.fieldWidth-30,t,e,Math.PI/2,-Math.PI/2,!1),this.dCircleDebugGraphics.strokePath(),this.dCircleDebugGraphics.fillStyle(65280,.15),this.dCircleDebugGraphics.beginPath(),this.dCircleDebugGraphics.arc(this.fieldWidth-30,t,e,Math.PI/2,-Math.PI/2,!1),this.dCircleDebugGraphics.fillPath();const i=this.isPointInAttackingD("player",this.player.x,this.player.y);i&&(this.dCircleDebugGraphics.lineStyle(4,65280,1),this.dCircleDebugGraphics.strokeCircle(this.player.x,this.player.y,25)),this.dCircleDebugText||(this.dCircleDebugText=this.add.text(10,this.cameras.main.height-100,"",{fontFamily:"monospace",fontSize:"12px",color:"#00ffff",backgroundColor:"#000000cc",padding:{x:8,y:6}}),this.dCircleDebugText.setScrollFactor(0),this.dCircleDebugText.setDepth(500));const s=this.ball.getTouchDebugInfo(),o=this.ball.isLastTouchInDRecent(),n=["=== D-CIRCLE DEBUG (F4) ===",`Player In Attacking D: ${i?"YES âœ“":"NO âœ—"}`,`D Radius: ${e}px`,"","--- LAST TOUCH IN D (GOAL VALIDATION) ---",`Team: ${s.team}`,`Kind: ${s.kind}`,`Ms Ago: ${Math.round(s.msAgo)}`,`Recent (<4s): ${o?"YES âœ“":"NO âœ—"}`,`Position: (${Math.round(s.x)}, ${Math.round(s.y)})`,"","--- LEGACY SHOT INFO ---",`Shot Team: ${this.ball.lastShotTeam}`,`Shot In D: ${this.ball.lastShotFromInsideD?"YES":"NO"}`,"","--- GOAL RULES ---","Require D: YES",`Window: ${pe}ms`];this.dCircleDebugText.setText(n.join(`
`)),this.dCircleDebugText.setVisible(!0)}updateUpgradeDebugOverlay(){var m;if(!this.debugUpgrades){(m=this.upgradeDebugText)==null||m.setVisible(!1);return}this.upgradeDebugText||(this.upgradeDebugText=this.add.text(this.cameras.main.width-10,80,"",{fontFamily:"monospace",fontSize:"10px",color:"#00ff00",backgroundColor:"#000000cc",padding:{x:8,y:6}}),this.upgradeDebugText.setOrigin(1,0),this.upgradeDebugText.setScrollFactor(0),this.upgradeDebugText.setDepth(500));const e=this.upgradeSystem.getOwnedUpgrades(),t=this.momentSystem.getCupState(),i=this.uiSystem.getActiveCurseName(),s=this.upgradeSystem.getDebugInfo(),o=this.upgradeSystem.getTopProcs(5),n=s.modifiers,r=this.player.hasBall,c=this.isPointInAttackingD("player",this.player.x,this.player.y),h=this.player.canShoot(),d=["=== UPGRADE DEBUG (F8) ===","","--- PLAYER STATE ---",`Has Ball: ${r}`,`In Attacking D: ${c}`,`Can Shoot: ${h}`,"","--- HEALTH / STAMINA ---",`Health: ${Math.ceil(this.player.health)}/${this.player.maxHealth}`,`Stamina: ${Math.ceil(this.player.stamina)}/${this.player.maxStamina}`,`Can Dash: ${this.player.canDash}`,`Last Damage: ${this.player.lastDamageAmount} (${Math.round((this.time.now-this.player.lastDamageTime)/1e3)}s ago)`,"","--- UPGRADES ---",`Active: ${e.length}`,...e.slice(0,6).map(f=>`  â€¢ ${f.name}`),e.length>6?`  ... +${e.length-6} more`:"","","--- EVENT STATS/SEC ---",`tick: ${s.eventStats.tick} | shot: ${s.eventStats.shot}`,`pass: ${s.eventStats.pass} | tackle: ${s.eventStats.tackle}`,`steal: ${s.eventStats.steal} | receive: ${s.eventStats.receive}`,"","--- HOOKS REGISTERED ---",...Object.entries(s.hookCounts).filter(([f,u])=>u>0).map(([f,u])=>`  ${f}: ${u}`),"","--- RECENT PROCS ---",...s.recentProcs.slice(0,5).map(f=>`  ${f.upgradeName}`),s.recentProcs.length===0?"  (none)":"","","--- TOP PROCS ---",...o.map(f=>`  ${f.upgradeName}: ${f.count}x`),o.length===0?"  (none)":"","","--- STAT MODIFIERS ---",...Object.entries(n).slice(0,6).map(([f,u])=>`  ${f}: +${u}%`),Object.keys(n).length===0?"  (none)":"","","--- CUP RUN ---",`You ${t.playerPoints} - ${t.enemyPoints} Enemy`,`Curse: ${i||"none"}`];this.upgradeDebugText.setText(d.filter(f=>f).join(`
`)),this.upgradeDebugText.setVisible(!0)}toggleBuildScreen(){this.buildScreenOpen?this.closeBuildScreen():this.openBuildScreen()}openBuildScreen(){if(this.buildScreenOpen)return;this.buildScreenOpen=!0,this.physics.pause();const e=this.momentSystem.getCupState(),t=this.momentSystem.getCurrentMoment(),i=this.momentSystem.getProgress(),s=this.uiSystem.getActiveCurseName();s&&e.activeCurseId&&Te(async()=>{const{getCurseById:o}=await import("./curses-5gb34V15.js");return{getCurseById:o}},[]).then(({getCurseById:o})=>{const n=o(e.activeCurseId);n&&(n.name,n.boonDescription,n.curseDescription)}),this.buildScreenOverlay=new Hs(this,{upgradeSystem:this.upgradeSystem,character:this.character,baseStats:this.character.stats,cupPlayerPoints:e.playerPoints,cupEnemyPoints:e.enemyPoints,currentMoment:i.current,objectiveText:(t==null?void 0:t.description)||"Score!",activeCurse:s?{name:s,boonDescription:"Active curse effect",curseDescription:"Curse penalty active"}:null,onClose:()=>this.closeBuildScreen()})}closeBuildScreen(){var e;this.buildScreenOpen&&(this.buildScreenOpen=!1,(e=this.buildScreenOverlay)==null||e.destroy(),this.buildScreenOverlay=null,this.physics.resume())}callPlay(e){if(this.buildScreenOpen)return;if(this.upgradeSystem.callPlay(e))this.showPlayCalledBanner(e),this.audioSystem.playUpgrade(),this.applyPlayToAI(e),this.uiSystem.showPlayActive(e,8e3);else{const i=this.upgradeSystem.getActivePlay(),s=Math.ceil(i.cooldownRemaining/1e3);this.toastManager.info(`Play on cooldown: ${s}s`,"â³")}}showPlayCalledBanner(e){const t={press:"ðŸƒ PRESS!",hold:"ðŸ›¡ï¸ HOLD!",counter:"âš¡ COUNTER!"},i=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY-100,t[e]||e.toUpperCase(),{fontFamily:"Arial Black, Arial, sans-serif",fontSize:"48px",color:"#ffffff",stroke:"#000000",strokeThickness:4});i.setOrigin(.5,.5),i.setScrollFactor(0),i.setDepth(500),i.setScale(0),this.tweens.add({targets:i,scale:1,duration:200,ease:"Back.easeOut",onComplete:()=>{this.time.delayedCall(800,()=>{this.tweens.add({targets:i,alpha:0,y:i.y-50,duration:400,onComplete:()=>i.destroy()})})}})}applyPlayToAI(e){this.events.emit("playCallChanged",e),this.aiSystem.setActivePlay(e),console.log(`[PLAY] ${e.toUpperCase()} called`)}updateActiveBuffsUI(){const e=this.upgradeSystem.getActiveBuffs(),t=this.time.now,i=e.map(s=>({id:s.id,name:s.name,icon:s.icon,timeRemaining:s.expiresAt-t,source:s.source}));this.uiSystem.updateActiveBuffs(i)}updateDebugDisplay(){var d,m,f,u;if(!this.debugDisplayEnabled){(d=this.debugGraphics)==null||d.clear(),(m=this.debugText)==null||m.setVisible(!1);return}this.debugGraphics||(this.debugGraphics=this.add.graphics(),this.debugGraphics.setDepth(200)),this.debugText||(this.debugText=this.add.text(10,140,"",{fontFamily:"monospace",fontSize:"12px",color:"#00ff00",backgroundColor:"#000000aa",padding:{x:6,y:4}}),this.debugText.setScrollFactor(0),this.debugText.setDepth(200)),this.debugText.setVisible(!0);const e=this.momentSystem.getObjectiveDescriptor();this.player.hasBall||this.teammates.some(g=>g.hasBall)||this.enemies.some(g=>g.hasBall);const t=this.momentSystem.getCurrentState(),i=this.momentSystem.getCurrentMoment(),s=(t==null?void 0:t.objectiveProgress)??0,o=(t==null?void 0:t.objectiveTarget)??1,n=(t==null?void 0:t.isComplete)??!1,r=this.ball.lastPossessingTeam;let c="LOOSE";this.ball.owner===this.player?c="PLAYER":this.teammates.includes(this.ball.owner)?c=`TEAMMATE (${((f=this.ball.owner)==null?void 0:f.role)||"?"})`:this.enemies.includes(this.ball.owner)&&(c=`ENEMY (${((u=this.ball.owner)==null?void 0:u.role)||"?"})`);const h=["=== DEBUG (F1 to hide) ===",`Ball Owner: ${c}`,`Ball isLoose: ${this.ball.isLoose}`,`Last Poss Team: ${r}`,`Init Moment: ${this.isInitializingMoment}`,"",`Objective: ${(i==null?void 0:i.objective)||e.type}`,`Progress: ${s}/${o}`,`Complete: ${n?"YES":"no"}`,`Time: ${e.timeRemaining}s`,"",`Player: ${this.player.hasBall?"HAS BALL":"no ball"}`,`  Calling: ${this.player.isCallingForPass?"YES":"no"}`,`  Stunned: ${this.player.isStunned}`,"",`Ball speed: ${Math.floor(this.ball.getSpeed())}`];if(this.debugText.setText(h.join(`
`)),this.debugGraphics.clear(),this.player.isCallingForPass){this.debugGraphics.lineStyle(2,65280,1),this.debugGraphics.strokeCircle(this.player.x,this.player.y,35);const g=this.add.text(this.player.x,this.player.y-45,"CALLING!",{fontFamily:"Arial",fontSize:"14px",color:"#00ff00",fontStyle:"bold"});g.setOrigin(.5),g.setDepth(201),this.time.delayedCall(100,()=>g.destroy())}}showPassDebugLine(e,t){if(!this.debugDisplayEnabled)return;const i=this.add.graphics();i.setDepth(150),i.lineStyle(3,65280,.8),i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(t.x,t.y),i.strokePath();const s=Math.atan2(t.y-e.y,t.x-e.x),o=12;i.fillStyle(65280,.8),i.fillTriangle(t.x,t.y,t.x-Math.cos(s-.4)*o,t.y-Math.sin(s-.4)*o,t.x-Math.cos(s+.4)*o,t.y-Math.sin(s+.4)*o),this.tweens.add({targets:i,alpha:0,duration:600,onComplete:()=>i.destroy()})}updateGoalSensorDebug(){if(this.goalSensorDebugGraphics&&(this.goalSensorDebugGraphics.clear(),this.debugGoalSensors)){const e=this.fieldHeight/2,t=q;this.goalSensorDebugGraphics.lineStyle(3,65280,1),this.goalSensorDebugGraphics.strokeRect(0,e-this.goalHeight/2,t,this.goalHeight),this.goalSensorDebugGraphics.strokeRect(this.fieldWidth-t,e-this.goalHeight/2,t,this.goalHeight),this.goalSensorDebugGraphics.fillStyle(65280,1)}}createEntities(){this.player=new Ss(this,200,this.fieldHeight/2,this.character),this.player.setUpgradeSystem(this.upgradeSystem),this.player.onShoot=(e,t)=>{this.audioSystem.playShoot();const i=this.isPointInAttackingD("player",this.player.x,this.player.y);this.ball.recordShotOrigin(this.player.x,this.player.y,"player",i),this.ball.registerTouch("player","player",this.player.x,this.player.y,"shot",i);const s={x:Math.cos(t),y:Math.sin(t)};this.ball.kick(s,e,Ze*(Math.random()-.5),"shot"),this.ball.lastShooter=this.player,this.ball.lastOwner=this.player,this.ball.isLoose=!0,this.ball.owner=null,this.ball.setLastPossessingTeam("player"),this.momentStats.shotsTaken++,Math.cos(t)>.3&&this.momentStats.shotsOnTarget++},this.player.onPass=(e,t,i)=>{this.audioSystem.playPass();let s=null,o=-1/0;for(const n of this.teammates){const r=n.x-this.player.x,c=n.y-this.player.y,h=Math.sqrt(r*r+c*c);if(h<50||h>400)continue;const d=Math.atan2(c,r),m=Math.abs(p.Math.Angle.Wrap(d-e));if(m<Math.PI/6){const f=100-m*50-h*.1;f>o&&(o=f,s=n)}}this.ball.pass(t,e,this.player,s),this.ball.setLastPossessingTeam("player"),this.momentStats.passesAttempted++,this.debugDisplayEnabled&&s&&this.showPassDebugLine(this.player,s)},this.player.onTackle=()=>{this.audioSystem.playTackle(),this.attemptTackle(this.player)},this.player.onDodge=()=>{this.audioSystem.playDodge(),this.particleManager.dodgeEffect(this.player.x,this.player.y,this.player.getFacingAngle())},this.player.onShootFailed=()=>{this.uiSystem.showNoPossessionFeedback(),this.audioSystem.playClick()},this.ball=new ks(this,this.fieldWidth/2,this.fieldHeight/2),this.createTeammates(3),this.createEnemies(3),this.createEnemyGoalkeeper(),this.updateEntityReferences()}createEnemyGoalkeeper(){var e,t;(e=this.enemyGoalkeeper)==null||e.destroy(),(t=this.playerGoalkeeper)==null||t.destroy(),this.enemyGoalkeeper=new xs(this,this.fieldWidth,this.fieldHeight),this.enemyGoalkeeper.setBall(this.ball),this.physics.add.overlap(this.enemyGoalkeeper,this.ball,()=>{this.ball.isLoose&&this.ball.getSpeed()>80&&this.enemyGoalkeeper.onBallContact(this.ball)}),console.log("[GK] Enemy goalkeeper created"),this.playerGoalkeeper=new ws(this,this.fieldWidth,this.fieldHeight,"player"),this.playerGoalkeeper.setBall(this.ball),this.physics.add.overlap(this.playerGoalkeeper,this.ball,()=>{this.ball.isLoose&&this.ball.getSpeed()>80&&this.playerGoalkeeper.onBallContact(this.ball)}),console.log("[GK] Player goalkeeper created")}createTeammates(e){this.teammates.forEach(n=>n.destroy()),this.teammates=[];const t=["defender","midfielder","forward"],i=this.fieldWidth/2,s=this.fieldHeight/2,o=[{x:i-250,y:s-120},{x:i-180,y:s+80},{x:i-100,y:s-40}];for(let n=0;n<Math.min(e,3);n++){const r=new bs(this,o[n].x,o[n].y,t[n],this.getColorIndex(this.character.color),this.aiSystem);r.onShoot=(c,h)=>{const d=this.isPointInAttackingD("player",r.x,r.y);this.ball.recordShotOrigin(r.x,r.y,"player",d),this.ball.registerTouch("player",`teammate_${n}`,r.x,r.y,"shot",d);const m={x:Math.cos(h),y:Math.sin(h)};this.ball.kick(m,c,0,"shot"),this.ball.lastShooter=r,this.ball.lastOwner=r,this.ball.isLoose=!0,this.ball.owner=null,this.ball.setLastPossessingTeam("player")},r.onPass=(c,h)=>{this.audioSystem.playPass();const d=fe+5*me;this.ball.pass(d,c,r,h),this.ball.setLastPossessingTeam("player"),this.debugDisplayEnabled&&h&&this.showPassDebugLine(r,h)},r.onTackle=c=>{this.attemptTackle(r,c)},this.teammates.push(r)}}createEnemies(e,t=!1){this.enemies.forEach(h=>h.destroy()),this.enemies=[];const i=["defender","midfielder","forward"],s=this.fieldWidth/2,o=this.fieldHeight/2,n=[{x:s+250,y:o},{x:s+180,y:o-100},{x:s+100,y:o+60},{x:s+220,y:o+120},{x:s+150,y:o-50}],r=this.momentSystem.getCurrentMoment(),c=r?(r.difficulty-1)/4:.5;for(let h=0;h<Math.min(e,5);h++){const d=t&&h===0,m=new Ts(this,n[h].x,n[h].y,i[h%3],d?"boss":"normal",c,this.aiSystem);m.onShoot=(f,u)=>{const g=this.isPointInAttackingD("enemy",m.x,m.y);this.ball.recordShotOrigin(m.x,m.y,"enemy",g),this.ball.registerTouch("enemy",`enemy_${h}`,m.x,m.y,"shot",g);const y={x:Math.cos(u),y:Math.sin(u)};this.ball.kick(y,f,0,"shot"),this.ball.lastShooter=m,this.ball.lastOwner=m,this.ball.isLoose=!0,this.ball.owner=null,this.ball.setLastPossessingTeam("enemy")},m.onPass=(f,u)=>{this.audioSystem.playPass();const g=fe+4*me;this.ball.pass(g,f,m,u),this.ball.setLastPossessingTeam("enemy"),this.debugDisplayEnabled&&u&&this.showPassDebugLine(m,u)},m.onTackle=f=>{this.attemptTackle(m,f)},this.enemies.push(m)}}updateEntityReferences(){this.teammates.forEach(e=>{e.setReferences(this.player,this.teammates,this.enemies,this.ball)}),this.enemies.forEach(e=>{e.setReferences(this.player,this.teammates,this.enemies,this.ball)}),this.aiSystem.assignDefenders(this.teammates,this.enemies)}getColorIndex(e){const i=[3447003,15158332,3066993,10181046,15965202,1752220,15105570,9323693,15844367,1482885,12597547,2600544,13849600,2719929,9109504,48340,6765239,16733986,3426654,15277667].indexOf(e);return i>=0?i:0}setupCollisions(){this.physics.add.overlap(this.player,this.ball,()=>{if(!this.isInitializingMoment&&this.ball.isLoose&&!this.player.hasBall&&!this.player.isStunned){if(!this.ball.canBePickedUpBy(this.player))return;const e=this.ball.attachTo(this.player);this.player.receiveBall();const t=this.ball.intendedReceiver===this.player,i=this.ball.wasStolen(e,"player"),s=i?"intercept":t?"receive":"dribble",o=this.isPointInAttackingD("player",this.player.x,this.player.y);this.ball.registerTouch("player","player",this.player.x,this.player.y,s,o),i&&(console.log("[STEAL] Player intercepted ball from enemy"),this.momentSystem.playerStole()),t&&this.momentStats.passesCompleted++}}),this.teammates.forEach((e,t)=>{this.physics.add.overlap(e,this.ball,()=>{if(!this.isInitializingMoment&&this.ball.isLoose&&!e.hasBall&&!e.isStunned){if(!this.ball.canBePickedUpBy(e))return;const i=this.ball.attachTo(e);e.receiveBall();const s=this.ball.intendedReceiver===e,o=this.ball.wasStolen(i,"player"),n=o?"intercept":s?"receive":"dribble",r=this.isPointInAttackingD("player",e.x,e.y);this.ball.registerTouch("player",`teammate_${t}`,e.x,e.y,n,r),o&&(console.log("[STEAL] Teammate intercepted ball from enemy"),this.momentSystem.playerStole()),s&&this.momentStats.passesCompleted++}})}),this.enemies.forEach((e,t)=>{this.physics.add.overlap(e,this.ball,()=>{if(!this.isInitializingMoment&&this.ball.isLoose&&!e.hasBall&&!e.isStunned){if(!this.ball.canBePickedUpBy(e))return;this.ball.attachTo(e),e.receiveBall();const s=this.ball.intendedReceiver===e?"receive":"dribble",o=this.isPointInAttackingD("enemy",e.x,e.y);this.ball.registerTouch("enemy",`enemy_${t}`,e.x,e.y,s,o)}})}),this.physics.add.overlap(this.ball,this.rightGoalSensor,()=>{this.checkGoal(!0)}),this.physics.add.overlap(this.ball,this.leftGoalSensor,()=>{this.checkGoal(!1)}),this.physics.add.overlap(this.ball,this.rightNetZone,()=>{!this.isGoalScored&&this.ball.isLoose&&this.bounceFromNet(!1)}),this.physics.add.overlap(this.ball,this.leftNetZone,()=>{!this.isGoalScored&&this.ball.isLoose&&this.bounceFromNet(!0)})}checkGoal(e){if(this.isGoalScored||this.isTransitioning||this.time.now<this.goalCooldownUntil||!this.ball.isLoose)return;const t=4,i=this.fieldHeight/2,s=this.goalHeight/2,o=this.ball.x,n=this.ball.y,r=i-s-t,c=i+s+t,h=n>=r&&n<=c;if(!h)return;const d=this.fieldWidth-q,m=q;let f=!1;if(e?f=o>=d-t||this.ball.crossedLine(d,"right"):f=o<=m+t||this.ball.crossedLine(m,"left"),this.lastGoalCheckDebug={side:e?"RIGHT":"LEFT",crossed:f,betweenPosts:h,awarded:""},!f)return;const u=this.ball.getSpeed();if(u<ts*.5)return;const g=this.momentSystem.getCurrentMoment(),b=!g||["score","multiGoal","reboundGoal","assist","giveAndGo","penaltyCorner","pc_score","pcBattle"].includes(g.objective),T=e?"player":"enemy",x=this.ball.getTouchDebugInfo(),w=x.msAgo,D=this.ball.lastTouchInDTeam,S=this.ball.isLastTouchInDRecent();if(console.log(`[GOALCHECK] side=${e?"RIGHT":"LEFT"} crossed=${f} betweenPosts=${h} ballX=${Math.round(o)} ballY=${Math.round(n)}`),console.log(`[GOALCHECK] touchTeam=${D} scoringTeam=${T} touchRecent=${S} speed=${Math.round(u)}`),b&&!(D===T&&S)){console.log(`[GOALCHECK] REJECTED - must touch inside D. touchTeam=${D} needed=${T}`),this.lastGoalCheckDebug.awarded="REJECTED_NO_D_TOUCH",this.showNoGoalFeedback(e,x.kind,w);return}const v=e?"PLAYER":"ENEMY";console.log(`[GOALCHECK] => GOAL AWARDED: ${v}`),this.lastGoalCheckDebug.awarded=v,this.goalCooldownUntil=this.time.now+_e,this.scoreGoal(e)}showNoGoalFeedback(e,t="none",i=0){console.log(`[NO_GOAL] Must touch inside the D. Last touch: ${t}, ${Math.round(i)}ms ago`),this.audioSystem.playWhistle();const s=this.add.text(this.ball.x,this.ball.y-30,`NO GOAL
Must touch inside the D`,{fontFamily:"Arial Black, Arial, sans-serif",fontSize:"22px",color:"#ff4444",align:"center",stroke:"#000000",strokeThickness:4});s.setOrigin(.5),s.setDepth(200),this.tweens.add({targets:s,y:s.y-60,alpha:0,duration:1500,ease:"Quad.easeOut",onComplete:()=>s.destroy()}),this.goalCooldownUntil=this.time.now+800,this.time.delayedCall(500,()=>{this.isGoalScored||(this.ball.resetToCenter(),this.ball.setPosition(this.fieldWidth/2,this.fieldHeight/2))})}bounceFromNet(e){const t=this.ball.body.velocity,i=e?Math.abs(t.x)*oe:-Math.abs(t.x)*oe,s=t.y*oe;this.ball.setVelocity(i,s),this.shakeGoalNet(e)}setupEventListeners(){this.momentSystem.on("momentStarted",e=>{this.toastManager.info(`${e.moment.name}`,e.moment.description)}),this.momentSystem.on("momentComplete",e=>{this.handleMomentComplete(e)}),this.momentSystem.on("objectiveProgress",e=>{(e.objective==="turnover"||e.objective==="pressWin")&&(e.progress>=e.target?(this.showTurnoverWonBanner(),this.audioSystem.playGoal(),this.cameras.main.shake(250,.015),this.time.timeScale=.2,this.time.delayedCall(150,()=>{this.time.timeScale=1})):(this.toastManager.success(`Steal! ${e.progress}/${e.target}`),this.audioSystem.playSteal()))}),this.momentSystem.on("timerTick",e=>{const t=this.momentSystem.getCurrentState();if(t){const i=this.momentSystem.getProgress();this.uiSystem.updateFromMomentState(t,i.current,i.total);const s=this.momentSystem.getCupState();this.uiSystem.updateCupRun(s.playerPoints,s.enemyPoints,s.pointsToWin)}}),this.momentSystem.on("timerWarning",e=>{this.audioSystem.playTimer()}),this.momentSystem.on("runComplete",e=>{this.endRun(e)}),this.upgradeSystem.on("upgradeProc",e=>{const t={id:e.upgradeId,name:e.upgradeName};this.uiSystem.showUpgradeProc(t,e.intensity);const i=this.getUpgradeIcon(e.upgradeId)||"âš¡";e.intensity>=.5&&this.uiSystem.showProcIcon(i,e.upgradeName,this.player),console.log(`[UPGRADE_PROC] ${e.upgradeName} (intensity: ${e.intensity})`)}),this.upgradeSystem.on("upgradeAdded",e=>{this.uiSystem.addUpgradeIcon(e.icon,e.name,e.rarity)}),this.upgradeSystem.on("synergyActivated",e=>{this.uiSystem.showSynergyActivated(e.name,e.tier),this.audioSystem.playUpgrade(),this.toastManager.success(`${e.name} T${e.tier} activated!`,"âš¡")}),this.upgradeSystem.on("giveAndGoActivated",e=>{this.uiSystem.showGiveAndGo(),this.toastManager.success("Give & Go!","ðŸ”„")}),this.upgradeSystem.on("playCalled",e=>{this.uiSystem.showPlayActive(e.play,e.duration)}),this.upgradeSystem.on("autoShot",e=>{if(console.log("[AUTO_SHOT] Event received:",e),this.player.hasBall&&this.player.canShoot()){const t=this.fieldWidth-20,i=this.fieldHeight/2+(Math.random()-.5)*60,s=Math.atan2(i-this.player.y,t-this.player.x);this.player.tryShoot(s,.3)&&(console.log("[AUTO_SHOT] Shot executed!"),this.toastManager.success("Auto Hit!","ðŸŽ¯"))}}),this.upgradeSystem.on("cooldownReset",e=>{console.log(`[COOLDOWN_RESET] ${e}`)}),this.upgradeSystem.on("allCooldownsReset",()=>{console.log("[COOLDOWN_RESET] All cooldowns!")})}startMoment(){this.isTransitioning=!1,this.isGoalScored=!1,this.goalCooldownUntil=0,this.isInitializingMoment=!0,this.resetMomentStats(),this.resetPlayerHealth();const e=this.momentSystem.getCurrentMoment();if(!e)return;const t=e.objective==="defend"||e.objective==="survive"||e.objective==="turnover"||e.objective==="pressWin";if(this.resetToKickoffPositions(t),this.createTeammates(e.teamSize.player-1),this.createEnemies(e.teamSize.enemy,e.isBoss),this.createEnemyGoalkeeper(),this.updateEntityReferences(),this.setupCollisions(),e.modifiers.forEach(s=>{s.effect==="reducedControl"&&(this.player.stats.control*=.8)}),this.momentSystem.startMoment(),this.upgradeSystem.resetMoment(),t&&this.enemies.length>0){const s=this.enemies.find(o=>o.role==="midfielder"||o.role==="forward")||this.enemies[0];this.player.hasBall=!1,this.teammates.forEach(o=>o.hasBall=!1),this.enemies.forEach(o=>o.hasBall=!1),this.ball.attachTo(s),s.receiveBall(),this.ball.setLastPossessingTeam("enemy"),this.ball.setPosition(s.x+15,s.y),console.log(`[MOMENT] ${e.objective}: Enemy ${s.role} starts with ball at (${s.x}, ${s.y})`),(this.player.hasBall||this.teammates.some(o=>o.hasBall))&&(console.warn("[MOMENT] WARNING: Player team has ball when enemy should! Force-correcting..."),this.player.hasBall=!1,this.teammates.forEach(o=>o.hasBall=!1))}else this.player.hasBall=!1,this.teammates.forEach(s=>s.hasBall=!1),this.enemies.forEach(s=>s.hasBall=!1),this.ball.attachTo(this.player),this.player.receiveBall(),this.ball.setLastPossessingTeam("player"),console.log(`[MOMENT] ${e.objective}: Player starts with ball`);const i=e.objective==="turnover"||e.objective==="pressWin"?es:100;this.time.delayedCall(i,()=>{this.isInitializingMoment=!1,console.log(`[MOMENT] Setup lock released after ${i}ms`)}),this.audioSystem.playWhistle()}resetToKickoffPositions(e){const t=this.fieldWidth/2,i=this.fieldHeight/2;e?this.player.setPosition(t-150,i):this.player.setPosition(t-30,i),this.player.setVelocity(0,0),this.player.hasBall=!1,this.player.isStunned=!1,this.ball.resetToCenter(),this.ball.setPosition(t,i)}resetPositions(){const e=this.fieldWidth/2,t=this.fieldHeight/2;this.player.hasBall=!1,this.teammates.forEach(o=>{o.hasBall=!1,o.setVelocity(0,0)}),this.enemies.forEach(o=>{o.hasBall=!1,o.setVelocity(0,0)}),this.player.setPosition(e-100,t),this.player.setVelocity(0,0);const i=[{x:e-200,y:t-100},{x:e-180,y:t+80},{x:e-80,y:t-20}];this.teammates.forEach((o,n)=>{const r=i[n]||i[0];o.setPosition(r.x,r.y)});const s=[{x:e+200,y:t},{x:e+150,y:t-80},{x:e+100,y:t+60}];this.enemies.forEach((o,n)=>{const r=s[n]||s[0];o.setPosition(r.x,r.y)}),this.ball.resetToCenter(),this.ball.setPosition(e,t)}resetMomentStats(){this.momentStats={goalsScored:0,goalsConceded:0,tacklesWon:0,tacklesLost:0,passesCompleted:0,passesAttempted:0,shotsOnTarget:0,shotsTaken:0,possessionTime:0,totalTime:0},this.lastPossessionCheck=this.time.now}handlePlayerDeath(e){console.log(`[PLAYER_DEATH] Reason: ${e}`),this.toastManager.error("INJURED!","ðŸ’€ Too many tackles"),this.cameras.main.flash(500,255,0,0),this.momentSystem.failMoment("Player overwhelmed by tackles")}resetPlayerHealth(){this.player.resetHealth(),this.player.resetStamina()}triggerAdvantagePlay(){this.advantageActive||(this.advantageActive=!0,this.advantageExpiresAt=this.time.now+$,this.upgradeSystem.addTempBuff("advantage_speed","speed",cs,$,"play"),this.upgradeSystem.addTempBuff("advantage_pass","passPower",hs,$,"play"),this.upgradeSystem.addTempBuff("advantage_shot","shotPower",ds,$,"play"),this.toastManager.success("ADVANTAGE!","âš¡ Play on!"),this.audioSystem.playUpgrade(),this.uiSystem.showPlayActive("advantage",$),console.log("[ADVANTAGE] Triggered for 3 seconds"),this.time.delayedCall($,()=>{this.advantageActive=!1,console.log("[ADVANTAGE] Expired")}))}getUpgradeIcon(e){const t={autoHitInD:"ðŸŽ¯",speedBoost:"ðŸ’¨",circleSpecialist:"â­•",reboundReady:"ðŸ”„",pressSpeed:"ðŸƒ",vampireTackle:"ðŸ§›",burstSpeed:"ðŸš€",ballMagnet:"ðŸ§²",tacklePower:"ðŸ’ª",quickRelease:"âš¡",default:"âš¡"};return t[e]||t.default}attemptTackle(e,t){var n,r,c;const i=Nt+10;let s=null;if(t&&t.hasBall?s=t:s=[this.player,...this.teammates,...this.enemies].find(d=>d.hasBall&&d!==e),!s||s.isInvulnerable)return;if(p.Math.Distance.Between(e.x,e.y,s.x,s.y)<i){const h=Rt+(((n=e.stats)==null?void 0:n.tackle)||5)*Et,d=this.enemies.includes(e);if(Math.random()<h){d&&this.aiSystem.recordTackleAttempt(!0),e.applyHitstop&&e.applyHitstop(Ae),s.applyHitstop&&s.applyHitstop(Ae),s.loseBall(),s.applyStun(Ot);const m=s.x-e.x,f=s.y-e.y,u=It;if(s.applyKnockback)s.applyKnockback(m,f,u);else if(s.body){const x=Math.sqrt(m*m+f*f)||1;s.body.velocity.x+=m/x*u,s.body.velocity.y+=f/x*u}const g=Math.atan2(f,m)+(Math.random()-.5)*.6,y={x:Math.cos(g),y:Math.sin(g)};this.ball.kick(y,wt+_t,0,"tackle"),this.ball.isLoose=!0,this.ball.owner=null,this.particleManager.tackleImpact((e.x+s.x)/2,(e.y+s.y)/2),this.particleManager.sparkBurst(s.x,s.y,16766720,10),this.cameras.main.shake(Lt,Gt),s.setTint&&(s.setTint(16777215),this.time.delayedCall(100,()=>{var x;return(x=s.clearTint)==null?void 0:x.call(s)})),this.audioSystem.playSteal(),this.showFloatingText(s.x,s.y,"ðŸ’¥ TACKLED!","#ff4444",22);const b=e===this.player||this.teammates.includes(e),T=this.enemies.includes(s);if(e===this.player&&(this.momentStats.tacklesWon++,this.upgradeSystem.emitEvent("steal",{player:this.player,target:s,scene:this,time:this.time.now}),C.getInstance().incrementStat("totalSteals"),this.triggerAdvantagePlay()),s===this.player){const x=Ft,w=this.player.takeDamage(x,"tackle");if(this.player.stamina!==void 0&&(this.player.stamina=Math.max(0,this.player.stamina-Me),(c=(r=this.player).onStaminaChange)==null||c.call(r,this.player.stamina,this.player.maxStamina)),console.log(`[TACKLE_PUNISH] Player: -${x} HP, -${Me} stamina. HP: ${this.player.health}`),this.player.isInvulnerable=!0,this.time.delayedCall(Ht,()=>{this.player.isInvulnerable=!1}),w){this.handlePlayerDeath("tackled");return}}b&&T&&(console.log(`[STEAL] ${e===this.player?"Player":"Teammate"} tackled enemy`),this.momentSystem.playerStole(),this.ball.setLastPossessingTeam("player"))}else{e.applyStun(180),d&&this.aiSystem.recordTackleAttempt(!1),this.aiSystem.setTackleBackoff(e,Kt);const m=e.x-s.x,f=e.y-s.y;e.applyKnockback&&e.applyKnockback(m,f,Bt*.5),e===this.player&&this.momentStats.tacklesLost++}C.getInstance().incrementStat("totalTackles")}}scoreGoal(e){this.isGoalScored=!0,this.isTransitioning=!0,this.goalCooldownUntil=this.time.now+_e;const t=e?this.fieldWidth-30:30;if(this.ball.setPosition(t,this.fieldHeight/2),this.ball.setVelocity(0,0),this.time.timeScale=.3,this.time.delayedCall(400/.3,()=>{this.time.timeScale=1}),this.cameras.main.shake(350,.018),this.cameras.main.flash(200,e?50:255,e?255:50,50,!0),this.showGoalBanner(e),e){this.momentStats.goalsScored++,this.audioSystem.playGoal(),this.particleManager.goalCelebration(this.fieldWidth-50,this.fieldHeight/2),this.uiSystem.showGoalNotification(!0),this.shakeGoalNet(!1);const i=this.ball.isRebound,s=this.ball.lastOwner,o=s&&s!==this.ball.lastShooter;this.momentSystem.playerScored(i,o),this.upgradeSystem.emitEvent("goal",{player:this.player,scene:this,time:this.time.now}),C.getInstance().incrementStat("totalGoals"),i&&C.getInstance().incrementStat("totalReboundGoals"),o&&C.getInstance().incrementStat("totalAssists")}else this.momentStats.goalsConceded++,this.audioSystem.playConcede(),this.uiSystem.showGoalNotification(!1),this.shakeGoalNet(!0),this.momentSystem.enemyScored();this.time.delayedCall(1e3,()=>{this.showKickoffCountdown()})}showGoalBanner(e){const t=this.cameras.main.width/2,i=this.cameras.main.height/2,s=this.add.text(t,i,e?"âš½ GOAL! âš½":"ðŸ’€ CONCEDED",{fontFamily:"Arial Black, Arial, sans-serif",fontSize:"64px",color:e?"#00ff00":"#ff4444",stroke:"#000000",strokeThickness:8});s.setOrigin(.5),s.setScrollFactor(0),s.setDepth(1e3),s.setScale(0),this.tweens.add({targets:s,scaleX:1.2,scaleY:1.2,duration:200,ease:"Back.easeOut",onComplete:()=>{this.tweens.add({targets:s,scaleX:1,scaleY:1,duration:100,ease:"Quad.easeOut"})}}),this.tweens.add({targets:s,y:i-80,alpha:0,delay:700,duration:500,ease:"Quad.easeIn",onComplete:()=>s.destroy()})}showFloatingText(e,t,i,s="#ffffff",o=18){const n=this.add.text(e,t-20,i,{fontFamily:"Arial Black, Arial, sans-serif",fontSize:`${o}px`,color:s,stroke:"#000000",strokeThickness:3});n.setOrigin(.5),n.setDepth(500),n.setScale(0),this.tweens.add({targets:n,scaleX:1.1,scaleY:1.1,y:t-50,duration:150,ease:"Back.easeOut",onComplete:()=>{this.tweens.add({targets:n,scaleX:1,scaleY:1,duration:100})}}),this.tweens.add({targets:n,y:t-80,alpha:0,delay:400,duration:400,ease:"Quad.easeIn",onComplete:()=>n.destroy()})}applyGlobalHitstop(e=50){const t=this.time.timeScale;this.time.timeScale=.05,this.time.delayedCall(e/.05,()=>{this.time.timeScale=t})}showUpgradeProc(e,t="â¬†ï¸"){this.showFloatingText(this.player.x,this.player.y,`${t} ${e}`,"#ffdd00",16)}showKickoffCountdown(){var i;if((i=this.momentSystem.getCurrentState())!=null&&i.isComplete){this.isGoalScored=!1;return}this.isCountingDown=!0,this.resetPositions();let e=3;const t=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,e.toString(),{fontFamily:"Arial, sans-serif",fontSize:"72px",color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:6});t.setOrigin(.5),t.setScrollFactor(0),t.setDepth(150),this.time.addEvent({delay:550,callback:()=>{e--,e>0?(t.setText(e.toString()),this.tweens.add({targets:t,scaleX:1.3,scaleY:1.3,duration:100,yoyo:!0})):(t.destroy(),this.isGoalScored=!1,this.isTransitioning=!1,this.isCountingDown=!1,this.ball.attachTo(this.player),this.player.receiveBall(),this.audioSystem.playWhistle())},repeat:3})}handleMomentComplete(e){var i,s,o;this.isTransitioning=!0,console.log(`[MOMENT_RESULT] ${e.isWon?"WIN":"FAIL"}`);const t=e.cupState;t&&(console.log(`[CUP_SCORE] You ${t.playerPoints} - ${t.enemyPoints} Enemy`),t.isEnded&&console.log(`[CUP_ENDED] Winner: ${t.winner}`),e.shouldTriggerComebackCurses&&console.log(`[COMEBACK_CURSES_TRIGGERED] Deficit: ${t.enemyPoints-t.playerPoints}`)),this.momentStats.totalTime=e.isWon?((i=this.momentSystem.getCurrentMoment())==null?void 0:i.duration)||45:(((s=this.momentSystem.getCurrentMoment())==null?void 0:s.duration)||45)-(((o=this.momentSystem.getCurrentState())==null?void 0:o.timeRemaining)||0),t&&this.uiSystem.updateCupRun(t.playerPoints,t.enemyPoints,t.pointsToWin),this.uiSystem.showMomentComplete(e.isWon),this.time.delayedCall(2e3,()=>{this.momentStats.shotsTaken>0||this.momentStats.tacklesWon>0?this.uiSystem.showMomentRecap(this.momentStats,()=>{this.proceedAfterMoment(e)}):this.proceedAfterMoment(e)})}proceedAfterMoment(e){this.momentSystem.getCupState().isEnded||(e!=null&&e.shouldTriggerComebackCurses?this.showComebackCursesOverlay(()=>{this.continueAfterCurses()}):this.continueAfterCurses())}continueAfterCurses(){this.momentSystem.nextMoment()&&this.showUpgradeDraft()}showComebackCursesOverlay(e){Te(async()=>{const{getRandomCurseOptions:t}=await import("./curses-5gb34V15.js");return{getRandomCurseOptions:t}},[]).then(({getRandomCurseOptions:t})=>{const i=t(2),s=this.add.rectangle(this.cameras.main.centerX,this.cameras.main.centerY,this.cameras.main.width,this.cameras.main.height,0,.85);s.setScrollFactor(0),s.setDepth(1e3);const o=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY-180,"âš¡ COMEBACK CURSES âš¡",{fontFamily:"Arial, sans-serif",fontSize:"36px",color:"#ff6600",fontStyle:"bold",stroke:"#000000",strokeThickness:4});o.setOrigin(.5),o.setScrollFactor(0),o.setDepth(1001);const n=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY-140,"You're down by 2! Choose a curse to gain power...",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#ffcc00"});n.setOrigin(.5),n.setScrollFactor(0),n.setDepth(1001);const r=280,c=200,h=40,d=this.cameras.main.centerX-(r+h/2),m=[];i.forEach((f,u)=>{const g=d+u*(r+h),y=this.cameras.main.centerY+20,b=this.add.rectangle(0,0,r,c,3346705,1);b.setStrokeStyle(3,16729088);const T=this.add.text(0,-70,f.icon,{fontSize:"40px"});T.setOrigin(.5);const x=this.add.text(0,-30,f.name,{fontFamily:"Arial, sans-serif",fontSize:"20px",color:"#ffffff",fontStyle:"bold"});x.setOrigin(.5);const w=this.add.text(0,10,`âœ“ ${f.boonDescription}`,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#44ff44",wordWrap:{width:r-20}});w.setOrigin(.5);const D=this.add.text(0,50,`âœ— ${f.curseDescription}`,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#ff4444",wordWrap:{width:r-20}});D.setOrigin(.5);const S=this.add.container(g,y,[b,T,x,w,D]);S.setScrollFactor(0),S.setDepth(1002),S.setSize(r,c),S.setInteractive({useHandCursor:!0}),S.on("pointerover",()=>{b.setStrokeStyle(4,16776960),S.setScale(1.05)}),S.on("pointerout",()=>{b.setStrokeStyle(3,16729088),S.setScale(1)}),S.on("pointerdown",()=>{console.log(`[CURSE_PICKED] ${f.id} - ${f.name}`),this.momentSystem.setActiveCurse(f.id),this.applyCurse(f),this.uiSystem.setActiveCurse(f.name),s.destroy(),o.destroy(),n.destroy(),m.forEach(v=>v.destroy()),this.toastManager.success(`Comeback Curse: ${f.name}`,f.icon),this.audioSystem.playUpgrade(),e()}),m.push(S)})})}applyCurse(e){e.modifiers&&e.modifiers.forEach(t=>{this.upgradeSystem.addModifier(t)}),e.hooks&&e.hooks.forEach(t=>{this.upgradeSystem.addHook(t)}),console.log(`[CURSE] Applied: ${e.name}`)}showUpgradeDraft(){const e=this.momentSystem.getProgress(),t=C.getInstance(),i=t.getMetaUpgradeLevel("upgradeChoices"),s=t.getMetaUpgradeLevel("rerollCount");new Fs(this,{momentNumber:e.current,ownedUpgradeIds:this.upgradeSystem.getOwnedUpgradeIds(),extraChoices:i,rerolls:s,onSelect:o=>{console.log(`[UPGRADE_PICKED] ${o.id} - ${o.name}`),console.log("[UPGRADE_PICKED] Modifiers:",o.modifiers),console.log("[UPGRADE_PICKED] Hooks:",o.hooks),this.upgradeSystem.addUpgrade(o),this.audioSystem.playUpgrade(),this.toastManager.success(`UPGRADE: ${o.name}`,o.icon);const n=this.upgradeSystem.getOwnedUpgrades().length;console.log(`[UPGRADE_PICKED] Total active upgrades: ${n}`),this.time.delayedCall(500,()=>{this.startMoment()})},onSkip:()=>{this.startMoment()}})}endRun(e){const t=this.momentSystem.getCupState(),i=this.uiSystem.getActiveCurseName();console.log(`[RUN_END] Cup: ${t.playerPoints} - ${t.enemyPoints}, Winner: ${t.winner}`),this.time.delayedCall(1e3,()=>{this.cameras.main.fadeOut(500),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("EndRunScene",{stats:e.stats,reward:e.reward,breakdown:e.breakdown,upgrades:this.upgradeSystem.getOwnedUpgrades(),character:this.character,cupRun:{playerPoints:t.playerPoints,enemyPoints:t.enemyPoints,winner:t.winner},activeCurse:i})})})}update(e,t){var T,x,w,D,S,v;if(this.isPaused||this.isCountingDown)return;const i=this.inputSystem.getState(this.player.x,this.player.y);if(i.showHelp){this.uiSystem.toggleControlsOverlay();return}if(this.uiSystem.isControlsVisible()){i.cancel&&this.uiSystem.hideControlsOverlay();return}if(i.pause){this.togglePause();return}if(this.isTransitioning)return;this.player.update(t,i),this.ball.update(t),this.aiSystem.updateTeamStates(this.ball,this.player,this.teammates,this.enemies,t);const s=this.momentSystem.getObjectiveDescriptor();this.aiSystem.setObjective(s),this.debugDisplayEnabled&&this.updateDebugDisplay(),this.debugUpgrades&&this.updateUpgradeDebugOverlay(),this.updateActiveBuffsUI(),this.uiSystem.updateHealth(this.player.health,this.player.maxHealth),this.uiSystem.updateStamina(this.player.stamina,this.player.maxStamina,this.player.canDash),this.teammates.forEach(A=>A.update(t)),this.enemies.forEach(A=>A.update(t)),(T=this.enemyGoalkeeper)==null||T.update(t),(x=this.playerGoalkeeper)==null||x.update(t),this.updateGKStatusMarker(),this.debugDCircle&&this.updateDCircleDebug(),this.player.isMoving&&Math.sqrt(this.player.body.velocity.x**2+this.player.body.velocity.y**2)>150&&(this.trailManager.spawn(this.player.x,this.player.y,"speed"),this.particleManager.emitSprint(this.player.x,this.player.y,this.player.body.velocity.x,this.player.body.velocity.y)),this.trailManager.update(t);const o=this.player.getCooldowns();this.uiSystem.updateCooldown("shoot",o.shoot),this.uiSystem.updateCooldown("pass",o.pass),this.uiSystem.updateCooldown("tackle",o.tackle),this.uiSystem.updateCooldown("dodge",o.dodge);const n=this.player.hasBall||this.teammates.some(A=>A.hasBall);this.uiSystem.updatePossession(n),n&&(this.momentStats.possessionTime+=t/1e3),this.uiSystem.updateRadar(this.player,this.teammates,this.enemies,this.ball),this.debugGoalSensors&&this.updateGoalSensorDebug(),this.debugAI&&this.updateAIDebugOverlay();const r=this.player.hasBall,c=this.isPointInAttackingD("player",this.player.x,this.player.y),h=this.isPointInDefendingD("player",this.player.x,this.player.y),d=this.player.canShoot(),m=this.player.canPass(),f=!this.player.isMoving||Math.abs(((D=(w=this.player.body)==null?void 0:w.velocity)==null?void 0:D.x)||0)<20&&Math.abs(((v=(S=this.player.body)==null?void 0:S.velocity)==null?void 0:v.y)||0)<20,u=this.momentSystem.getCurrentState(),g=(u==null?void 0:u.timeRemaining)||0,y=this.momentSystem.getCupState(),b=y.enemyPoints>y.playerPoints;this.upgradeSystem.emitEvent("tick",{player:this.player,ball:this.ball,scene:this,time:e,delta:t,playerHasBall:r,playerInAttackingD:c,playerInDefendingD:h,playerCanShoot:d,playerCanPass:m,playerIsStationary:f,momentTimeRemaining:g,isLosing:b,possessionTime:this.momentStats.possessionTime})}isPointInAttackingD(e,t,i){const s=H,o=this.fieldHeight/2;if(e==="player"){const n=this.fieldWidth-30;return p.Math.Distance.Between(t,i,n,o)<s&&t>this.fieldWidth-s-50}else return p.Math.Distance.Between(t,i,30,o)<s&&t<s+50}isPointInDefendingD(e,t,i){return this.isPointInAttackingD(e==="player"?"enemy":"player",t,i)}togglePause(){this.isPaused=!this.isPaused,this.isPaused?(this.physics.pause(),this.showPauseMenu()):(this.physics.resume(),this.hidePauseMenu())}showPauseMenu(){const e=this.cameras.main.width,t=this.cameras.main.height,i=this.add.container(0,0);i.setScrollFactor(0),i.setDepth(200),this.pauseOverlay=i;const s=this.add.rectangle(e/2,t/2,e,t,0,.7);i.add(s);const o=this.add.text(e/2,t/2-100,"PAUSED",{fontFamily:"Arial, sans-serif",fontSize:"48px",color:"#ffffff",fontStyle:"bold"});o.setOrigin(.5),i.add(o);const n=this.createPauseButton(e/2,t/2,"RESUME",()=>{this.togglePause()});i.add(n);const r=this.createPauseButton(e/2,t/2+60,"CONTROLS",()=>{this.uiSystem.showControlsOverlay()});i.add(r);const c=this.createPauseButton(e/2,t/2+120,"QUIT RUN",()=>{this.scene.start("MenuScene")});i.add(c)}createPauseButton(e,t,i,s){const o=this.add.container(e,t),n=this.add.graphics();n.fillStyle(2899536,1),n.fillRoundedRect(-100,-20,200,40,8),o.add(n);const r=this.add.text(0,0,i,{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#ffffff",fontStyle:"bold"});r.setOrigin(.5),o.add(r);const c=this.add.rectangle(0,0,200,40,0,0);return c.setInteractive({useHandCursor:!0}),o.add(c),c.on("pointerdown",s),c.on("pointerover",()=>{n.clear(),n.fillStyle(3447003,1),n.fillRoundedRect(-100,-20,200,40,8)}),c.on("pointerout",()=>{n.clear(),n.fillStyle(2899536,1),n.fillRoundedRect(-100,-20,200,40,8)}),o}hidePauseMenu(){const e=this.pauseOverlay;e&&(e.destroy(),this.pauseOverlay=null)}}class $s extends p.Scene{constructor(){super({key:"EndRunScene"});l(this,"audioSystem");l(this,"runData");l(this,"tooltipContainer")}init(e){this.runData=e}create(){this.audioSystem=new V(this),this.cameras.main.setBackgroundColor(1710638);const e=this.runData.stats.momentsWon>this.runData.stats.momentsLost;this.createTitle(e),this.createStatsPanel(),this.createRewardsPanel(),this.createUpgradesPanel(),this.createButtons(),this.cameras.main.fadeIn(500),e?this.audioSystem.playGoal():this.audioSystem.playConcede()}createTitle(e){const t=this.cameras.main.centerX;let i=e?"ðŸ† RUN COMPLETE!":"ðŸ’” RUN OVER",s=e?"#f1c40f":"#e74c3c";this.runData.cupRun&&(this.runData.cupRun.winner==="player"?(i="ðŸ† CUP VICTORY! ðŸ†",s="#f1c40f"):(i="ðŸ’” CUP DEFEAT",s="#e74c3c"));const o=this.add.text(t,50,i,{fontFamily:"Arial, sans-serif",fontSize:"42px",color:s,fontStyle:"bold",stroke:"#000000",strokeThickness:4});o.setOrigin(.5);let n=90;if(this.runData.cupRun){const c=this.runData.cupRun;this.add.text(t,n,`Final Score: You ${c.playerPoints} â€” ${c.enemyPoints} Enemy`,{fontFamily:"Arial, sans-serif",fontSize:"24px",color:c.winner==="player"?"#2ecc71":"#e74c3c",fontStyle:"bold"}).setOrigin(.5),n+=35}this.add.text(t,n,`Played as ${this.runData.character.name}`,{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#bdc3c7"}).setOrigin(.5),this.runData.activeCurse&&this.add.text(t,n+25,`âš¡ Curse Used: ${this.runData.activeCurse}`,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#ff6600"}).setOrigin(.5),this.tweens.add({targets:o,scaleX:1.05,scaleY:1.05,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createStatsPanel(){const o=this.add.graphics();o.fillStyle(2899536,.9),o.fillRoundedRect(200-300/2,150,300,280,15),o.lineStyle(2,3447003,.5),o.strokeRoundedRect(200-300/2,150,300,280,15),this.add.text(200,175,"ðŸ“Š STATS",{fontFamily:"Arial, sans-serif",fontSize:"20px",color:"#3498db",fontStyle:"bold"}).setOrigin(.5),[{label:"Moments Won",value:this.runData.stats.momentsWon,color:"#27ae60"},{label:"Moments Lost",value:this.runData.stats.momentsLost,color:"#e74c3c"},{label:"Goals Scored",value:this.runData.stats.goalsScored,color:"#f1c40f"},{label:"Goals Conceded",value:this.runData.stats.goalsConceded,color:"#e67e22"},{label:"Rebound Goals",value:this.runData.stats.reboundGoals,color:"#9b59b6"},{label:"Clean Sheets",value:this.runData.stats.cleanSheets,color:"#1abc9c"},{label:"Bosses Beaten",value:this.runData.stats.bossesBeaten,color:"#e74c3c"}].forEach((c,h)=>{const d=210+h*30;this.add.text(80,d,c.label,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#bdc3c7"}),this.add.text(300,d,c.value.toString(),{fontFamily:"Arial, sans-serif",fontSize:"16px",color:c.color,fontStyle:"bold"}).setOrigin(1,0)})}createRewardsPanel(){const e=this.cameras.main.width-200,t=150,i=300,s=280,o=this.add.graphics();o.fillStyle(2899536,.9),o.fillRoundedRect(e-i/2,t,i,s,15),o.lineStyle(2,15844367,.5),o.strokeRoundedRect(e-i/2,t,i,s,15),this.add.text(e,t+25,"ðŸ’Ž REWARDS",{fontFamily:"Arial, sans-serif",fontSize:"20px",color:"#f1c40f",fontStyle:"bold"}).setOrigin(.5),[{label:"Base Reward",value:this.runData.breakdown.base},{label:"Moment Wins",value:this.runData.breakdown.momentWins},{label:"Boss Wins",value:this.runData.breakdown.bosses},{label:"Clean Sheets",value:this.runData.breakdown.cleanSheets},{label:"Goals",value:this.runData.breakdown.goals},{label:"Bonus",value:this.runData.breakdown.bonus}].forEach((m,f)=>{const u=t+60+f*28;this.add.text(e-120,u,m.label,{fontFamily:"Arial, sans-serif",fontSize:"13px",color:"#bdc3c7"}),this.add.text(e+100,u,`+${m.value}`,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:m.value>0?"#f1c40f":"#7f8c8d"}).setOrigin(1,0)});const c=t+230;this.add.graphics().lineStyle(1,15844367,.5).lineBetween(e-120,c,e+100,c),this.add.text(e-120,c+10,"TOTAL",{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#ffffff",fontStyle:"bold"});const h=this.add.text(e+100,c+10,`ðŸ’Ž ${this.runData.reward}`,{fontFamily:"Arial, sans-serif",fontSize:"20px",color:"#f1c40f",fontStyle:"bold"});h.setOrigin(1,0),this.tweens.add({targets:h,scaleX:1.1,scaleY:1.1,duration:500,yoyo:!0,repeat:-1});const d=C.getInstance().getGems();this.add.text(e,t+s-20,`Total Gems: ${d}`,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7f8c8d"}).setOrigin(.5)}createUpgradesPanel(){const e=this.cameras.main.centerX,t=460,i=700,s=120,o=this.add.graphics();o.fillStyle(2899536,.9),o.fillRoundedRect(e-i/2,t,i,s,15),o.lineStyle(2,10181046,.5),o.strokeRoundedRect(e-i/2,t,i,s,15),this.add.text(e,t+20,`âš¡ UPGRADES COLLECTED (${this.runData.upgrades.length})`,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#9b59b6",fontStyle:"bold"}).setOrigin(.5);const n=12,r=this.runData.upgrades.slice(0,n),c=40,h=e-Math.min(r.length,12)*(c+10)/2+c/2;r.forEach((f,u)=>{const g=h+u*(c+10),y=t+70,b=N[f.rarity],T=this.add.circle(g,y,c/2,1710638);T.setStrokeStyle(2,b),this.add.text(g,y,f.icon,{fontSize:"20px"}).setOrigin(.5),T.setInteractive(),T.on("pointerover",()=>{this.showUpgradeTooltip(g,t-10,f)}),T.on("pointerout",()=>{this.hideUpgradeTooltip()})}),this.runData.upgrades.length>n&&this.add.text(e+320,t+70,`+${this.runData.upgrades.length-n} more`,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7f8c8d"}).setOrigin(0,.5);const d=new Map;this.runData.upgrades.forEach(f=>{f.synergies.forEach(u=>{d.set(u,(d.get(u)||0)+1)})});const m=Array.from(d.entries()).filter(([f,u])=>u>=3).sort((f,u)=>u[1]-f[1]).slice(0,4);if(m.length>0){const f=m.map(([u,g])=>`${K[u]} (${g})`).join("  â€¢  ");this.add.text(e,t+100,`Active Synergies: ${f}`,{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#27ae60"}).setOrigin(.5)}}showUpgradeTooltip(e,t,i){this.hideUpgradeTooltip(),this.tooltipContainer=this.add.container(e,t);const s=this.add.graphics();s.fillStyle(1710638,.95),s.fillRoundedRect(-80,-50,160,50,8),s.lineStyle(1,N[i.rarity],.8),s.strokeRoundedRect(-80,-50,160,50,8),this.tooltipContainer.add(s);const o=this.add.text(0,-40,i.name,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#ffffff",fontStyle:"bold"});o.setOrigin(.5),this.tooltipContainer.add(o);const n=this.add.text(0,-22,i.description,{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#bdc3c7",align:"center",wordWrap:{width:150}});n.setOrigin(.5),this.tooltipContainer.add(n),this.tooltipContainer.setDepth(100)}hideUpgradeTooltip(){this.tooltipContainer&&(this.tooltipContainer.destroy(),this.tooltipContainer=void 0)}createButtons(){const e=this.cameras.main.centerX,t=this.cameras.main.height-60;new E(this,{x:e-120,y:t,width:180,height:50,text:"ðŸ”„ Play Again",fontSize:18,style:"success",onClick:()=>{this.audioSystem.playClick(),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CharacterSelectScene")})}}),new E(this,{x:e+120,y:t,width:180,height:50,text:"ðŸ  Main Menu",fontSize:18,style:"secondary",onClick:()=>{this.audioSystem.playClick(),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MenuScene")})}})}}function zs(k,a){if(console.error("[CRITICAL ERROR]",k,a),document.getElementById("critical-error-overlay"))return;const e=document.createElement("div");e.id="critical-error-overlay",e.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: #1a1a2e;
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 99999;
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 20px;
    box-sizing: border-box;
  `,e.innerHTML=`
    <h1 style="color: #e74c3c; margin-bottom: 20px;">âŒ Game Failed to Load</h1>
    <p style="color: #bdc3c7; margin-bottom: 10px; max-width: 500px;">${k}</p>
    ${a?`<pre style="background: #2c3e50; padding: 15px; border-radius: 8px; max-width: 600px; overflow-x: auto; font-size: 12px; color: #e74c3c; text-align: left;">${a}</pre>`:""}
    <p style="color: #7f8c8d; margin: 20px 0; font-size: 14px;">Press F12 to open DevTools for more info</p>
    <button onclick="location.reload()" style="
      background: #3498db;
      color: white;
      border: none;
      padding: 12px 30px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
    ">ðŸ”„ Refresh Page</button>
  `,document.body.appendChild(e)}window.addEventListener("error",k=>{console.error("[Window Error]",k.message,k.filename,k.lineno)});window.addEventListener("unhandledrejection",k=>{console.error("[Unhandled Rejection]",k.reason)});console.log("ðŸ‘ Stick & Shift - Field Hockey Roguelike");console.log("ðŸ“¦ Built with Phaser 3 + TypeScript + Vite");console.log("ðŸš€ Starting game initialization...");try{const k={type:p.AUTO,parent:"game-container",width:1200,height:700,backgroundColor:"#1a1a2e",scale:{mode:p.Scale.FIT,autoCenter:p.Scale.CENTER_BOTH,min:{width:800,height:450},max:{width:1920,height:1080}},physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}},render:{pixelArt:!1,antialias:!0,antialiasGL:!0},input:{keyboard:!0,mouse:!0,touch:!0},scene:[nt,rt,pt,ut,Us,$s],callbacks:{preBoot:e=>{console.log("[Phaser] Pre-boot")},postBoot:e=>{console.log("[Phaser] Post-boot - Game instance created")}}};console.log("[Main] Creating Phaser game instance...");const a=new p.Game(k);a.events.once("ready",()=>{console.log("[Phaser] Game ready")}),a.events.once("boot",()=>{console.log("[Phaser] Game boot")}),window.addEventListener("resize",()=>{a&&a.scale&&a.scale.refresh()}),document.addEventListener("contextmenu",e=>{e.preventDefault()}),console.log("[Main] Game instance created successfully"),window.game=a}catch(k){const a=k instanceof Error?k.message:String(k),e=k instanceof Error?k.stack:"";console.error("[Main] Fatal error during game initialization:",k),zs("Failed to initialize game engine.",`${a}

${e}`)}
